var Fo=Object.create;var{getPrototypeOf:Lo,defineProperty:a,getOwnPropertyNames:$o}=Object;var Vo=Object.prototype.hasOwnProperty;var Xo=(o,M,z)=>{z=o!=null?Fo(Lo(o)):{};let m=M||!o||!o.__esModule?a(z,"default",{value:o,enumerable:!0}):z;for(let f of $o(o))if(!Vo.call(m,f))a(m,f,{get:()=>o[f],enumerable:!0});return m};var No=((o)=>typeof require!=="undefined"?require:typeof Proxy!=="undefined"?new Proxy(o,{get:(M,z)=>(typeof require!=="undefined"?require:M)[z]}):o)(function(o){if(typeof require!=="undefined")return require.apply(this,arguments);throw Error('Dynamic require of "'+o+'" is not supported')});var u=[];function e(o){if(!u.some((M)=>M.name===o.name))u.push(o)}class q{static instance=null;static MARGIN={left:55,right:10,top:8,bottom:45};static HOVER_MAX_DISTANCE_PX=50;static MIN_ZOOM=0.1;static MAX_ZOOM=1e7;static DEFAULT_LABEL_SIZE=12;static DEFAULT_FONT='-apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif';static resizeCanvas(o,M,z){let m=devicePixelRatio||1;if(o.width=Math.round(M*m),o.height=Math.round(z*m),o instanceof HTMLCanvasElement)o.style.width=`${M}px`,o.style.height=`${z}px`}worker=null;charts=new Map;chartIdCounter=0;_syncViews=!1;_isDark=!1;statsCallbacks=[];currentStats={fps:0,renderMs:0,total:0,active:0};visibilityObserver;resizeObserver;constructor(){this._isDark=document.documentElement.classList.contains("dark"),this.visibilityObserver=new IntersectionObserver((o)=>{for(let M of o){let z=M.target.dataset.chartId;if(z){let m=this.charts.get(z);if(m){if(m.visible=M.isIntersecting,this.worker?.postMessage({type:"set-visibility",id:z,visible:M.isIntersecting}),M.isIntersecting)this.drawChart(m)}}}},{threshold:0.01}),this.resizeObserver=new ResizeObserver((o)=>{for(let M of o){let z=M.target.dataset.chartId;if(!z)continue;let m=this.charts.get(z);if(!m)continue;let{width:f,height:E}=M.contentRect;if(f<=0||E<=0)continue;m.width=f,m.height=E;let Y=devicePixelRatio||1;this.worker?.postMessage({type:"resize",id:z,width:Math.round(f*Y),height:Math.round(E*Y)}),q.resizeCanvas(m.backCanvas,f,E),q.resizeCanvas(m.axisCanvas,f,E),this.drawChart(m)}})}static getInstance(){if(!q.instance)q.instance=new q;return q.instance}get isDark(){return this._isDark}get syncViews(){return this._syncViews}async init(){if(this.worker)return!0;return new Promise((o)=>{import("./worker-inline.js").then(({WORKER_CODE:M})=>{let z=new Blob([M],{type:"application/javascript"}),m=URL.createObjectURL(z);this.worker=new Worker(m,{type:"module"}),this.setupWorkerHandlers(o)}).catch(()=>{let M=new URL("./gpu-worker.js",import.meta.url);this.worker=new Worker(M,{type:"module"}),this.setupWorkerHandlers(o)})})}setupWorkerHandlers(o){if(!this.worker)return;this.worker.onmessage=(M)=>{let{type:z,...m}=M.data;switch(z){case"gpu-ready":o(!0);break;case"error":console.error("ChartManager GPU Error:",m.message),o(!1);break;case"stats":this.currentStats={fps:m.fps,renderMs:m.renderMs,total:m.totalCharts,active:m.activeCharts};for(let f of this.statsCallbacks)f(this.currentStats);break;case"bounds-update":{let f=this.charts.get(m.id);if(f)f.bounds={minX:m.minX,maxX:m.maxX,minY:m.minY,maxY:m.maxY},this.drawChart(f);break}default:break}},this.worker.onerror=(M)=>{console.error("ChartManager Worker Error:",M),o(!1)},this.worker.postMessage({type:"init",isDark:this._isDark})}create(o){if(!this.worker)throw new Error("ChartManager not initialized. Call init() first.");let M=`chart-${++this.chartIdCounter}`,z=document.createElement("div");z.dataset.chartId=M,z.style.cssText="width: 100%; height: 100%; position: relative;";let m=document.createElement("div");m.dataset.chartId=M,m.style.cssText="width: 100%; height: 100%; position: relative;";let f=document.createElement("canvas");f.style.cssText="position: absolute; inset: 0; width: 100%; height: 100%; pointer-events: none;";let E=document.createElement("canvas");E.style.cssText="position: absolute; inset: 0; width: 100%; height: 100%; pointer-events: auto; z-index: 1;";let Y=document.createElement("canvas");Y.style.cssText="position: absolute; inset: 0; width: 100%; height: 100%; pointer-events: none; z-index: 2;",m.appendChild(f),m.appendChild(E),m.appendChild(Y),z.appendChild(m),o.container.appendChild(z);let A;try{A=E.transferControlToOffscreen()}catch(F){throw console.error(`ChartManager: Failed to create offscreen canvas for ${M}:`,F),new Error(`Failed to create chart ${M}: ${F}`)}let Z=m.getBoundingClientRect(),w=Z.width||400,L=Z.height||200;if(q.resizeCanvas(A,w,L),q.resizeCanvas(f,w,L),q.resizeCanvas(Y,w,L),o.bgColor){let[F,N,X]=o.bgColor;m.style.background=`rgb(${Math.round(F*255)},${Math.round(N*255)},${Math.round(X*255)})`}let O={id:M,config:o,el:z,backCanvas:f,axisCanvas:Y,width:w,height:L,series:[],bounds:{minX:0,maxX:1,minY:0,maxY:1},view:{panX:0,panY:0,zoomX:1,zoomY:1},zoomMode:o.zoomMode||"both",visible:!0,dragging:!1,bgColor:o.bgColor,textColor:o.textColor,gridColor:o.gridColor,fontFamily:o.fontFamily,momentum:null,findNearestPoint(F,N,X,J){if(this.series.length===0)return null;let G=F/X,Q=N/J,j=this.bounds.maxX-this.bounds.minX,V=this.bounds.maxY-this.bounds.minY,R=j/this.view.zoomX,K=V/this.view.zoomY,_=this.bounds.minX+this.view.panX*j,l=this.bounds.minY+this.view.panY*V,U=_+G*R,H=l+(1-Q)*K,I=-1,B=-1,P=1/0,D=1/0;for(let n=0;n<this.series.length;n++){let k=this.series[n],x=k.rawX.length;if(x===0)continue;let S=0,C=x-1;while(S<C){let d=S+C>>1;if(k.rawX[d]<U)S=d+1;else C=d}let i=S;if(S>0){let d=Math.abs(k.rawX[S]-U);if(Math.abs(k.rawX[S-1]-U)<d)i=S-1}let c=Math.abs(k.rawX[i]-U),r=Math.abs(k.rawY[i]-H);if(c<P||c===P&&r<D)P=c,D=r,I=n,B=i}if(I===-1)return null;let T=this.series[I],v=(T.rawX[B]-_)/R*X;if(Math.abs(v-F)>q.HOVER_MAX_DISTANCE_PX)return null;return{x:T.rawX[B],y:T.rawY[B],index:B,screenX:F,screenY:N,seriesIndex:I,seriesLabel:T.label}}};this.charts.set(M,O);let $=o.type==="bar"?"box":o.type;this.worker.postMessage({type:"register-chart",id:M,canvas:A,chartType:$,pointSize:o.pointSize??3,maxSamplesPerPixel:o.maxSamplesPerPixel??1e4,bgColor:o.bgColor??null},[A]),this.visibilityObserver.observe(z),this.resizeObserver.observe(m);for(let F of u)F.install?.(O,m);return this.updateSeries(M,o.series),M}destroy(o){let M=this.charts.get(o);if(!M)return;for(let m of u)m.uninstall?.(M);if(M.momentum)cancelAnimationFrame(M.momentum);this.visibilityObserver.unobserve(M.el);let z=M.el.querySelector(".gpu-chart-canvas-wrap");if(z)this.resizeObserver.unobserve(z);M.el.remove(),this.worker?.postMessage({type:"unregister-chart",id:o}),this.charts.delete(o)}updateSeries(o,M){let z=this.charts.get(o);if(!z||!this.worker)return;if(M.length===0)return;z.series=M.map((O)=>{let $=O.x.length;if($===0)return{label:O.label,color:O.color,rawX:[],rawY:[]};let F=Array.from({length:$},(N,X)=>X);return F.sort((N,X)=>O.x[N]-O.x[X]),{label:O.label,color:O.color,rawX:F.map((N)=>O.x[N]),rawY:F.map((N)=>O.y[N])}});let m=1/0,f=-1/0,E=1/0,Y=-1/0;for(let O of z.series)for(let $=0;$<O.rawX.length;$++){if(O.rawX[$]<m)m=O.rawX[$];if(O.rawX[$]>f)f=O.rawX[$];if(O.rawY[$]<E)E=O.rawY[$];if(O.rawY[$]>Y)Y=O.rawY[$]}let A=(f-m)*0.05||1,Z=(Y-E)*0.1||1;m-=A,f+=A,E-=Z,Y+=Z;let w=z.config.defaultBounds;if(w){if(w.minX!==void 0)m=w.minX;if(w.maxX!==void 0)f=w.maxX;if(w.minY!==void 0)E=w.minY;if(w.maxY!==void 0)Y=w.maxY}z.bounds={minX:m,maxX:f,minY:E,maxY:Y};let L=z.series.map((O)=>({label:O.label,colorR:O.color.r,colorG:O.color.g,colorB:O.color.b,dataX:new Float32Array(O.rawX),dataY:new Float32Array(O.rawY)}));this.worker.postMessage({type:"update-series",id:o,series:L,bounds:z.bounds},L.flatMap((O)=>[O.dataX.buffer,O.dataY.buffer])),this.sendViewTransform(z),this.drawChart(z)}setPointSize(o,M){if(!this.charts.get(o))return;this.worker?.postMessage({type:"set-point-size",id:o,pointSize:Math.max(1,Math.min(8,Math.round(M)))})}setMaxSamplesPerPixel(o,M){if(!this.charts.get(o))return;this.worker?.postMessage({type:"set-max-samples",id:o,maxSamplesPerPixel:Math.max(0,M|0)})}setStyle(o,M){let z=this.charts.get(o);if(!z)return;if(M.bgColor!==void 0)z.bgColor=M.bgColor;if(M.textColor!==void 0)z.textColor=M.textColor;if(M.gridColor!==void 0)z.gridColor=M.gridColor;if(M.fontFamily!==void 0)z.fontFamily=M.fontFamily;if(M.bgColor!==void 0){let m=z.el.querySelector(".gpu-chart-canvas-wrap");if(m){let[f,E,Y]=M.bgColor;m.style.background=`rgb(${Math.round(f*255)},${Math.round(E*255)},${Math.round(Y*255)})`}this.worker?.postMessage({type:"set-style",id:o,bgColor:M.bgColor})}this.drawChart(z)}setZoomMode(o,M){let z=this.charts.get(o);if(z)z.zoomMode=M}getChartCount(){return this.charts.size}getZoomMode(o){return this.charts.get(o)?.zoomMode||"both"}setSyncViews(o){this._syncViews=o}setTheme(o){this._isDark=o,this.worker?.postMessage({type:"theme",isDark:o});for(let M of this.charts.values())this.drawChart(M)}onStats(o){return this.statsCallbacks.push(o),()=>{let M=this.statsCallbacks.indexOf(o);if(M>=0)this.statsCallbacks.splice(M,1)}}getStats(){return{...this.currentStats}}resetView(o){let M=this.charts.get(o);if(!M)return;if(M.momentum)cancelAnimationFrame(M.momentum),M.momentum=null;let z=M.view.panX,m=M.view.panY,f=M.view.zoomX,E=M.view.zoomY,Y=performance.now(),A=()=>{let Z=Math.min(1,(performance.now()-Y)/300),w=1-Math.pow(1-Z,3);if(M.view.panX=z*(1-w),M.view.panY=m*(1-w),M.view.zoomX=f+(1-f)*w,M.view.zoomY=E+(1-E)*w,this.sendViewTransform(M),this.drawChart(M),this._syncViews)this.syncAllViews(M);if(Z<1)requestAnimationFrame(A)};requestAnimationFrame(A)}sendViewTransform(o){this.worker?.postMessage({type:"view-transform",id:o.id,panX:o.view.panX,panY:o.view.panY,zoomX:o.view.zoomX,zoomY:o.view.zoomY})}syncAllViews(o){let M=[];for(let z of this.charts.values())if(z.id!==o.id)z.view={...o.view},M.push({id:z.id}),this.drawChart(z);if(M.length>0)this.worker?.postMessage({type:"batch-view-transform",panX:o.view.panX,panY:o.view.panY,zoomX:o.view.zoomX,zoomY:o.view.zoomY,transforms:M})}drawChart(o){if(!o.visible)return;let M=devicePixelRatio||1,z=o.backCanvas.getContext("2d");if(z){z.clearRect(0,0,o.backCanvas.width,o.backCanvas.height),z.save(),z.scale(M,M);for(let f of u)f.beforeDraw?.(z,o);z.restore()}let m=o.axisCanvas.getContext("2d");if(m){m.clearRect(0,0,o.axisCanvas.width,o.axisCanvas.height),m.save(),m.scale(M,M);for(let f of u)f.afterDraw?.(m,o);m.restore()}}}var h=(o,M,z)=>{let m=M-o;if(m<=0)return[o];let f=m/z,E=10**Math.floor(Math.log10(f)),Y=f/E,A=E*(Y<=1.5?1:Y<=3?2:Y<=7?5:10),Z=[];for(let w=Math.ceil(o/A)*A;w<=M;w+=A)Z.push(w);return Z},oo=(o)=>{let M=q.getInstance(),z=o.width,m=o.height,f=q.MARGIN,{bounds:E,view:Y}=o,A=E.maxX-E.minX,Z=E.maxY-E.minY,w=A/Y.zoomX,L=Z/Y.zoomY,O=E.minX+Y.panX*A,$=E.minY+Y.panY*Z,F=o.bgColor??(M.isDark?[0.11,0.11,0.12]:[0.98,0.98,0.98]);return{w:z,h:m,m:f,rx:w,ry:L,mx:O,my:$,bg:`${Math.round(F[0]*255)},${Math.round(F[1]*255)},${Math.round(F[2]*255)}`,font:o.fontFamily??q.DEFAULT_FONT,text:o.textColor??(M.isDark?"#c0c0c0":"#333333"),grid:o.gridColor??(M.isDark?"rgba(255,255,255,0.06)":"rgba(0,0,0,0.06)")}},mo={name:"labels",beforeDraw(o,M){let{w:z,h:m,m:f,rx:E,ry:Y,mx:A,my:Z,grid:w}=oo(M);o.strokeStyle=w,o.lineWidth=1,o.beginPath(),h(Z,Z+Y,7).forEach((L)=>{let O=m*(1-(L-Z)/Y);if(O>5&&O<m-f.bottom-5)o.moveTo(f.left,O),o.lineTo(z,O)}),h(A,A+E,8).forEach((L)=>{let O=z*((L-A)/E);if(O>f.left&&O<z)o.moveTo(O,0),o.lineTo(O,m-f.bottom)}),o.stroke()},afterDraw(o,M){let{w:z,h:m,m:f,rx:E,ry:Y,mx:A,my:Z,bg:w,font:L,text:O}=oo(M),{formatX:$=String,formatY:F=String,labelSize:N=q.DEFAULT_LABEL_SIZE}=M.config,X=(J,G,Q,j,V)=>{let R=J==="left"?o.createLinearGradient(G,0,G+j,0):o.createLinearGradient(0,Q,0,Q+V),K=J==="left"?[1,0.7,0.2,0.05,0]:[0,0.05,0.2,0.7,1];[0,0.35,0.55,0.7,1].forEach((_,l)=>R.addColorStop(_,`rgba(${w},${K[l]})`)),o.fillStyle=R,o.fillRect(G,Q,j,V)};X("left",0,0,f.left+20,m),X("bottom",0,m-f.bottom-20,z,f.bottom+20),o.font=`${N}px ${L}`,o.fillStyle=O,o.textAlign="right",o.textBaseline="middle",h(Z,Z+Y,7).forEach((J)=>{let G=m*(1-(J-Z)/Y);if(G>5&&G<m-f.bottom-5)o.fillText(F(J),f.left-5,G)}),o.textAlign="right",o.textBaseline="top",h(A,A+E,8).forEach((J)=>{let G=z*((J-A)/E);if(G<f.left-10||G>z+30)return;o.save(),o.translate(G,m-f.bottom+5),o.rotate(-Math.PI/14),o.fillText($(J),0,0),o.restore()})}};function Mo(o={}){let M=o.momentumDecay??0.91,z=new WeakMap;return{name:"zoom",install(m,f){let E=q.getInstance(),Y=new AbortController,A={lastX:0,lastY:0,velX:0,velY:0,abort:Y};z.set(m,A);let Z=[],w=0,L=0,O=1,$=1,F=0.5,N=0.5,X=()=>{if(E.sendViewTransform(m),E.drawChart(m),E.syncViews)E.syncAllViews(m)},J=()=>{if(m.momentum)cancelAnimationFrame(m.momentum);let V=()=>{if(A.velX*=M,A.velY*=M,Math.abs(A.velX)>0.00005||Math.abs(A.velY)>0.00005){if(m.zoomMode!=="none"&&(m.zoomMode==="both"||m.zoomMode==="x-only"))m.view.panX-=A.velX/m.view.zoomX;if(m.zoomMode!=="none"&&(m.zoomMode==="both"||m.zoomMode==="y-only"))m.view.panY+=A.velY/m.view.zoomY;X(),m.momentum=requestAnimationFrame(V)}else m.momentum=null};m.momentum=requestAnimationFrame(V)},G=()=>{if(m.dragging)m.dragging=!1,Z=[]};f.addEventListener("pointerdown",(V)=>{if(m.momentum)cancelAnimationFrame(m.momentum),m.momentum=null;if(Z.push(V),f.setPointerCapture(V.pointerId),Z.length===1)m.dragging=!0,A.lastX=V.clientX,A.lastY=V.clientY,A.velX=A.velY=0,w=performance.now();else if(Z.length===2){let R=f.getBoundingClientRect(),K=Z[1].clientX-Z[0].clientX,_=Z[1].clientY-Z[0].clientY;L=Math.hypot(K,_),O=m.view.zoomX,$=m.view.zoomY,F=((Z[0].clientX+Z[1].clientX)/2-R.left)/R.width,N=1-((Z[0].clientY+Z[1].clientY)/2-R.top)/R.height}},{signal:Y.signal}),f.addEventListener("pointermove",(V)=>{let R=Z.findIndex((K)=>K.pointerId===V.pointerId);if(R>=0)Z[R]=V;if(Z.length===1&&m.dragging){let K=f.getBoundingClientRect(),_=(V.clientX-A.lastX)/K.width,l=(V.clientY-A.lastY)/K.height,U=performance.now();if(U-w<100)A.velX=A.velX*0.5+_*0.5,A.velY=A.velY*0.5+l*0.5;if(w=U,m.zoomMode!=="none"&&(m.zoomMode==="both"||m.zoomMode==="x-only"))m.view.panX-=_/m.view.zoomX;if(m.zoomMode!=="none"&&(m.zoomMode==="both"||m.zoomMode==="y-only"))m.view.panY+=l/m.view.zoomY;A.lastX=V.clientX,A.lastY=V.clientY,X()}else if(Z.length===2){let K=Z[1].clientX-Z[0].clientX,_=Z[1].clientY-Z[0].clientY,U=Math.hypot(K,_)/L;if(m.zoomMode!=="none"&&(m.zoomMode==="both"||m.zoomMode==="x-only")){let H=Math.max(q.MIN_ZOOM,Math.min(q.MAX_ZOOM,O*U)),I=m.view.panX+F/O;m.view.zoomX=H,m.view.panX=I-F/H}if(m.zoomMode!=="none"&&(m.zoomMode==="both"||m.zoomMode==="y-only")){let H=Math.max(q.MIN_ZOOM,Math.min(q.MAX_ZOOM,$*U)),I=m.view.panY+N/$;m.view.zoomY=H,m.view.panY=I-N/H}X()}},{signal:Y.signal});let Q=(V)=>{if(Z=Z.filter((R)=>R.pointerId!==V.pointerId),f.releasePointerCapture(V.pointerId),Z.length===0&&m.dragging){if(m.dragging=!1,Math.abs(A.velX)>0.001||Math.abs(A.velY)>0.001)J()}};f.addEventListener("pointerup",Q,{signal:Y.signal}),f.addEventListener("pointercancel",Q,{signal:Y.signal}),f.addEventListener("pointerleave",G,{signal:Y.signal});let j=0;f.addEventListener("pointerup",()=>{let V=Date.now();if(V-j<300)E.resetView(m.id);j=V},{signal:Y.signal}),f.addEventListener("wheel",(V)=>{if(V.preventDefault(),m.momentum)cancelAnimationFrame(m.momentum),m.momentum=null;let R=f.getBoundingClientRect(),K=V.clientX-R.left,_=V.clientY-R.top,l=K/R.width,U=1-_/R.height,H=1-V.deltaY*0.002,I=q.MARGIN,B=K<I.left,P=_>R.height-I.bottom,D,T;if(B)D=!1,T=!0;else if(P)D=!0,T=!1;else D=m.zoomMode==="both"||m.zoomMode==="x-only",T=m.zoomMode==="both"||m.zoomMode==="y-only";if(D){let y=m.view.panX+l/m.view.zoomX;m.view.zoomX=Math.max(q.MIN_ZOOM,Math.min(q.MAX_ZOOM,m.view.zoomX*H)),m.view.panX=y-l/m.view.zoomX}if(T){let y=m.view.panY+U/m.view.zoomY;m.view.zoomY=Math.max(q.MIN_ZOOM,Math.min(q.MAX_ZOOM,m.view.zoomY*H)),m.view.panY=y-U/m.view.zoomY}if(D||T)X()},{passive:!1,signal:Y.signal})},uninstall(m){let f=z.get(m);if(f){if(m.momentum)cancelAnimationFrame(m.momentum),m.momentum=null;f.abort.abort(),z.delete(m)}}}}var s=new WeakMap,Go=(o,M,z,m,f,E,Y,A)=>{o.beginPath(),o.roundRect(M,z,m,f,E),o.fillStyle=Y,o.fill(),o.strokeStyle=A,o.lineWidth=1.5,o.stroke()},zo={name:"hover",install(o,M){let z=q.getInstance(),m=new AbortController,f={hoverResult:null,pillX:0,pillY:0,pillTargetX:0,pillTargetY:0,pillAnimRef:null,abort:m};s.set(o,f);let E=(Y)=>{if(o.config.onHover)o.config.onHover(Y);if(!(o.config.showTooltip??!1))return;if(f.hoverResult=Y,z.drawChart(o),Y&&!f.pillAnimRef){let A=performance.now(),Z=(w)=>{if(!f.hoverResult)return f.pillAnimRef=null;let L=1-Math.pow(0.5,(w-A)/(o.config.pillDecayMs??60));A=w,f.pillX+=(f.pillTargetX-f.pillX)*L,f.pillY+=(f.pillTargetY-f.pillY)*L,z.drawChart(o),f.pillAnimRef=requestAnimationFrame(Z)};f.pillAnimRef=requestAnimationFrame(Z)}};M.addEventListener("mousemove",(Y)=>{if(o.dragging)return;let A=M.getBoundingClientRect();E(o.findNearestPoint(Y.clientX-A.left,Y.clientY-A.top,A.width,A.height))},{signal:m.signal}),["mouseleave","pointerdown"].forEach((Y)=>M.addEventListener(Y,()=>E(null),{signal:m.signal}))},afterDraw(o,M){let z=s.get(M);if(!z?.hoverResult||!M.config.showTooltip)return;let{hoverResult:m}=z,f=M.width,E=M.height,Y=q.MARGIN,A=q.getInstance().isDark,{formatX:Z=String,formatY:w=String,fontFamily:L=q.DEFAULT_FONT}=M.config,O=(M.bounds.maxX-M.bounds.minX)/M.view.zoomX,$=(M.bounds.maxY-M.bounds.minY)/M.view.zoomY,F=(m.x-(M.bounds.minX+M.view.panX*(M.bounds.maxX-M.bounds.minX)))/O*f,N=E*(1-(m.y-(M.bounds.minY+M.view.panY*(M.bounds.maxY-M.bounds.minY)))/$),X=M.series[m.seriesIndex]||M.series[0],J=`${Math.round(X.color.r*255)},${Math.round(X.color.g*255)},${Math.round(X.color.b*255)}`,G=`rgb(${J})`,Q=A?`oklch(from ${G} calc(l + 0.1) c h)`:G;o.save(),o.setLineDash([4,3]),o.strokeStyle=`rgba(${J},0.4)`,o.stroke(new Path2D(`M${F} 0V${E-Y.bottom}M${Y.left} ${N}H${f}`)),o.restore(),o.beginPath(),o.arc(F,N,4.5,0,Math.PI*2),o.fillStyle=G,o.fill(),o.strokeStyle=A?"rgba(0,0,0,0.6)":"rgba(255,255,255,0.9)",o.stroke();let j=M.series.map((B)=>{let P=0,D=B.rawX.length-1;while(P<=D){let T=P+D>>1;if(Math.abs(B.rawX[T]-m.x)<0.0001)return{label:B.label,val:w(B.rawY[T]),rawVal:B.rawY[T],col:`rgb(${Math.round(B.color.r*255)},${Math.round(B.color.g*255)},${Math.round(B.color.b*255)})`};B.rawX[T]<m.x?P=T+1:D=T-1}return null}).filter(Boolean);j.sort((B,P)=>Math.abs(P.rawVal)-Math.abs(B.rawVal));let V=j.length,R=j.slice(0,5),K=V-R.length;if(z.pillTargetX=F,z.pillTargetY=N,!z.pillAnimRef)z.pillX=F,z.pillY=N;let _=(B,P,D,T)=>{o.font=`600 10px ${L}`;let y=o.measureText(D).width,v=y+12,p=18,n=T?B-v/2:B-v,k=T?P:P-p/2;o.save();let x=T?Math.atan((z.pillTargetX-z.pillX)/80)*0.2:Math.atan((z.pillTargetY-z.pillY)/80)*0.2;o.translate(B,P),o.rotate(x);let S=T?-v/2:-v,C=T?0:-p/2;o.beginPath(),o.roundRect(S,C,v,p,4),o.fillStyle=A?"rgba(0,0,0,0.75)":"rgba(255,255,255,0.75)",o.fill(),o.fillStyle=`rgba(${J},0.2)`,o.fill(),o.strokeStyle=Q,o.lineWidth=1.5,o.stroke(),o.fillStyle=Q,o.textAlign="center",o.textBaseline="middle",o.fillText(D,S+v/2,C+p/2),o.restore()};_(Math.max(Y.left,Math.min(f-Y.right,z.pillX)),E-Y.bottom+4,Z(m.x),!0),_(Math.max(Y.left,Y.left),Math.max(9,Math.min(E-Y.bottom-9,z.pillY)),w(m.y),!1);let l=Math.max(...R.map((B)=>o.measureText(B.label+B.val).width))+40,U=30+R.length*18+(K>0?18:0),H=m.screenX+14,I=m.screenY-U-6;if(H+l>f)H=m.screenX-l-14;if(I=Math.max(4,Math.min(E-U-4,m.screenY-U-6)),Go(o,H,I,l,U,6,A?"rgba(28,28,30,0.95)":"rgba(255,255,255,0.96)","rgba(0,0,0,0.08)"),o.textAlign="left",o.textBaseline="middle",o.fillStyle=A?"#888":"#999",o.fillText(Z(m.x),H+10,I+15),R.forEach((B,P)=>{let D=I+35+P*18;o.fillStyle=B.col,o.beginPath(),o.roundRect(H+10,D-4,8,8,2),o.fill(),o.fillStyle=A?"#eee":"#1a1a1a",o.fillText(`${B.label}: ${B.val}`,H+24,D)}),K>0){let B=I+35+R.length*18;o.fillStyle=A?"#666":"#aaa",o.fillText(`+${K} more`,H+10,B)}},uninstall(o){let M=s.get(o);if(M?.pillAnimRef)cancelAnimationFrame(M.pillAnimRef);M?.abort.abort(),s.delete(o)}};e(mo);e(Mo());e(zo);var t=[],W,b=document.documentElement.classList.contains("dark"),Yo=0,Zo=new MessageChannel,Eo=0,fo=0;Zo.port1.onmessage=()=>{Yo=performance.now()-Eo;let o=performance.now();if(o-fo>=120){fo=o;let M=(z)=>z<1?z.toFixed(2)+"ms":z.toFixed(1)+"ms";document.getElementById("main-ms").textContent=M(Yo)}};function Oo(){requestAnimationFrame(()=>{Eo=performance.now(),Zo.port2.postMessage(null),Oo()})}Oo();var qo=new Date("2026-02-03");function Bo(o,M){let z=new Array(o),m=new Array(o);if(M==="stock")for(let Y=0;Y<o;Y++)z[Y]=o-1-Y;else for(let Y=0;Y<o;Y++)z[Y]=Y;let E=2*Math.PI;switch(M){case"stock":{let A=Math.LN2/5258880,Z=-A*3,w=0.0005,L=0.0009000000000000001,O=o/5258880,$=Math.max(1,Math.round(O*(0.8+Math.random()*0.4))),F=[];for(let Q=0;Q<$;Q++){let j=Math.floor(Math.random()*o*0.9),V=Math.floor((180+Math.random()*360)*1440);F.push({s:j,e:j+V})}F.sort((Q,j)=>Q.s-j.s);let N=Math.log(10+Math.random()*20),X=0,J=0,G=!1;for(let Q=0;Q<o;Q++){while(X<F.length&&Q>=F[X].e)X++;let j=X<F.length&&Q>=F[X].s&&Q<F[X].e,V=j?Z:A,R=j?0.0009000000000000001:0.0005,K;if(G)K=J,G=!1;else{let _=Math.random()||0.0000000001,l=Math.sqrt(-2*Math.log(_)),U=E*Math.random();K=l*Math.cos(U),J=l*Math.sin(U),G=!0}N+=V+R*K,m[Q]=Math.exp(N)}break}case"trending":{let Y=Math.log(20+Math.random()*20),A=Math.LN2/o,Z=0.015,w=0,L=!1;for(let O=0;O<o;O++){let $;if(L)$=w,L=!1;else{let F=Math.random()||0.0000000001,N=Math.sqrt(-2*Math.log(F)),X=E*Math.random();$=N*Math.cos(X),w=N*Math.sin(X),L=!0}Y+=A+Z*$,m[O]=Math.exp(Y)}break}case"declining":{let Y=Math.log(60+Math.random()*40),A=-Math.LN2/o,Z=0.015,w=0,L=!1;for(let O=0;O<o;O++){let $;if(L)$=w,L=!1;else{let F=Math.random()||0.0000000001,N=Math.sqrt(-2*Math.log(F)),X=E*Math.random();$=N*Math.cos(X),w=N*Math.sin(X),L=!0}Y+=A+Z*$,m[O]=Math.exp(Y)}break}case"spikey":{let Y=20+Math.random()*30,A=3+Math.floor(Math.random()*5),Z=new Set;while(Z.size<Math.min(A,o))Z.add(Math.floor(Math.random()*o));let w=Y*1.2,L=Y*5;for(let O=0;O<o;O++)if(Z.has(O))m[O]=Math.random()<0.5?-L:L;else m[O]=(Math.random()-0.5)*w;break}case"cyclic":{let Y=Date.now()%1e5/1e5*E,A=30+Math.random()*20,Z=50+Math.random()*20,w=2+Math.random()*4,L=E*w/o,O=A*0.25;for(let $=0;$<o;$++){let F=$*L+Y;m[$]=Z+Math.sin(F)*A+Math.sin(F*2.7+1.3)*O+(Math.random()-0.5)*8}break}}return{x:z,y:m}}function Jo(o){if(o>=1000)return"$"+(o/1000).toFixed(1)+"k";return"$"+o.toFixed(2)}function Qo(o){let M=qo.getTime()-Math.round(o)*60000,z=new Date(M),f=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][z.getMonth()],E=z.getDate(),Y=z.getFullYear();return`${f} ${E}, ${Y}`}function Ro(o,M,z){let m=(1-Math.abs(2*z-1))*M,f=m*(1-Math.abs(o/60%2-1)),E=z-m/2,Y=0,A=0,Z=0;if(o<60)Y=m,A=f;else if(o<120)Y=f,A=m;else if(o<180)A=m,Z=f;else if(o<240)A=f,Z=m;else if(o<300)Y=f,Z=m;else Y=m,Z=f;return{r:Y+E,g:A+E,b:Z+E}}function Ko(){return Ro(Math.random()*360,0.65+Math.random()*0.2,0.5+Math.random()*0.1)}function To(o){if(o>=1e6)return(o/1e6).toFixed(1)+"M";if(o>=1000)return(o/1000).toFixed(0)+"k";return o.toString()}function Uo(o){if(Math.abs(o)>=1000)return(o/1000).toFixed(1)+"k";if(Math.abs(o)>=100)return o.toFixed(0);if(Math.abs(o)>=10)return o.toFixed(1);return o.toFixed(2)}function jo(o){return Math.round(o).toString()}function g(o,M,z,m=1){m=Math.max(1,Math.min(1e4,m));let f=[];for(let J=0;J<m;J++){let G=Bo(M,z);if(o==="bar"&&z!=="spikey"&&z!=="cyclic")for(let Q=0;Q<G.y.length;Q++)G.y[Q]=Math.max(0,G.y[Q]);f.push({label:m>1?`Series ${J+1}`:"",color:Ko(),x:G.x,y:G.y})}let E=z==="stock",Y={id:"",type:o,pointCount:M,zoomX:!0,zoomY:!0},A=document.createElement("div");A.className="chart-card";let Z=o.charAt(0).toUpperCase()+o.slice(1),w=o==="scatter"?`
      <div class="chart-point-size">
        <input type="range" min="1" max="8" value="3" class="point-size-slider" title="Point size">
        <span class="point-size-label">3px</span>
      </div>`:"",L=m>1?`<span class="chart-card-series">×${m}</span>`:"";A.innerHTML=`
    <div class="chart-card-header">
      <span class="chart-card-title">Chart</span>
      <span class="chart-card-type">${Z}</span>
      <span class="chart-card-points">${To(M)}</span>${L}${w}
      <div class="chart-zoom-split">
        <button class="zoom-axis-btn active" data-action="toggle-x" title="Toggle X zoom">X</button>
        <button class="zoom-axis-btn active" data-action="toggle-y" title="Toggle Y zoom">Y</button>
      </div>
      <div class="chart-card-actions">
        <button class="chart-action-btn" data-action="reset" title="Reset view">⌘</button>
        <button class="chart-action-btn danger" data-action="remove" title="Remove">×</button>
      </div>
    </div>
    <div class="chart-card-body"></div>
  `,document.getElementById("chart-grid").appendChild(A);let O=A.querySelector(".chart-card-body"),$={type:o,container:O,series:f,formatX:E?Qo:jo,formatY:E?Jo:Uo,zoomMode:"both",showTooltip:!0},F;try{F=W.create($)}catch(J){console.error("Failed to create chart:",J),A.remove();return}Y.id=F,A.dataset.id=F,O.id=`chart-container-${F}`;let N=A.querySelector(".point-size-slider"),X=A.querySelector(".point-size-label");if(N&&X)N.addEventListener("input",()=>{let J=parseInt(N.value);X.textContent=J+"px",W.setPointSize(Y.id,J)});A.addEventListener("click",(J)=>{let G=J.target.closest("[data-action]");if(!G)return;switch(G.dataset.action){case"reset":W.resetView(Y.id);break;case"remove":wo(Y.id);break;case"toggle-x":Ao(Y,"x",G,A);break;case"toggle-y":Ao(Y,"y",G,A);break}}),t.push(Y)}function wo(o){W.destroy(o);let M=t.findIndex((m)=>m.id===o);if(M>=0)t.splice(M,1);let z=document.querySelector(`.chart-card[data-id="${o}"]`);if(z)z.remove()}function Ao(o,M,z,m){if(M==="x")o.zoomX=!o.zoomX;else o.zoomY=!o.zoomY;let f=m.querySelector('[data-action="toggle-x"]'),E=m.querySelector('[data-action="toggle-y"]');f.classList.toggle("active",o.zoomX),E.classList.toggle("active",o.zoomY);let Y;if(o.zoomX&&o.zoomY)Y="both";else if(o.zoomX)Y="x-only";else if(o.zoomY)Y="y-only";else Y="none";W.setZoomMode(o.id,Y)}function _o(){let o=document.getElementById("theme-btn"),M=document.getElementById("theme-icon-sun"),z=document.getElementById("theme-icon-moon"),m=()=>{M.style.display=b?"none":"block",z.style.display=b?"block":"none"};m(),o.addEventListener("click",()=>{b=!b,document.documentElement.classList.toggle("dark",b),localStorage.setItem("theme",b?"dark":"light"),W.setTheme(b),m()})}async function Ho(){if(W=q.getInstance(),!await W.init()){let M=document.getElementById("error-toast");M.textContent="WebGPU not available. Please use a supported browser.",M.classList.remove("hidden");return}W.onStats((M)=>{document.getElementById("active").textContent=M.active.toString(),document.getElementById("total").textContent=M.total.toString()}),_o(),Do(),setTimeout(()=>{g("scatter",500,"stock",1),g("line",300,"trending",3),g("bar",100,"spikey",1),g("line",200,"cyclic",1)},100)}function Do(){let o=document.getElementById("chart-type"),M=document.getElementById("point-count"),z=document.getElementById("pattern"),m=document.getElementById("sync-toggle"),f=document.getElementById("sync-label"),E=document.getElementById("series-count");document.getElementById("add-chart").addEventListener("click",()=>{let Y=o.value,A=parseInt(M.value)||500,Z=z.value,w=Math.max(1,Math.min(1e4,parseInt(E.value)||3));g(Y,A,Z,w)}),document.getElementById("add-batch").addEventListener("click",()=>{let Y=o.value,A=parseInt(M.value)||500,Z=z.value,w=Math.max(1,Math.min(1e4,parseInt(E.value)||3));for(let L=0;L<5;L++)setTimeout(()=>{g(Y,A,Z,w)},L*100)}),document.getElementById("clear-all").addEventListener("click",()=>{for(let Y of[...t])wo(Y.id)}),m.addEventListener("change",()=>{let Y=m.checked;W.setSyncViews(Y),f.textContent=Y?"Synced":"Sync Off"})}var lo=new WebSocket(`ws://${location.host}/__hot`);lo.onmessage=(o)=>{if(o.data==="reload")location.reload()};Ho();
