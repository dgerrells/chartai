var O0=Object.create;var{getPrototypeOf:_0,defineProperty:J0,getOwnPropertyNames:H0}=Object;var Z0=Object.prototype.hasOwnProperty;var z0=($,G,q)=>{q=$!=null?O0(_0($)):{};let F=G||!$||!$.__esModule?J0(q,"default",{value:$,enumerable:!0}):q;for(let J of H0($))if(!Z0.call(F,J))J0(F,J,{get:()=>$[J],enumerable:!0});return F};var D0=(($)=>typeof require!=="undefined"?require:typeof Proxy!=="undefined"?new Proxy($,{get:(G,q)=>(typeof require!=="undefined"?require:G)[q]}):$)(function($){if(typeof require!=="undefined")return require.apply(this,arguments);throw Error('Dynamic require of "'+$+'" is not supported')});var c=[];function t($){if(!c.some((G)=>G.name===$.name))c.push($)}class A{static instance=null;static MARGIN={left:55,right:10,top:8,bottom:45};static HOVER_MAX_DISTANCE_PX=50;static MIN_ZOOM=0.1;static MAX_ZOOM=1e7;static DEFAULT_LABEL_SIZE=12;static DEFAULT_FONT='-apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif';static resizeCanvas($,G,q){let F=devicePixelRatio||1;if($.width=Math.round(G*F),$.height=Math.round(q*F),$ instanceof HTMLCanvasElement)$.style.width=`${G}px`,$.style.height=`${q}px`}worker=null;charts=new Map;chartIdCounter=0;_syncViews=!1;_isDark=!1;statsCallbacks=[];currentStats={fps:0,renderMs:0,total:0,active:0};visibilityObserver;resizeObserver;constructor(){this._isDark=document.documentElement.classList.contains("dark"),this.visibilityObserver=new IntersectionObserver(($)=>{for(let G of $){let q=G.target.dataset.chartId;if(q){let F=this.charts.get(q);if(F){if(F.visible=G.isIntersecting,this.worker?.postMessage({type:"set-visibility",id:q,visible:G.isIntersecting}),G.isIntersecting)this.drawChart(F)}}}},{threshold:0.01}),this.resizeObserver=new ResizeObserver(($)=>{for(let G of $){let q=G.target.dataset.chartId;if(!q)continue;let F=this.charts.get(q);if(!F)continue;let{width:J,height:K}=G.contentRect;if(J<=0||K<=0)continue;F.width=J,F.height=K;let B=devicePixelRatio||1;this.worker?.postMessage({type:"resize",id:q,width:Math.round(J*B),height:Math.round(K*B)}),A.resizeCanvas(F.backCanvas,J,K),A.resizeCanvas(F.axisCanvas,J,K),this.drawChart(F)}})}static getInstance(){if(!A.instance)A.instance=new A;return A.instance}get isDark(){return this._isDark}get syncViews(){return this._syncViews}async init(){if(this.worker)return!0;return new Promise(($)=>{import("./worker-inline.js").then(({WORKER_CODE:G})=>{let q=new Blob([G],{type:"application/javascript"}),F=URL.createObjectURL(q);this.worker=new Worker(F,{type:"module"}),this.setupWorkerHandlers($)}).catch(()=>{let G=new URL("./gpu-worker.js",import.meta.url);this.worker=new Worker(G,{type:"module"}),this.setupWorkerHandlers($)})})}setupWorkerHandlers($){if(!this.worker)return;this.worker.onmessage=(G)=>{let{type:q,...F}=G.data;switch(q){case"gpu-ready":$(!0);break;case"error":console.error("ChartManager GPU Error:",F.message),$(!1);break;case"stats":this.currentStats={fps:F.fps,renderMs:F.renderMs,total:F.totalCharts,active:F.activeCharts};for(let J of this.statsCallbacks)J(this.currentStats);break;case"bounds-update":{let J=this.charts.get(F.id);if(J)J.bounds={minX:F.minX,maxX:F.maxX,minY:F.minY,maxY:F.maxY},this.drawChart(J);break}default:break}},this.worker.onerror=(G)=>{console.error("ChartManager Worker Error:",G),$(!1)},this.worker.postMessage({type:"init",isDark:this._isDark})}create($){if(!this.worker)throw new Error("ChartManager not initialized. Call init() first.");let G=`chart-${++this.chartIdCounter}`,q=document.createElement("div");q.dataset.chartId=G,q.style.cssText="width: 100%; height: 100%; position: relative;";let F=document.createElement("div");F.dataset.chartId=G,F.style.cssText="width: 100%; height: 100%; position: relative;";let J=document.createElement("canvas");J.style.cssText="position: absolute; inset: 0; width: 100%; height: 100%; pointer-events: none;";let K=document.createElement("canvas");K.style.cssText="position: absolute; inset: 0; width: 100%; height: 100%; pointer-events: auto; z-index: 1;";let B=document.createElement("canvas");B.style.cssText="position: absolute; inset: 0; width: 100%; height: 100%; pointer-events: none; z-index: 2;",F.appendChild(J),F.appendChild(K),F.appendChild(B),q.appendChild(F),$.container.appendChild(q);let E;try{E=K.transferControlToOffscreen()}catch(U){throw console.error(`ChartManager: Failed to create offscreen canvas for ${G}:`,U),new Error(`Failed to create chart ${G}: ${U}`)}let N=F.getBoundingClientRect(),L=N.width||400,R=N.height||200;if(A.resizeCanvas(E,L,R),A.resizeCanvas(J,L,R),A.resizeCanvas(B,L,R),$.bgColor){let[U,_,H]=$.bgColor;F.style.background=`rgb(${Math.round(U*255)},${Math.round(_*255)},${Math.round(H*255)})`}let Q={id:G,config:$,el:q,backCanvas:J,axisCanvas:B,width:L,height:R,series:[],bounds:{minX:0,maxX:1,minY:0,maxY:1},view:{panX:0,panY:0,zoomX:1,zoomY:1},zoomMode:$.zoomMode||"both",visible:!0,dragging:!1,bgColor:$.bgColor,textColor:$.textColor,gridColor:$.gridColor,fontFamily:$.fontFamily,momentum:null,findNearestPoint(U,_,H,z){if(this.series.length===0)return null;let Z=U/H,W=_/z,w=this.bounds.maxX-this.bounds.minX,u=this.bounds.maxY-this.bounds.minY,I=w/this.view.zoomX,y=u/this.view.zoomY,g=this.bounds.minX+this.view.panX*w,m=this.bounds.minY+this.view.panY*u,v=g+Z*I,p=m+(1-W)*y,S=-1,O=-1,P=1/0,M=1/0;for(let n=0;n<this.series.length;n++){let V=this.series[n],T=V.rawX.length;if(T===0)continue;let D=0,f=T-1;while(D<f){let x=D+f>>1;if(V.rawX[x]<v)D=x+1;else f=x}let b=D;if(D>0){let x=Math.abs(V.rawX[D]-v);if(Math.abs(V.rawX[D-1]-v)<x)b=D-1}let Y=Math.abs(V.rawX[b]-v),X=Math.abs(V.rawY[b]-p);if(Y<P||Y===P&&X<M)P=Y,M=X,S=n,O=b}if(S===-1)return null;let k=this.series[S],C=(k.rawX[O]-g)/I*H;if(Math.abs(C-U)>A.HOVER_MAX_DISTANCE_PX)return null;return{x:k.rawX[O],y:k.rawY[O],index:O,screenX:U,screenY:_,seriesIndex:S,seriesLabel:k.label}}};this.charts.set(G,Q);let j=$.type==="bar"?"box":$.type;this.worker.postMessage({type:"register-chart",id:G,canvas:E,chartType:j,pointSize:$.pointSize??3,maxSamplesPerPixel:$.maxSamplesPerPixel??1e4,bgColor:$.bgColor??null},[E]),this.visibilityObserver.observe(q),this.resizeObserver.observe(F);for(let U of c)U.install?.(Q,F);return this.updateSeries(G,$.series),G}destroy($){let G=this.charts.get($);if(!G)return;for(let F of c)F.uninstall?.(G);if(G.momentum)cancelAnimationFrame(G.momentum);this.visibilityObserver.unobserve(G.el);let q=G.el.querySelector(".gpu-chart-canvas-wrap");if(q)this.resizeObserver.unobserve(q);G.el.remove(),this.worker?.postMessage({type:"unregister-chart",id:$}),this.charts.delete($)}updateSeries($,G){let q=this.charts.get($);if(!q||!this.worker)return;if(G.length===0)return;q.series=G.map((Q)=>{let j=Q.x.length;if(j===0)return{label:Q.label,color:Q.color,rawX:[],rawY:[]};let U=Array.from({length:j},(_,H)=>H);return U.sort((_,H)=>Q.x[_]-Q.x[H]),{label:Q.label,color:Q.color,rawX:U.map((_)=>Q.x[_]),rawY:U.map((_)=>Q.y[_])}});let F=1/0,J=-1/0,K=1/0,B=-1/0;for(let Q of q.series)for(let j=0;j<Q.rawX.length;j++){if(Q.rawX[j]<F)F=Q.rawX[j];if(Q.rawX[j]>J)J=Q.rawX[j];if(Q.rawY[j]<K)K=Q.rawY[j];if(Q.rawY[j]>B)B=Q.rawY[j]}let E=(J-F)*0.05||1,N=(B-K)*0.1||1;F-=E,J+=E,K-=N,B+=N;let L=q.config.defaultBounds;if(L){if(L.minX!==void 0)F=L.minX;if(L.maxX!==void 0)J=L.maxX;if(L.minY!==void 0)K=L.minY;if(L.maxY!==void 0)B=L.maxY}q.bounds={minX:F,maxX:J,minY:K,maxY:B};let R=q.series.map((Q)=>({label:Q.label,colorR:Q.color.r,colorG:Q.color.g,colorB:Q.color.b,dataX:new Float32Array(Q.rawX),dataY:new Float32Array(Q.rawY)}));this.worker.postMessage({type:"update-series",id:$,series:R,bounds:q.bounds},R.flatMap((Q)=>[Q.dataX.buffer,Q.dataY.buffer])),this.sendViewTransform(q),this.drawChart(q)}setPointSize($,G){if(!this.charts.get($))return;this.worker?.postMessage({type:"set-point-size",id:$,pointSize:Math.max(1,Math.min(8,Math.round(G)))})}setMaxSamplesPerPixel($,G){if(!this.charts.get($))return;this.worker?.postMessage({type:"set-max-samples",id:$,maxSamplesPerPixel:Math.max(0,G|0)})}setStyle($,G){let q=this.charts.get($);if(!q)return;if(G.bgColor!==void 0)q.bgColor=G.bgColor;if(G.textColor!==void 0)q.textColor=G.textColor;if(G.gridColor!==void 0)q.gridColor=G.gridColor;if(G.fontFamily!==void 0)q.fontFamily=G.fontFamily;if(G.bgColor!==void 0){let F=q.el.querySelector(".gpu-chart-canvas-wrap");if(F){let[J,K,B]=G.bgColor;F.style.background=`rgb(${Math.round(J*255)},${Math.round(K*255)},${Math.round(B*255)})`}this.worker?.postMessage({type:"set-style",id:$,bgColor:G.bgColor})}this.drawChart(q)}setZoomMode($,G){let q=this.charts.get($);if(q)q.zoomMode=G}getChartCount(){return this.charts.size}getZoomMode($){return this.charts.get($)?.zoomMode||"both"}setSyncViews($){this._syncViews=$}setTheme($){this._isDark=$,this.worker?.postMessage({type:"theme",isDark:$});for(let G of this.charts.values())this.drawChart(G)}onStats($){return this.statsCallbacks.push($),()=>{let G=this.statsCallbacks.indexOf($);if(G>=0)this.statsCallbacks.splice(G,1)}}getStats(){return{...this.currentStats}}resetView($){let G=this.charts.get($);if(!G)return;if(G.momentum)cancelAnimationFrame(G.momentum),G.momentum=null;let q=G.view.panX,F=G.view.panY,J=G.view.zoomX,K=G.view.zoomY,B=performance.now(),E=()=>{let N=Math.min(1,(performance.now()-B)/300),L=1-Math.pow(1-N,3);if(G.view.panX=q*(1-L),G.view.panY=F*(1-L),G.view.zoomX=J+(1-J)*L,G.view.zoomY=K+(1-K)*L,this.sendViewTransform(G),this.drawChart(G),this._syncViews)this.syncAllViews(G);if(N<1)requestAnimationFrame(E)};requestAnimationFrame(E)}sendViewTransform($){this.worker?.postMessage({type:"view-transform",id:$.id,panX:$.view.panX,panY:$.view.panY,zoomX:$.view.zoomX,zoomY:$.view.zoomY})}syncAllViews($){let G=[];for(let q of this.charts.values())if(q.id!==$.id)q.view={...$.view},G.push({id:q.id}),this.drawChart(q);if(G.length>0)this.worker?.postMessage({type:"batch-view-transform",panX:$.view.panX,panY:$.view.panY,zoomX:$.view.zoomX,zoomY:$.view.zoomY,transforms:G})}drawChart($){if(!$.visible)return;let G=devicePixelRatio||1,q=$.backCanvas.getContext("2d");if(q){q.clearRect(0,0,$.backCanvas.width,$.backCanvas.height),q.save(),q.scale(G,G);for(let J of c)J.beforeDraw?.(q,$);q.restore()}let F=$.axisCanvas.getContext("2d");if(F){F.clearRect(0,0,$.axisCanvas.width,$.axisCanvas.height),F.save(),F.scale(G,G);for(let J of c)J.afterDraw?.(F,$);F.restore()}}}var $0=($,G,q)=>{let F=G-$;if(F<=0)return[$];let J=F/q,K=10**Math.floor(Math.log10(J)),B=J/K,E=K*(B<=1.5?1:B<=3?2:B<=7?5:10),N=[];for(let L=Math.ceil($/E)*E;L<=G;L+=E)N.push(L);return N},Q0=($)=>{let G=A.getInstance(),q=$.width,F=$.height,J=A.MARGIN,{bounds:K,view:B}=$,E=K.maxX-K.minX,N=K.maxY-K.minY,L=E/B.zoomX,R=N/B.zoomY,Q=K.minX+B.panX*E,j=K.minY+B.panY*N,U=$.bgColor??(G.isDark?[0.11,0.11,0.12]:[0.98,0.98,0.98]);return{w:q,h:F,m:J,rx:L,ry:R,mx:Q,my:j,bg:`${Math.round(U[0]*255)},${Math.round(U[1]*255)},${Math.round(U[2]*255)}`,font:$.fontFamily??A.DEFAULT_FONT,text:$.textColor??(G.isDark?"#c0c0c0":"#333333"),grid:$.gridColor??(G.isDark?"rgba(255,255,255,0.06)":"rgba(0,0,0,0.06)")}},B0={name:"labels",beforeDraw($,G){let{w:q,h:F,m:J,rx:K,ry:B,mx:E,my:N,grid:L}=Q0(G);$.strokeStyle=L,$.lineWidth=1,$.beginPath(),$0(N,N+B,7).forEach((R)=>{let Q=F*(1-(R-N)/B);if(Q>5&&Q<F-J.bottom-5)$.moveTo(J.left,Q),$.lineTo(q,Q)}),$0(E,E+K,8).forEach((R)=>{let Q=q*((R-E)/K);if(Q>J.left&&Q<q)$.moveTo(Q,0),$.lineTo(Q,F-J.bottom)}),$.stroke()},afterDraw($,G){let{w:q,h:F,m:J,rx:K,ry:B,mx:E,my:N,bg:L,font:R,text:Q}=Q0(G),{formatX:j=String,formatY:U=String,labelSize:_=A.DEFAULT_LABEL_SIZE}=G.config,H=(z,Z,W,w,u)=>{let I=z==="left"?$.createLinearGradient(Z,0,Z+w,0):$.createLinearGradient(0,W,0,W+u),y=z==="left"?[1,0.7,0.2,0.05,0]:[0,0.05,0.2,0.7,1];[0,0.35,0.55,0.7,1].forEach((g,m)=>I.addColorStop(g,`rgba(${L},${y[m]})`)),$.fillStyle=I,$.fillRect(Z,W,w,u)};H("left",0,0,J.left+20,F),H("bottom",0,F-J.bottom-20,q,J.bottom+20),$.font=`${_}px ${R}`,$.fillStyle=Q,$.textAlign="right",$.textBaseline="middle",$0(N,N+B,7).forEach((z)=>{let Z=F*(1-(z-N)/B);if(Z>5&&Z<F-J.bottom-5)$.fillText(U(z),J.left-5,Z)}),$.textAlign="right",$.textBaseline="top",$0(E,E+K,8).forEach((z)=>{let Z=q*((z-E)/K);if(Z<J.left-10||Z>q+30)return;$.save(),$.translate(Z,F-J.bottom+5),$.rotate(-Math.PI/14),$.fillText(j(z),0,0),$.restore()})}};function E0($={}){let G=$.momentumDecay??0.9,q=new WeakMap;return{name:"zoom",install(F,J){let K=J.style.touchAction,B=J.style.userSelect,E=J.style.webkitUserSelect;J.style.touchAction="none",J.style.userSelect="none",J.style.webkitUserSelect="none";let N=A.getInstance(),L=new AbortController,R={lastX:0,lastY:0,velX:0,velY:0,abort:L,originalTouchAction:K,originalUserSelect:B,originalWebkitUserSelect:E,el:J};q.set(F,R);let Q=[],j="none",U=0,_=0,H=0,z=0,Z=0,W=10,w=10,u=500,I=null,y=0,g=1,m=1,v=0.5,p=0.5,S=0,O=0,P=0,M=null,k=0,o=1,C=()=>{if(N.sendViewTransform(F),N.drawChart(F),N.syncViews)N.syncAllViews(F)},i=()=>{if(F.momentum)cancelAnimationFrame(F.momentum);let V=()=>{if(S*=G,O*=G,Math.abs(S)>0.00005||Math.abs(O)>0.00005){if(F.zoomMode!=="none"&&(F.zoomMode==="both"||F.zoomMode==="x-only"))F.view.panX-=S/F.view.zoomX;if(F.zoomMode!=="none"&&(F.zoomMode==="both"||F.zoomMode==="y-only"))F.view.panY+=O/F.view.zoomY;C(),F.momentum=requestAnimationFrame(V)}else F.momentum=null};F.momentum=requestAnimationFrame(V)};J.addEventListener("pointerdown",(V)=>{if(F.momentum)cancelAnimationFrame(F.momentum),F.momentum=null;if(Q.push(V),J.setPointerCapture(V.pointerId),Q.length===1)if(j="detecting",U=V.clientX,_=V.clientY,H=V.clientX,z=V.clientY,S=O=0,Z=performance.now(),M=null,V.pointerType==="touch")I=window.setTimeout(()=>{if(j==="detecting")j="press",F.dragging=!1},u);else{let T=J.getBoundingClientRect(),D=V.clientX-T.left,f=V.clientY-T.top,b=A.MARGIN,Y=D<b.left,X=f>T.height-b.bottom;if(Y&&!X)M="y",k=V.clientY,o=F.view.zoomY,F.dragging=!0;else if(X&&!Y)M="x",k=V.clientX,o=F.view.zoomX,F.dragging=!0;else F.dragging=!0}else if(Q.length===2){if(I)clearTimeout(I),I=null;if(j="pinch",F.dragging=!1,V.pointerType==="touch")V.preventDefault();let T=J.getBoundingClientRect(),D=Q[1].clientX-Q[0].clientX,f=Q[1].clientY-Q[0].clientY;y=Math.hypot(D,f),g=F.view.zoomX,m=F.view.zoomY,v=((Q[0].clientX+Q[1].clientX)/2-T.left)/T.width,p=1-((Q[0].clientY+Q[1].clientY)/2-T.top)/T.height}},{passive:!1,signal:L.signal}),J.addEventListener("pointermove",(V)=>{let T=Q.findIndex((D)=>D.pointerId===V.pointerId);if(T>=0)Q[T]=V;if(Q.length===1){let D=Math.hypot(V.clientX-U,V.clientY-_);if(j==="detecting"&&D>W){if(j="pan",F.dragging=!0,I)clearTimeout(I),I=null}if(j==="press")return;if(M&&V.pointerType!=="touch"){if(M==="x"){let f=V.clientX-k,b=Math.exp(f/200),Y=Math.max(A.MIN_ZOOM,Math.min(A.MAX_ZOOM,o*b)),X=F.view.panX+0.5/o;F.view.zoomX=Y,F.view.panX=X-0.5/Y,C();return}else if(M==="y"){let f=k-V.clientY,b=Math.exp(f/200),Y=Math.max(A.MIN_ZOOM,Math.min(A.MAX_ZOOM,o*b)),X=F.view.panY+0.5/o;F.view.zoomY=Y,F.view.panY=X-0.5/Y,C();return}}if(j==="pan"||F.dragging&&!M){let f=J.getBoundingClientRect(),b=(V.clientX-H)/f.width,Y=(V.clientY-z)/f.height,X=performance.now();if(X-Z<100)S=S*0.3+b*0.7,O=O*0.3+Y*0.7;if(Z=X,F.zoomMode!=="none"&&(F.zoomMode==="both"||F.zoomMode==="x-only"))F.view.panX-=b/F.view.zoomX;if(F.zoomMode!=="none"&&(F.zoomMode==="both"||F.zoomMode==="y-only"))F.view.panY+=Y/F.view.zoomY;H=V.clientX,z=V.clientY,C()}}else if(Q.length===2&&j==="pinch"){if(V.pointerType==="touch")V.preventDefault();let D=J.getBoundingClientRect(),f=Q[1].clientX-Q[0].clientX,b=Q[1].clientY-Q[0].clientY,Y=Math.hypot(f,b),X=((Q[0].clientX+Q[1].clientX)/2-D.left)/D.width,x=1-((Q[0].clientY+Q[1].clientY)/2-D.top)/D.height,e=Y-y,a=Math.exp(e/280);if(F.zoomMode!=="none"&&(F.zoomMode==="both"||F.zoomMode==="x-only")){let d=Math.max(A.MIN_ZOOM,Math.min(A.MAX_ZOOM,g*a)),h=F.view.panX+X/F.view.zoomX;F.view.zoomX=d,F.view.panX=h-X/d}if(F.zoomMode!=="none"&&(F.zoomMode==="both"||F.zoomMode==="y-only")){let d=Math.max(A.MIN_ZOOM,Math.min(A.MAX_ZOOM,m*a)),h=F.view.panY+x/F.view.zoomY;F.view.zoomY=d,F.view.panY=h-x/d}C()}},{passive:!1,signal:L.signal});let n=(V)=>{if(Q=Q.filter((T)=>T.pointerId!==V.pointerId),J.releasePointerCapture(V.pointerId),I)clearTimeout(I),I=null;if(Q.length===0){let D=Math.hypot(V.clientX-U,V.clientY-_)<w&&j!=="pan";if(D&&V.pointerType==="touch"){let f=Date.now();if(f-P<300)N.resetView(F.id),P=0;else P=f}if(D&&V.pointerType!=="touch"){let f=Date.now();if(f-P<300)N.resetView(F.id),P=0;else P=f}if(j==="pan"&&(Math.abs(S)>0.001||Math.abs(O)>0.001))i();j="none",F.dragging=!1,M=null}else if(Q.length===1)j="detecting",U=Q[0].clientX,_=Q[0].clientY,H=Q[0].clientX,z=Q[0].clientY};J.addEventListener("pointerup",n,{signal:L.signal}),J.addEventListener("pointercancel",n,{signal:L.signal}),J.addEventListener("wheel",(V)=>{if(V.preventDefault(),F.momentum)cancelAnimationFrame(F.momentum),F.momentum=null;let T=J.getBoundingClientRect(),D=V.clientX-T.left,f=V.clientY-T.top,b=D/T.width,Y=1-f/T.height,X=1-V.deltaY*0.002,x=A.MARGIN,e=D<x.left,a=f>T.height-x.bottom,d,h;if(e)d=!1,h=!0;else if(a)d=!0,h=!1;else d=F.zoomMode==="both"||F.zoomMode==="x-only",h=F.zoomMode==="both"||F.zoomMode==="y-only";if(d){let q0=F.view.panX+b/F.view.zoomX;F.view.zoomX=Math.max(A.MIN_ZOOM,Math.min(A.MAX_ZOOM,F.view.zoomX*X)),F.view.panX=q0-b/F.view.zoomX}if(h){let q0=F.view.panY+Y/F.view.zoomY;F.view.zoomY=Math.max(A.MIN_ZOOM,Math.min(A.MAX_ZOOM,F.view.zoomY*X)),F.view.panY=q0-Y/F.view.zoomY}if(d||h)C()},{passive:!1,signal:L.signal})},uninstall(F){let J=q.get(F);if(J){if(F.momentum)cancelAnimationFrame(F.momentum),F.momentum=null;J.el.style.touchAction=J.originalTouchAction,J.el.style.userSelect=J.originalUserSelect,J.el.style.webkitUserSelect=J.originalWebkitUserSelect,J.abort.abort(),q.delete(F)}}}}var F0=new WeakMap,W0=($,G,q,F,J,K,B,E)=>{$.beginPath(),$.roundRect(G,q,F,J,K),$.fillStyle=B,$.fill(),$.strokeStyle=E,$.lineWidth=1.5,$.stroke()},K0={name:"hover",install($,G){let q=A.getInstance(),F=new AbortController,J={hoverResult:null,pillX:0,pillY:0,pillTargetX:0,pillTargetY:0,pillAnimRef:null,abort:F};F0.set($,J);let K=(E)=>{if($.config.onHover)$.config.onHover(E);if(!($.config.showTooltip??!1))return;if(J.hoverResult=E,q.drawChart($),E&&!J.pillAnimRef){let N=performance.now(),L=(R)=>{if(!J.hoverResult)return J.pillAnimRef=null;let Q=1-Math.pow(0.5,(R-N)/($.config.pillDecayMs??60));N=R,J.pillX+=(J.pillTargetX-J.pillX)*Q,J.pillY+=(J.pillTargetY-J.pillY)*Q,q.drawChart($),J.pillAnimRef=requestAnimationFrame(L)};J.pillAnimRef=requestAnimationFrame(L)}},B=(E,N)=>{if($.dragging)return;let L=G.getBoundingClientRect();K($.findNearestPoint(E-L.left,N-L.top,L.width,L.height))};G.addEventListener("mousemove",(E)=>B(E.clientX,E.clientY),{signal:F.signal}),G.addEventListener("touchmove",(E)=>{if(E.touches.length===1)B(E.touches[0].clientX,E.touches[0].clientY)},{signal:F.signal,passive:!0}),["mouseleave","pointerdown","touchend","touchcancel"].forEach((E)=>G.addEventListener(E,()=>K(null),{signal:F.signal}))},afterDraw($,G){let q=F0.get(G);if(!q?.hoverResult||!G.config.showTooltip)return;let{hoverResult:F}=q,J=G.width,K=G.height,B=A.MARGIN,E=A.getInstance().isDark,{formatX:N=String,formatY:L=String,fontFamily:R=A.DEFAULT_FONT}=G.config,Q=(G.bounds.maxX-G.bounds.minX)/G.view.zoomX,j=(G.bounds.maxY-G.bounds.minY)/G.view.zoomY,U=(F.x-(G.bounds.minX+G.view.panX*(G.bounds.maxX-G.bounds.minX)))/Q*J,_=K*(1-(F.y-(G.bounds.minY+G.view.panY*(G.bounds.maxY-G.bounds.minY)))/j),H=G.series[F.seriesIndex]||G.series[0],z=`${Math.round(H.color.r*255)},${Math.round(H.color.g*255)},${Math.round(H.color.b*255)}`,Z=`rgb(${z})`,W=E?`oklch(from ${Z} calc(l + 0.1) c h)`:Z;$.save(),$.setLineDash([4,3]),$.strokeStyle=`rgba(${z},0.4)`,$.stroke(new Path2D(`M${U} 0V${K-B.bottom}M${B.left} ${_}H${J}`)),$.restore(),$.beginPath(),$.arc(U,_,4.5,0,Math.PI*2),$.fillStyle=Z,$.fill(),$.strokeStyle=E?"rgba(0,0,0,0.6)":"rgba(255,255,255,0.9)",$.stroke();let w=G.series.map((O)=>{let P=0,M=O.rawX.length-1;while(P<=M){let k=P+M>>1;if(Math.abs(O.rawX[k]-F.x)<0.0001)return{label:O.label,val:L(O.rawY[k]),rawVal:O.rawY[k],col:`rgb(${Math.round(O.color.r*255)},${Math.round(O.color.g*255)},${Math.round(O.color.b*255)})`};O.rawX[k]<F.x?P=k+1:M=k-1}return null}).filter(Boolean);w.sort((O,P)=>Math.abs(P.rawVal)-Math.abs(O.rawVal));let u=w.length,I=w.slice(0,5),y=u-I.length;if(q.pillTargetX=U,q.pillTargetY=_,!q.pillAnimRef)q.pillX=U,q.pillY=_;let g=(O,P,M,k)=>{$.font=`600 10px ${R}`;let o=$.measureText(M).width,C=o+12,i=18,n=k?O-C/2:O-C,V=k?P:P-i/2;$.save();let T=k?Math.atan((q.pillTargetX-q.pillX)/80)*0.2:Math.atan((q.pillTargetY-q.pillY)/80)*0.2;$.translate(O,P),$.rotate(T);let D=k?-C/2:-C,f=k?0:-i/2;$.beginPath(),$.roundRect(D,f,C,i,4),$.fillStyle=E?"rgba(0,0,0,0.75)":"rgba(255,255,255,0.75)",$.fill(),$.fillStyle=`rgba(${z},0.2)`,$.fill(),$.strokeStyle=W,$.lineWidth=1.5,$.stroke(),$.fillStyle=W,$.textAlign="center",$.textBaseline="middle",$.fillText(M,D+C/2,f+i/2),$.restore()};g(Math.max(B.left,Math.min(J-B.right,q.pillX)),K-B.bottom+4,N(F.x),!0),g(Math.max(B.left,B.left),Math.max(9,Math.min(K-B.bottom-9,q.pillY)),L(F.y),!1);let m=Math.max(...I.map((O)=>$.measureText(O.label+O.val).width))+40,v=30+I.length*18+(y>0?18:0),p=F.screenX+14,S=F.screenY-v-6;if(p+m>J)p=F.screenX-m-14;if(S=Math.max(4,Math.min(K-v-4,F.screenY-v-6)),W0($,p,S,m,v,6,E?"rgba(28,28,30,0.95)":"rgba(255,255,255,0.96)","rgba(0,0,0,0.08)"),$.textAlign="left",$.textBaseline="middle",$.fillStyle=E?"#888":"#999",$.fillText(N(F.x),p+10,S+15),I.forEach((O,P)=>{let M=S+35+P*18;$.fillStyle=O.col,$.beginPath(),$.roundRect(p+10,M-4,8,8,2),$.fill(),$.fillStyle=E?"#eee":"#1a1a1a",$.fillText(`${O.label}: ${O.val}`,p+24,M)}),y>0){let O=S+35+I.length*18;$.fillStyle=E?"#666":"#aaa",$.fillText(`+${y} more`,p+10,O)}},uninstall($){let G=F0.get($);if(G?.pillAnimRef)cancelAnimationFrame(G.pillAnimRef);G?.abort.abort(),F0.delete($)}};t(B0);t(E0());t(K0);var G0=[],l,s=document.documentElement.classList.contains("dark"),L0=0,U0=new MessageChannel,V0=0,N0=0;U0.port1.onmessage=()=>{L0=performance.now()-V0;let $=performance.now();if($-N0>=120){N0=$;let G=(q)=>q<1?q.toFixed(2)+"ms":q.toFixed(1)+"ms";document.getElementById("main-ms").textContent=G(L0)}};function R0(){requestAnimationFrame(()=>{V0=performance.now(),U0.port2.postMessage(null),R0()})}R0();var f0=new Date("2026-02-03");function T0($,G){let q=new Array($),F=new Array($);if(G==="stock")for(let B=0;B<$;B++)q[B]=$-1-B;else for(let B=0;B<$;B++)q[B]=B;let K=2*Math.PI;switch(G){case"stock":{let E=Math.LN2/5258880,N=-E*3,L=0.0005,R=0.0009000000000000001,Q=$/5258880,j=Math.max(1,Math.round(Q*(0.8+Math.random()*0.4))),U=[];for(let W=0;W<j;W++){let w=Math.floor(Math.random()*$*0.9),u=Math.floor((180+Math.random()*360)*1440);U.push({s:w,e:w+u})}U.sort((W,w)=>W.s-w.s);let _=Math.log(10+Math.random()*20),H=0,z=0,Z=!1;for(let W=0;W<$;W++){while(H<U.length&&W>=U[H].e)H++;let w=H<U.length&&W>=U[H].s&&W<U[H].e,u=w?N:E,I=w?0.0009000000000000001:0.0005,y;if(Z)y=z,Z=!1;else{let g=Math.random()||0.0000000001,m=Math.sqrt(-2*Math.log(g)),v=K*Math.random();y=m*Math.cos(v),z=m*Math.sin(v),Z=!0}_+=u+I*y,F[W]=Math.exp(_)}break}case"trending":{let B=Math.log(20+Math.random()*20),E=Math.LN2/$,N=0.015,L=0,R=!1;for(let Q=0;Q<$;Q++){let j;if(R)j=L,R=!1;else{let U=Math.random()||0.0000000001,_=Math.sqrt(-2*Math.log(U)),H=K*Math.random();j=_*Math.cos(H),L=_*Math.sin(H),R=!0}B+=E+N*j,F[Q]=Math.exp(B)}break}case"declining":{let B=Math.log(60+Math.random()*40),E=-Math.LN2/$,N=0.015,L=0,R=!1;for(let Q=0;Q<$;Q++){let j;if(R)j=L,R=!1;else{let U=Math.random()||0.0000000001,_=Math.sqrt(-2*Math.log(U)),H=K*Math.random();j=_*Math.cos(H),L=_*Math.sin(H),R=!0}B+=E+N*j,F[Q]=Math.exp(B)}break}case"spikey":{let B=20+Math.random()*30,E=3+Math.floor(Math.random()*5),N=new Set;while(N.size<Math.min(E,$))N.add(Math.floor(Math.random()*$));let L=B*1.2,R=B*5;for(let Q=0;Q<$;Q++)if(N.has(Q))F[Q]=Math.random()<0.5?-R:R;else F[Q]=(Math.random()-0.5)*L;break}case"cyclic":{let B=Date.now()%1e5/1e5*K,E=30+Math.random()*20,N=50+Math.random()*20,L=2+Math.random()*4,R=K*L/$,Q=E*0.25;for(let j=0;j<$;j++){let U=j*R+B;F[j]=N+Math.sin(U)*E+Math.sin(U*2.7+1.3)*Q+(Math.random()-0.5)*8}break}}return{x:q,y:F}}function I0($){if($>=1000)return"$"+($/1000).toFixed(1)+"k";return"$"+$.toFixed(2)}function P0($){let G=f0.getTime()-Math.round($)*60000,q=new Date(G),J=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][q.getMonth()],K=q.getDate(),B=q.getFullYear();return`${J} ${K}, ${B}`}function k0($,G,q){let F=(1-Math.abs(2*q-1))*G,J=F*(1-Math.abs($/60%2-1)),K=q-F/2,B=0,E=0,N=0;if($<60)B=F,E=J;else if($<120)B=J,E=F;else if($<180)E=F,N=J;else if($<240)E=J,N=F;else if($<300)B=J,N=F;else B=F,N=J;return{r:B+K,g:E+K,b:N+K}}function M0(){return k0(Math.random()*360,0.65+Math.random()*0.2,0.5+Math.random()*0.1)}function Y0($){if($>=1e6)return($/1e6).toFixed(1)+"M";if($>=1000)return($/1000).toFixed(0)+"k";return $.toString()}function w0($){if(Math.abs($)>=1000)return($/1000).toFixed(1)+"k";if(Math.abs($)>=100)return $.toFixed(0);if(Math.abs($)>=10)return $.toFixed(1);return $.toFixed(2)}function b0($){return Math.round($).toString()}function r($,G,q,F=1){F=Math.max(1,Math.min(1e4,F));let J=[];for(let z=0;z<F;z++){let Z=T0(G,q);if($==="bar"&&q!=="spikey"&&q!=="cyclic")for(let W=0;W<Z.y.length;W++)Z.y[W]=Math.max(0,Z.y[W]);J.push({label:F>1?`Series ${z+1}`:"",color:M0(),x:Z.x,y:Z.y})}let K=q==="stock",B={id:"",type:$,pointCount:G,zoomX:!0,zoomY:!0},E=document.createElement("div");E.className="chart-card";let N=$.charAt(0).toUpperCase()+$.slice(1),L=$==="scatter"?`
      <div class="chart-point-size">
        <input type="range" min="1" max="8" value="3" class="point-size-slider" title="Point size">
        <span class="point-size-label">3px</span>
      </div>`:"",R=F>1?`<span class="chart-card-series">×${F}</span>`:"";E.innerHTML=`
    <div class="chart-card-header">
      <span class="chart-card-title">Chart</span>
      <span class="chart-card-type">${N}</span>
      <span class="chart-card-points">${Y0(G)}</span>${R}${L}
      <div class="chart-zoom-split">
        <button class="zoom-axis-btn active" data-action="toggle-x" title="Toggle X zoom">X</button>
        <button class="zoom-axis-btn active" data-action="toggle-y" title="Toggle Y zoom">Y</button>
      </div>
      <div class="chart-card-actions">
        <button class="chart-action-btn" data-action="reset" title="Reset view">⌘</button>
        <button class="chart-action-btn danger" data-action="remove" title="Remove">×</button>
      </div>
    </div>
    <div class="chart-card-body"></div>
  `,document.getElementById("chart-grid").appendChild(E);let Q=E.querySelector(".chart-card-body"),j={type:$,container:Q,series:J,formatX:K?P0:b0,formatY:K?I0:w0,zoomMode:"both",showTooltip:!0},U;try{U=l.create(j)}catch(z){console.error("Failed to create chart:",z),E.remove();return}B.id=U,E.dataset.id=U,Q.id=`chart-container-${U}`;let _=E.querySelector(".point-size-slider"),H=E.querySelector(".point-size-label");if(_&&H)_.addEventListener("input",()=>{let z=parseInt(_.value);H.textContent=z+"px",l.setPointSize(B.id,z)});E.addEventListener("click",(z)=>{let Z=z.target.closest("[data-action]");if(!Z)return;switch(Z.dataset.action){case"reset":l.resetView(B.id);break;case"remove":A0(B.id);break;case"toggle-x":j0(B,"x",Z,E);break;case"toggle-y":j0(B,"y",Z,E);break}}),G0.push(B)}function A0($){l.destroy($);let G=G0.findIndex((F)=>F.id===$);if(G>=0)G0.splice(G,1);let q=document.querySelector(`.chart-card[data-id="${$}"]`);if(q)q.remove()}function j0($,G,q,F){if(G==="x")$.zoomX=!$.zoomX;else $.zoomY=!$.zoomY;let J=F.querySelector('[data-action="toggle-x"]'),K=F.querySelector('[data-action="toggle-y"]');J.classList.toggle("active",$.zoomX),K.classList.toggle("active",$.zoomY);let B;if($.zoomX&&$.zoomY)B="both";else if($.zoomX)B="x-only";else if($.zoomY)B="y-only";else B="none";l.setZoomMode($.id,B)}function S0(){let $=document.getElementById("theme-btn"),G=document.getElementById("theme-icon-sun"),q=document.getElementById("theme-icon-moon"),F=()=>{G.style.display=s?"none":"block",q.style.display=s?"block":"none"};F(),$.addEventListener("click",()=>{s=!s,document.documentElement.classList.toggle("dark",s),localStorage.setItem("theme",s?"dark":"light"),l.setTheme(s),F()})}async function X0(){if(l=A.getInstance(),!await l.init()){let G=document.getElementById("error-toast");G.textContent="WebGPU not available. Please use a supported browser.",G.classList.remove("hidden");return}l.onStats((G)=>{document.getElementById("active").textContent=G.active.toString(),document.getElementById("total").textContent=G.total.toString()}),S0(),C0(),setTimeout(()=>{r("scatter",500,"stock",1),r("line",300,"trending",3),r("bar",100,"spikey",1),r("line",200,"cyclic",1)},100)}function C0(){let $=document.getElementById("chart-type"),G=document.getElementById("point-count"),q=document.getElementById("pattern"),F=document.getElementById("sync-toggle"),J=document.getElementById("sync-label"),K=document.getElementById("series-count");document.getElementById("add-chart").addEventListener("click",()=>{let B=$.value,E=parseInt(G.value)||500,N=q.value,L=Math.max(1,Math.min(1e4,parseInt(K.value)||3));r(B,E,N,L)}),document.getElementById("add-batch").addEventListener("click",()=>{let B=$.value,E=parseInt(G.value)||500,N=q.value,L=Math.max(1,Math.min(1e4,parseInt(K.value)||3));for(let R=0;R<5;R++)setTimeout(()=>{r(B,E,N,L)},R*100)}),document.getElementById("clear-all").addEventListener("click",()=>{for(let B of[...G0])A0(B.id)}),F.addEventListener("change",()=>{let B=F.checked;l.setSyncViews(B),J.textContent=B?"Synced":"Sync Off"})}if(location.hostname==="localhost"||location.hostname==="127.0.0.1"){let $=new WebSocket(`ws://${location.host}/__hot`);$.onmessage=(G)=>{if(G.data==="reload")location.reload()}}X0();
