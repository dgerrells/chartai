var V0=Object.create;var{getPrototypeOf:j0,defineProperty:a,getOwnPropertyNames:A0}=Object;var U0=Object.prototype.hasOwnProperty;var R0=($,F,G)=>{G=$!=null?V0(j0($)):{};let E=F||!$||!$.__esModule?a(G,"default",{value:$,enumerable:!0}):G;for(let q of A0($))if(!U0.call(E,q))a(E,q,{get:()=>$[q],enumerable:!0});return E};var O0=(($)=>typeof require!=="undefined"?require:typeof Proxy!=="undefined"?new Proxy($,{get:(F,G)=>(typeof require!=="undefined"?require:F)[G]}):$)(function($){if(typeof require!=="undefined")return require.apply(this,arguments);throw Error('Dynamic require of "'+$+'" is not supported')});var d=[];function i($){if(!d.some((F)=>F.name===$.name))d.push($)}class D{static instance=null;static MARGIN={left:55,right:10,top:8,bottom:45};static HOVER_MAX_DISTANCE_PX=50;static MIN_ZOOM=0.1;static MAX_ZOOM=1e7;static DEFAULT_LABEL_SIZE=12;static DEFAULT_FONT='-apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif';static resizeCanvas($,F,G){let E=devicePixelRatio||1;if($.width=Math.round(F*E),$.height=Math.round(G*E),$ instanceof HTMLCanvasElement)$.style.width=`${F}px`,$.style.height=`${G}px`}worker=null;charts=new Map;chartIdCounter=0;_syncViews=!1;_isDark=!1;statsCallbacks=[];currentStats={fps:0,renderMs:0,total:0,active:0};visibilityObserver;resizeObserver;constructor(){this._isDark=document.documentElement.classList.contains("dark"),this.visibilityObserver=new IntersectionObserver(($)=>{for(let F of $){let G=F.target.dataset.chartId;if(G){let E=this.charts.get(G);if(E){if(E.visible=F.isIntersecting,this.worker?.postMessage({type:"set-visibility",id:G,visible:F.isIntersecting}),F.isIntersecting)this.drawChart(E)}}}},{threshold:0.01}),this.resizeObserver=new ResizeObserver(($)=>{for(let F of $){let G=F.target.dataset.chartId;if(!G)continue;let E=this.charts.get(G);if(!E)continue;let{width:q,height:L}=F.contentRect;if(q<=0||L<=0)continue;E.width=q,E.height=L;let J=devicePixelRatio||1;this.worker?.postMessage({type:"resize",id:G,width:Math.round(q*J),height:Math.round(L*J)}),D.resizeCanvas(E.backCanvas,q,L),D.resizeCanvas(E.axisCanvas,q,L),this.drawChart(E)}})}static getInstance(){if(!D.instance)D.instance=new D;return D.instance}get isDark(){return this._isDark}get syncViews(){return this._syncViews}async init(){if(this.worker)return!0;return new Promise(($)=>{import("./worker-inline.js").then(({WORKER_CODE:F})=>{let G=new Blob([F],{type:"application/javascript"}),E=URL.createObjectURL(G);this.worker=new Worker(E,{type:"module"}),this.setupWorkerHandlers($)}).catch(()=>{let F=new URL("./gpu-worker.js",import.meta.url);this.worker=new Worker(F,{type:"module"}),this.setupWorkerHandlers($)})})}setupWorkerHandlers($){if(!this.worker)return;this.worker.onmessage=(F)=>{let{type:G,...E}=F.data;switch(G){case"gpu-ready":$(!0);break;case"error":console.error("ChartManager GPU Error:",E.message),$(!1);break;case"stats":this.currentStats={fps:E.fps,renderMs:E.renderMs,total:E.totalCharts,active:E.activeCharts};for(let q of this.statsCallbacks)q(this.currentStats);break;case"bounds-update":{let q=this.charts.get(E.id);if(q)q.bounds={minX:E.minX,maxX:E.maxX,minY:E.minY,maxY:E.maxY},this.drawChart(q);break}default:break}},this.worker.onerror=(F)=>{console.error("ChartManager Worker Error:",F),$(!1)},this.worker.postMessage({type:"init",isDark:this._isDark})}create($){if(!this.worker)throw new Error("ChartManager not initialized. Call init() first.");let F=`chart-${++this.chartIdCounter}`,G=document.createElement("div");G.dataset.chartId=F,G.style.cssText="width: 100%; height: 100%; position: relative;";let E=document.createElement("div");E.dataset.chartId=F,E.style.cssText="width: 100%; height: 100%; position: relative;";let q=document.createElement("canvas");q.style.cssText="position: absolute; inset: 0; width: 100%; height: 100%; pointer-events: none;";let L=document.createElement("canvas");L.style.cssText="position: absolute; inset: 0; width: 100%; height: 100%; pointer-events: auto; z-index: 1;";let J=document.createElement("canvas");J.style.cssText="position: absolute; inset: 0; width: 100%; height: 100%; pointer-events: none; z-index: 2;",E.appendChild(q),E.appendChild(L),E.appendChild(J),G.appendChild(E),$.container.appendChild(G);let B;try{B=L.transferControlToOffscreen()}catch(j){throw console.error(`ChartManager: Failed to create offscreen canvas for ${F}:`,j),new Error(`Failed to create chart ${F}: ${j}`)}let V=E.getBoundingClientRect(),K=V.width||400,N=V.height||200;if(D.resizeCanvas(B,K,N),D.resizeCanvas(q,K,N),D.resizeCanvas(J,K,N),$.bgColor){let[j,H,_]=$.bgColor;E.style.background=`rgb(${Math.round(j*255)},${Math.round(H*255)},${Math.round(_*255)})`}let Q={id:F,config:$,el:G,backCanvas:q,axisCanvas:J,width:K,height:N,series:[],bounds:{minX:0,maxX:1,minY:0,maxY:1},view:{panX:0,panY:0,zoomX:1,zoomY:1},zoomMode:$.zoomMode||"both",visible:!0,dragging:!1,bgColor:$.bgColor,textColor:$.textColor,gridColor:$.gridColor,fontFamily:$.fontFamily,momentum:null,findNearestPoint(j,H,_,T){if(this.series.length===0)return null;let Z=j/_,O=H/T,S=this.bounds.maxX-this.bounds.minX,X=this.bounds.maxY-this.bounds.minY,Y=S/this.view.zoomX,b=X/this.view.zoomY,y=this.bounds.minX+this.view.panX*S,C=this.bounds.minY+this.view.panY*X,M=y+Z*Y,A=C+(1-O)*b,z=-1,R=-1,W=1/0,I=1/0;for(let p=0;p<this.series.length;p++){let v=this.series[p],u=v.rawX.length;if(u===0)continue;let P=0,l=u-1;while(P<l){let h=P+l>>1;if(v.rawX[h]<M)P=h+1;else l=h}let n=P;if(P>0){let h=Math.abs(v.rawX[P]-M);if(Math.abs(v.rawX[P-1]-M)<h)n=P-1}let r=Math.abs(v.rawX[n]-M),t=Math.abs(v.rawY[n]-A);if(r<W||r===W&&t<I)W=r,I=t,z=p,R=n}if(z===-1)return null;let f=this.series[z],k=(f.rawX[R]-y)/Y*_;if(Math.abs(k-j)>D.HOVER_MAX_DISTANCE_PX)return null;return{x:f.rawX[R],y:f.rawY[R],index:R,screenX:j,screenY:H,seriesIndex:z,seriesLabel:f.label}}};this.charts.set(F,Q);let U=$.type==="bar"?"box":$.type;this.worker.postMessage({type:"register-chart",id:F,canvas:B,chartType:U,pointSize:$.pointSize??3,maxSamplesPerPixel:$.maxSamplesPerPixel??1e4,bgColor:$.bgColor??null},[B]),this.visibilityObserver.observe(G),this.resizeObserver.observe(E);for(let j of d)j.install?.(Q,E);return this.updateSeries(F,$.series),F}destroy($){let F=this.charts.get($);if(!F)return;for(let E of d)E.uninstall?.(F);if(F.momentum)cancelAnimationFrame(F.momentum);this.visibilityObserver.unobserve(F.el);let G=F.el.querySelector(".gpu-chart-canvas-wrap");if(G)this.resizeObserver.unobserve(G);F.el.remove(),this.worker?.postMessage({type:"unregister-chart",id:$}),this.charts.delete($)}updateSeries($,F){let G=this.charts.get($);if(!G||!this.worker)return;if(F.length===0)return;G.series=F.map((Q)=>{let U=Q.x.length;if(U===0)return{label:Q.label,color:Q.color,rawX:[],rawY:[]};let j=Array.from({length:U},(H,_)=>_);return j.sort((H,_)=>Q.x[H]-Q.x[_]),{label:Q.label,color:Q.color,rawX:j.map((H)=>Q.x[H]),rawY:j.map((H)=>Q.y[H])}});let E=1/0,q=-1/0,L=1/0,J=-1/0;for(let Q of G.series)for(let U=0;U<Q.rawX.length;U++){if(Q.rawX[U]<E)E=Q.rawX[U];if(Q.rawX[U]>q)q=Q.rawX[U];if(Q.rawY[U]<L)L=Q.rawY[U];if(Q.rawY[U]>J)J=Q.rawY[U]}let B=(q-E)*0.05||1,V=(J-L)*0.1||1;E-=B,q+=B,L-=V,J+=V;let K=G.config.defaultBounds;if(K){if(K.minX!==void 0)E=K.minX;if(K.maxX!==void 0)q=K.maxX;if(K.minY!==void 0)L=K.minY;if(K.maxY!==void 0)J=K.maxY}G.bounds={minX:E,maxX:q,minY:L,maxY:J};let N=G.series.map((Q)=>({label:Q.label,colorR:Q.color.r,colorG:Q.color.g,colorB:Q.color.b,dataX:new Float32Array(Q.rawX),dataY:new Float32Array(Q.rawY)}));this.worker.postMessage({type:"update-series",id:$,series:N,bounds:G.bounds},N.flatMap((Q)=>[Q.dataX.buffer,Q.dataY.buffer])),this.sendViewTransform(G),this.drawChart(G)}setPointSize($,F){if(!this.charts.get($))return;this.worker?.postMessage({type:"set-point-size",id:$,pointSize:Math.max(1,Math.min(8,Math.round(F)))})}setMaxSamplesPerPixel($,F){if(!this.charts.get($))return;this.worker?.postMessage({type:"set-max-samples",id:$,maxSamplesPerPixel:Math.max(0,F|0)})}setStyle($,F){let G=this.charts.get($);if(!G)return;if(F.bgColor!==void 0)G.bgColor=F.bgColor;if(F.textColor!==void 0)G.textColor=F.textColor;if(F.gridColor!==void 0)G.gridColor=F.gridColor;if(F.fontFamily!==void 0)G.fontFamily=F.fontFamily;if(F.bgColor!==void 0){let E=G.el.querySelector(".gpu-chart-canvas-wrap");if(E){let[q,L,J]=F.bgColor;E.style.background=`rgb(${Math.round(q*255)},${Math.round(L*255)},${Math.round(J*255)})`}this.worker?.postMessage({type:"set-style",id:$,bgColor:F.bgColor})}this.drawChart(G)}setZoomMode($,F){let G=this.charts.get($);if(G)G.zoomMode=F}getChartCount(){return this.charts.size}getZoomMode($){return this.charts.get($)?.zoomMode||"both"}setSyncViews($){this._syncViews=$}setTheme($){this._isDark=$,this.worker?.postMessage({type:"theme",isDark:$});for(let F of this.charts.values())this.drawChart(F)}onStats($){return this.statsCallbacks.push($),()=>{let F=this.statsCallbacks.indexOf($);if(F>=0)this.statsCallbacks.splice(F,1)}}getStats(){return{...this.currentStats}}resetView($){let F=this.charts.get($);if(!F)return;if(F.momentum)cancelAnimationFrame(F.momentum),F.momentum=null;let G=F.view.panX,E=F.view.panY,q=F.view.zoomX,L=F.view.zoomY,J=performance.now(),B=()=>{let V=Math.min(1,(performance.now()-J)/300),K=1-Math.pow(1-V,3);if(F.view.panX=G*(1-K),F.view.panY=E*(1-K),F.view.zoomX=q+(1-q)*K,F.view.zoomY=L+(1-L)*K,this.sendViewTransform(F),this.drawChart(F),this._syncViews)this.syncAllViews(F);if(V<1)requestAnimationFrame(B)};requestAnimationFrame(B)}sendViewTransform($){this.worker?.postMessage({type:"view-transform",id:$.id,panX:$.view.panX,panY:$.view.panY,zoomX:$.view.zoomX,zoomY:$.view.zoomY})}syncAllViews($){let F=[];for(let G of this.charts.values())if(G.id!==$.id)G.view={...$.view},F.push({id:G.id}),this.drawChart(G);if(F.length>0)this.worker?.postMessage({type:"batch-view-transform",panX:$.view.panX,panY:$.view.panY,zoomX:$.view.zoomX,zoomY:$.view.zoomY,transforms:F})}drawChart($){if(!$.visible)return;let F=devicePixelRatio||1,G=$.backCanvas.getContext("2d");if(G){G.clearRect(0,0,$.backCanvas.width,$.backCanvas.height),G.save(),G.scale(F,F);for(let q of d)q.beforeDraw?.(G,$);G.restore()}let E=$.axisCanvas.getContext("2d");if(E){E.clearRect(0,0,$.axisCanvas.width,$.axisCanvas.height),E.save(),E.scale(F,F);for(let q of d)q.afterDraw?.(E,$);E.restore()}}}var s=($,F,G)=>{let E=F-$;if(E<=0)return[$];let q=E/G,L=10**Math.floor(Math.log10(q)),J=q/L,B=L*(J<=1.5?1:J<=3?2:J<=7?5:10),V=[];for(let K=Math.ceil($/B)*B;K<=F;K+=B)V.push(K);return V},$0=($)=>{let F=D.getInstance(),G=$.width,E=$.height,q=D.MARGIN,{bounds:L,view:J}=$,B=L.maxX-L.minX,V=L.maxY-L.minY,K=B/J.zoomX,N=V/J.zoomY,Q=L.minX+J.panX*B,U=L.minY+J.panY*V,j=$.bgColor??(F.isDark?[0.11,0.11,0.12]:[0.98,0.98,0.98]);return{w:G,h:E,m:q,rx:K,ry:N,mx:Q,my:U,bg:`${Math.round(j[0]*255)},${Math.round(j[1]*255)},${Math.round(j[2]*255)}`,font:$.fontFamily??D.DEFAULT_FONT,text:$.textColor??(F.isDark?"#c0c0c0":"#333333"),grid:$.gridColor??(F.isDark?"rgba(255,255,255,0.06)":"rgba(0,0,0,0.06)")}},E0={name:"labels",beforeDraw($,F){let{w:G,h:E,m:q,rx:L,ry:J,mx:B,my:V,grid:K}=$0(F);$.strokeStyle=K,$.lineWidth=1,$.beginPath(),s(V,V+J,7).forEach((N)=>{let Q=E*(1-(N-V)/J);if(Q>5&&Q<E-q.bottom-5)$.moveTo(q.left,Q),$.lineTo(G,Q)}),s(B,B+L,8).forEach((N)=>{let Q=G*((N-B)/L);if(Q>q.left&&Q<G)$.moveTo(Q,0),$.lineTo(Q,E-q.bottom)}),$.stroke()},afterDraw($,F){let{w:G,h:E,m:q,rx:L,ry:J,mx:B,my:V,bg:K,font:N,text:Q}=$0(F),{formatX:U=String,formatY:j=String,labelSize:H=D.DEFAULT_LABEL_SIZE}=F.config,_=(T,Z,O,S,X)=>{let Y=T==="left"?$.createLinearGradient(Z,0,Z+S,0):$.createLinearGradient(0,O,0,O+X),b=T==="left"?[1,0.7,0.2,0.05,0]:[0,0.05,0.2,0.7,1];[0,0.35,0.55,0.7,1].forEach((y,C)=>Y.addColorStop(y,`rgba(${K},${b[C]})`)),$.fillStyle=Y,$.fillRect(Z,O,S,X)};_("left",0,0,q.left+20,E),_("bottom",0,E-q.bottom-20,G,q.bottom+20),$.font=`${H}px ${N}`,$.fillStyle=Q,$.textAlign="right",$.textBaseline="middle",s(V,V+J,7).forEach((T)=>{let Z=E*(1-(T-V)/J);if(Z>5&&Z<E-q.bottom-5)$.fillText(j(T),q.left-5,Z)}),$.textAlign="right",$.textBaseline="top",s(B,B+L,8).forEach((T)=>{let Z=G*((T-B)/L);if(Z<q.left-10||Z>G+30)return;$.save(),$.translate(Z,E-q.bottom+5),$.rotate(-Math.PI/14),$.fillText(U(T),0,0),$.restore()})}};function F0($={}){let F=$.momentumDecay??0.91,G=new WeakMap;return{name:"zoom",install(E,q){let L=q.style.touchAction,J=q.style.userSelect,B=q.style.webkitUserSelect;q.style.touchAction="pan-x pan-y",q.style.userSelect="none",q.style.webkitUserSelect="none";let V=D.getInstance(),K=new AbortController,N={lastX:0,lastY:0,velX:0,velY:0,abort:K,originalTouchAction:L,originalUserSelect:J,originalWebkitUserSelect:B,el:q};G.set(E,N);let Q=[],U=0,j=0,H=1,_=1,T=0.5,Z=0.5,O=null,S=!1,X=500,Y=()=>{if(V.sendViewTransform(E),V.drawChart(E),V.syncViews)V.syncAllViews(E)},b=()=>{if(E.momentum)cancelAnimationFrame(E.momentum);let A=()=>{if(N.velX*=F,N.velY*=F,Math.abs(N.velX)>0.00005||Math.abs(N.velY)>0.00005){if(E.zoomMode!=="none"&&(E.zoomMode==="both"||E.zoomMode==="x-only"))E.view.panX-=N.velX/E.view.zoomX;if(E.zoomMode!=="none"&&(E.zoomMode==="both"||E.zoomMode==="y-only"))E.view.panY+=N.velY/E.view.zoomY;Y(),E.momentum=requestAnimationFrame(A)}else E.momentum=null};E.momentum=requestAnimationFrame(A)},y=(A)=>{if(E.dragging&&Q.length===0)E.dragging=!1};q.addEventListener("pointerdown",(A)=>{if(E.momentum)cancelAnimationFrame(E.momentum),E.momentum=null;if(Q.push(A),q.setPointerCapture(A.pointerId),Q.length===1){if(E.dragging=!0,N.lastX=A.clientX,N.lastY=A.clientY,N.velX=N.velY=0,U=performance.now(),S=!1,A.pointerType==="touch")O=window.setTimeout(()=>{S=!0,E.dragging=!1},X)}else if(Q.length===2){if(O)clearTimeout(O),O=null;if(S=!1,A.pointerType==="touch")A.preventDefault();let z=q.getBoundingClientRect(),R=Q[1].clientX-Q[0].clientX,W=Q[1].clientY-Q[0].clientY;j=Math.hypot(R,W),H=E.view.zoomX,_=E.view.zoomY,T=((Q[0].clientX+Q[1].clientX)/2-z.left)/z.width,Z=1-((Q[0].clientY+Q[1].clientY)/2-z.top)/z.height}},{passive:!1,signal:K.signal}),q.addEventListener("pointermove",(A)=>{let z=Q.findIndex((R)=>R.pointerId===A.pointerId);if(z>=0)Q[z]=A;if(Q.length===1&&E.dragging){let R=q.getBoundingClientRect(),W=(A.clientX-N.lastX)/R.width,I=(A.clientY-N.lastY)/R.height,f=0.005;if(O&&(Math.abs(W)>0.005||Math.abs(I)>0.005))clearTimeout(O),O=null;if(S){N.lastX=A.clientX,N.lastY=A.clientY;return}if(A.pointerType==="touch")A.preventDefault();let w=performance.now();if(w-U<100)N.velX=N.velX*0.5+W*0.5,N.velY=N.velY*0.5+I*0.5;if(U=w,E.zoomMode!=="none"&&(E.zoomMode==="both"||E.zoomMode==="x-only"))E.view.panX-=W/E.view.zoomX;if(E.zoomMode!=="none"&&(E.zoomMode==="both"||E.zoomMode==="y-only"))E.view.panY+=I/E.view.zoomY;N.lastX=A.clientX,N.lastY=A.clientY,Y()}else if(Q.length===2){if(A.pointerType==="touch")A.preventDefault();let R=Q[1].clientX-Q[0].clientX,W=Q[1].clientY-Q[0].clientY,f=Math.hypot(R,W)/j;if(E.zoomMode!=="none"&&(E.zoomMode==="both"||E.zoomMode==="x-only")){let w=Math.max(D.MIN_ZOOM,Math.min(D.MAX_ZOOM,H*f)),k=E.view.panX+T/H;E.view.zoomX=w,E.view.panX=k-T/w}if(E.zoomMode!=="none"&&(E.zoomMode==="both"||E.zoomMode==="y-only")){let w=Math.max(D.MIN_ZOOM,Math.min(D.MAX_ZOOM,_*f)),k=E.view.panY+Z/_;E.view.zoomY=w,E.view.panY=k-Z/w}Y()}},{passive:!1,signal:K.signal});let C=(A)=>{if(Q=Q.filter((z)=>z.pointerId!==A.pointerId),q.releasePointerCapture(A.pointerId),O)clearTimeout(O),O=null;if(Q.length===0){if(S=!1,E.dragging){if(E.dragging=!1,!S&&(Math.abs(N.velX)>0.001||Math.abs(N.velY)>0.001))b()}}};q.addEventListener("pointerup",C,{signal:K.signal}),q.addEventListener("pointercancel",C,{signal:K.signal}),q.addEventListener("pointerleave",y,{signal:K.signal});let M=0;q.addEventListener("pointerup",(A)=>{if(Q.length===1&&A.pointerType==="touch"){let z=Date.now();if(z-M<300)V.resetView(E.id),M=0;else M=z}else if(A.pointerType!=="touch"){let z=Date.now();if(z-M<300)V.resetView(E.id),M=0;else M=z}},{signal:K.signal}),q.addEventListener("wheel",(A)=>{if(A.preventDefault(),E.momentum)cancelAnimationFrame(E.momentum),E.momentum=null;let z=q.getBoundingClientRect(),R=A.clientX-z.left,W=A.clientY-z.top,I=R/z.width,f=1-W/z.height,w=1-A.deltaY*0.002,k=D.MARGIN,g=R<k.left,p=W>z.height-k.bottom,v,u;if(g)v=!1,u=!0;else if(p)v=!0,u=!1;else v=E.zoomMode==="both"||E.zoomMode==="x-only",u=E.zoomMode==="both"||E.zoomMode==="y-only";if(v){let P=E.view.panX+I/E.view.zoomX;E.view.zoomX=Math.max(D.MIN_ZOOM,Math.min(D.MAX_ZOOM,E.view.zoomX*w)),E.view.panX=P-I/E.view.zoomX}if(u){let P=E.view.panY+f/E.view.zoomY;E.view.zoomY=Math.max(D.MIN_ZOOM,Math.min(D.MAX_ZOOM,E.view.zoomY*w)),E.view.panY=P-f/E.view.zoomY}if(v||u)Y()},{passive:!1,signal:K.signal})},uninstall(E){let q=G.get(E);if(q){if(E.momentum)cancelAnimationFrame(E.momentum),E.momentum=null;q.el.style.touchAction=q.originalTouchAction,q.el.style.userSelect=q.originalUserSelect,q.el.style.webkitUserSelect=q.originalWebkitUserSelect,q.abort.abort(),G.delete(E)}}}}var c=new WeakMap,Z0=($,F,G,E,q,L,J,B)=>{$.beginPath(),$.roundRect(F,G,E,q,L),$.fillStyle=J,$.fill(),$.strokeStyle=B,$.lineWidth=1.5,$.stroke()},G0={name:"hover",install($,F){let G=D.getInstance(),E=new AbortController,q={hoverResult:null,pillX:0,pillY:0,pillTargetX:0,pillTargetY:0,pillAnimRef:null,abort:E};c.set($,q);let L=(B)=>{if($.config.onHover)$.config.onHover(B);if(!($.config.showTooltip??!1))return;if(q.hoverResult=B,G.drawChart($),B&&!q.pillAnimRef){let V=performance.now(),K=(N)=>{if(!q.hoverResult)return q.pillAnimRef=null;let Q=1-Math.pow(0.5,(N-V)/($.config.pillDecayMs??60));V=N,q.pillX+=(q.pillTargetX-q.pillX)*Q,q.pillY+=(q.pillTargetY-q.pillY)*Q,G.drawChart($),q.pillAnimRef=requestAnimationFrame(K)};q.pillAnimRef=requestAnimationFrame(K)}},J=(B,V)=>{if($.dragging)return;let K=F.getBoundingClientRect();L($.findNearestPoint(B-K.left,V-K.top,K.width,K.height))};F.addEventListener("mousemove",(B)=>J(B.clientX,B.clientY),{signal:E.signal}),F.addEventListener("touchmove",(B)=>{if(B.touches.length===1)J(B.touches[0].clientX,B.touches[0].clientY)},{signal:E.signal,passive:!0}),["mouseleave","pointerdown","touchend","touchcancel"].forEach((B)=>F.addEventListener(B,()=>L(null),{signal:E.signal}))},afterDraw($,F){let G=c.get(F);if(!G?.hoverResult||!F.config.showTooltip)return;let{hoverResult:E}=G,q=F.width,L=F.height,J=D.MARGIN,B=D.getInstance().isDark,{formatX:V=String,formatY:K=String,fontFamily:N=D.DEFAULT_FONT}=F.config,Q=(F.bounds.maxX-F.bounds.minX)/F.view.zoomX,U=(F.bounds.maxY-F.bounds.minY)/F.view.zoomY,j=(E.x-(F.bounds.minX+F.view.panX*(F.bounds.maxX-F.bounds.minX)))/Q*q,H=L*(1-(E.y-(F.bounds.minY+F.view.panY*(F.bounds.maxY-F.bounds.minY)))/U),_=F.series[E.seriesIndex]||F.series[0],T=`${Math.round(_.color.r*255)},${Math.round(_.color.g*255)},${Math.round(_.color.b*255)}`,Z=`rgb(${T})`,O=B?`oklch(from ${Z} calc(l + 0.1) c h)`:Z;$.save(),$.setLineDash([4,3]),$.strokeStyle=`rgba(${T},0.4)`,$.stroke(new Path2D(`M${j} 0V${L-J.bottom}M${J.left} ${H}H${q}`)),$.restore(),$.beginPath(),$.arc(j,H,4.5,0,Math.PI*2),$.fillStyle=Z,$.fill(),$.strokeStyle=B?"rgba(0,0,0,0.6)":"rgba(255,255,255,0.9)",$.stroke();let S=F.series.map((R)=>{let W=0,I=R.rawX.length-1;while(W<=I){let f=W+I>>1;if(Math.abs(R.rawX[f]-E.x)<0.0001)return{label:R.label,val:K(R.rawY[f]),rawVal:R.rawY[f],col:`rgb(${Math.round(R.color.r*255)},${Math.round(R.color.g*255)},${Math.round(R.color.b*255)})`};R.rawX[f]<E.x?W=f+1:I=f-1}return null}).filter(Boolean);S.sort((R,W)=>Math.abs(W.rawVal)-Math.abs(R.rawVal));let X=S.length,Y=S.slice(0,5),b=X-Y.length;if(G.pillTargetX=j,G.pillTargetY=H,!G.pillAnimRef)G.pillX=j,G.pillY=H;let y=(R,W,I,f)=>{$.font=`600 10px ${N}`;let w=$.measureText(I).width,k=w+12,g=18,p=f?R-k/2:R-k,v=f?W:W-g/2;$.save();let u=f?Math.atan((G.pillTargetX-G.pillX)/80)*0.2:Math.atan((G.pillTargetY-G.pillY)/80)*0.2;$.translate(R,W),$.rotate(u);let P=f?-k/2:-k,l=f?0:-g/2;$.beginPath(),$.roundRect(P,l,k,g,4),$.fillStyle=B?"rgba(0,0,0,0.75)":"rgba(255,255,255,0.75)",$.fill(),$.fillStyle=`rgba(${T},0.2)`,$.fill(),$.strokeStyle=O,$.lineWidth=1.5,$.stroke(),$.fillStyle=O,$.textAlign="center",$.textBaseline="middle",$.fillText(I,P+k/2,l+g/2),$.restore()};y(Math.max(J.left,Math.min(q-J.right,G.pillX)),L-J.bottom+4,V(E.x),!0),y(Math.max(J.left,J.left),Math.max(9,Math.min(L-J.bottom-9,G.pillY)),K(E.y),!1);let C=Math.max(...Y.map((R)=>$.measureText(R.label+R.val).width))+40,M=30+Y.length*18+(b>0?18:0),A=E.screenX+14,z=E.screenY-M-6;if(A+C>q)A=E.screenX-C-14;if(z=Math.max(4,Math.min(L-M-4,E.screenY-M-6)),Z0($,A,z,C,M,6,B?"rgba(28,28,30,0.95)":"rgba(255,255,255,0.96)","rgba(0,0,0,0.08)"),$.textAlign="left",$.textBaseline="middle",$.fillStyle=B?"#888":"#999",$.fillText(V(E.x),A+10,z+15),Y.forEach((R,W)=>{let I=z+35+W*18;$.fillStyle=R.col,$.beginPath(),$.roundRect(A+10,I-4,8,8,2),$.fill(),$.fillStyle=B?"#eee":"#1a1a1a",$.fillText(`${R.label}: ${R.val}`,A+24,I)}),b>0){let R=z+35+Y.length*18;$.fillStyle=B?"#666":"#aaa",$.fillText(`+${b} more`,A+10,R)}},uninstall($){let F=c.get($);if(F?.pillAnimRef)cancelAnimationFrame(F.pillAnimRef);F?.abort.abort(),c.delete($)}};i(E0);i(F0());i(G0);var e=[],m,x=document.documentElement.classList.contains("dark"),q0=0,B0=new MessageChannel,L0=0,J0=0;B0.port1.onmessage=()=>{q0=performance.now()-L0;let $=performance.now();if($-J0>=120){J0=$;let F=(G)=>G<1?G.toFixed(2)+"ms":G.toFixed(1)+"ms";document.getElementById("main-ms").textContent=F(q0)}};function K0(){requestAnimationFrame(()=>{L0=performance.now(),B0.port2.postMessage(null),K0()})}K0();var H0=new Date("2026-02-03");function _0($,F){let G=new Array($),E=new Array($);if(F==="stock")for(let J=0;J<$;J++)G[J]=$-1-J;else for(let J=0;J<$;J++)G[J]=J;let L=2*Math.PI;switch(F){case"stock":{let B=Math.LN2/5258880,V=-B*3,K=0.0005,N=0.0009000000000000001,Q=$/5258880,U=Math.max(1,Math.round(Q*(0.8+Math.random()*0.4))),j=[];for(let O=0;O<U;O++){let S=Math.floor(Math.random()*$*0.9),X=Math.floor((180+Math.random()*360)*1440);j.push({s:S,e:S+X})}j.sort((O,S)=>O.s-S.s);let H=Math.log(10+Math.random()*20),_=0,T=0,Z=!1;for(let O=0;O<$;O++){while(_<j.length&&O>=j[_].e)_++;let S=_<j.length&&O>=j[_].s&&O<j[_].e,X=S?V:B,Y=S?0.0009000000000000001:0.0005,b;if(Z)b=T,Z=!1;else{let y=Math.random()||0.0000000001,C=Math.sqrt(-2*Math.log(y)),M=L*Math.random();b=C*Math.cos(M),T=C*Math.sin(M),Z=!0}H+=X+Y*b,E[O]=Math.exp(H)}break}case"trending":{let J=Math.log(20+Math.random()*20),B=Math.LN2/$,V=0.015,K=0,N=!1;for(let Q=0;Q<$;Q++){let U;if(N)U=K,N=!1;else{let j=Math.random()||0.0000000001,H=Math.sqrt(-2*Math.log(j)),_=L*Math.random();U=H*Math.cos(_),K=H*Math.sin(_),N=!0}J+=B+V*U,E[Q]=Math.exp(J)}break}case"declining":{let J=Math.log(60+Math.random()*40),B=-Math.LN2/$,V=0.015,K=0,N=!1;for(let Q=0;Q<$;Q++){let U;if(N)U=K,N=!1;else{let j=Math.random()||0.0000000001,H=Math.sqrt(-2*Math.log(j)),_=L*Math.random();U=H*Math.cos(_),K=H*Math.sin(_),N=!0}J+=B+V*U,E[Q]=Math.exp(J)}break}case"spikey":{let J=20+Math.random()*30,B=3+Math.floor(Math.random()*5),V=new Set;while(V.size<Math.min(B,$))V.add(Math.floor(Math.random()*$));let K=J*1.2,N=J*5;for(let Q=0;Q<$;Q++)if(V.has(Q))E[Q]=Math.random()<0.5?-N:N;else E[Q]=(Math.random()-0.5)*K;break}case"cyclic":{let J=Date.now()%1e5/1e5*L,B=30+Math.random()*20,V=50+Math.random()*20,K=2+Math.random()*4,N=L*K/$,Q=B*0.25;for(let U=0;U<$;U++){let j=U*N+J;E[U]=V+Math.sin(j)*B+Math.sin(j*2.7+1.3)*Q+(Math.random()-0.5)*8}break}}return{x:G,y:E}}function D0($){if($>=1000)return"$"+($/1000).toFixed(1)+"k";return"$"+$.toFixed(2)}function T0($){let F=H0.getTime()-Math.round($)*60000,G=new Date(F),q=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][G.getMonth()],L=G.getDate(),J=G.getFullYear();return`${q} ${L}, ${J}`}function z0($,F,G){let E=(1-Math.abs(2*G-1))*F,q=E*(1-Math.abs($/60%2-1)),L=G-E/2,J=0,B=0,V=0;if($<60)J=E,B=q;else if($<120)J=q,B=E;else if($<180)B=E,V=q;else if($<240)B=q,V=E;else if($<300)J=q,V=E;else J=E,V=q;return{r:J+L,g:B+L,b:V+L}}function W0(){return z0(Math.random()*360,0.65+Math.random()*0.2,0.5+Math.random()*0.1)}function S0($){if($>=1e6)return($/1e6).toFixed(1)+"M";if($>=1000)return($/1000).toFixed(0)+"k";return $.toString()}function f0($){if(Math.abs($)>=1000)return($/1000).toFixed(1)+"k";if(Math.abs($)>=100)return $.toFixed(0);if(Math.abs($)>=10)return $.toFixed(1);return $.toFixed(2)}function I0($){return Math.round($).toString()}function o($,F,G,E=1){E=Math.max(1,Math.min(1e4,E));let q=[];for(let T=0;T<E;T++){let Z=_0(F,G);if($==="bar"&&G!=="spikey"&&G!=="cyclic")for(let O=0;O<Z.y.length;O++)Z.y[O]=Math.max(0,Z.y[O]);q.push({label:E>1?`Series ${T+1}`:"",color:W0(),x:Z.x,y:Z.y})}let L=G==="stock",J={id:"",type:$,pointCount:F,zoomX:!0,zoomY:!0},B=document.createElement("div");B.className="chart-card";let V=$.charAt(0).toUpperCase()+$.slice(1),K=$==="scatter"?`
      <div class="chart-point-size">
        <input type="range" min="1" max="8" value="3" class="point-size-slider" title="Point size">
        <span class="point-size-label">3px</span>
      </div>`:"",N=E>1?`<span class="chart-card-series">×${E}</span>`:"";B.innerHTML=`
    <div class="chart-card-header">
      <span class="chart-card-title">Chart</span>
      <span class="chart-card-type">${V}</span>
      <span class="chart-card-points">${S0(F)}</span>${N}${K}
      <div class="chart-zoom-split">
        <button class="zoom-axis-btn active" data-action="toggle-x" title="Toggle X zoom">X</button>
        <button class="zoom-axis-btn active" data-action="toggle-y" title="Toggle Y zoom">Y</button>
      </div>
      <div class="chart-card-actions">
        <button class="chart-action-btn" data-action="reset" title="Reset view">⌘</button>
        <button class="chart-action-btn danger" data-action="remove" title="Remove">×</button>
      </div>
    </div>
    <div class="chart-card-body"></div>
  `,document.getElementById("chart-grid").appendChild(B);let Q=B.querySelector(".chart-card-body"),U={type:$,container:Q,series:q,formatX:L?T0:I0,formatY:L?D0:f0,zoomMode:"both",showTooltip:!0},j;try{j=m.create(U)}catch(T){console.error("Failed to create chart:",T),B.remove();return}J.id=j,B.dataset.id=j,Q.id=`chart-container-${j}`;let H=B.querySelector(".point-size-slider"),_=B.querySelector(".point-size-label");if(H&&_)H.addEventListener("input",()=>{let T=parseInt(H.value);_.textContent=T+"px",m.setPointSize(J.id,T)});B.addEventListener("click",(T)=>{let Z=T.target.closest("[data-action]");if(!Z)return;switch(Z.dataset.action){case"reset":m.resetView(J.id);break;case"remove":N0(J.id);break;case"toggle-x":Q0(J,"x",Z,B);break;case"toggle-y":Q0(J,"y",Z,B);break}}),e.push(J)}function N0($){m.destroy($);let F=e.findIndex((E)=>E.id===$);if(F>=0)e.splice(F,1);let G=document.querySelector(`.chart-card[data-id="${$}"]`);if(G)G.remove()}function Q0($,F,G,E){if(F==="x")$.zoomX=!$.zoomX;else $.zoomY=!$.zoomY;let q=E.querySelector('[data-action="toggle-x"]'),L=E.querySelector('[data-action="toggle-y"]');q.classList.toggle("active",$.zoomX),L.classList.toggle("active",$.zoomY);let J;if($.zoomX&&$.zoomY)J="both";else if($.zoomX)J="x-only";else if($.zoomY)J="y-only";else J="none";m.setZoomMode($.id,J)}function M0(){let $=document.getElementById("theme-btn"),F=document.getElementById("theme-icon-sun"),G=document.getElementById("theme-icon-moon"),E=()=>{F.style.display=x?"none":"block",G.style.display=x?"block":"none"};E(),$.addEventListener("click",()=>{x=!x,document.documentElement.classList.toggle("dark",x),localStorage.setItem("theme",x?"dark":"light"),m.setTheme(x),E()})}async function Y0(){if(m=D.getInstance(),!await m.init()){let F=document.getElementById("error-toast");F.textContent="WebGPU not available. Please use a supported browser.",F.classList.remove("hidden");return}m.onStats((F)=>{document.getElementById("active").textContent=F.active.toString(),document.getElementById("total").textContent=F.total.toString()}),M0(),k0(),setTimeout(()=>{o("scatter",500,"stock",1),o("line",300,"trending",3),o("bar",100,"spikey",1),o("line",200,"cyclic",1)},100)}function k0(){let $=document.getElementById("chart-type"),F=document.getElementById("point-count"),G=document.getElementById("pattern"),E=document.getElementById("sync-toggle"),q=document.getElementById("sync-label"),L=document.getElementById("series-count");document.getElementById("add-chart").addEventListener("click",()=>{let J=$.value,B=parseInt(F.value)||500,V=G.value,K=Math.max(1,Math.min(1e4,parseInt(L.value)||3));o(J,B,V,K)}),document.getElementById("add-batch").addEventListener("click",()=>{let J=$.value,B=parseInt(F.value)||500,V=G.value,K=Math.max(1,Math.min(1e4,parseInt(L.value)||3));for(let N=0;N<5;N++)setTimeout(()=>{o(J,B,V,K)},N*100)}),document.getElementById("clear-all").addEventListener("click",()=>{for(let J of[...e])N0(J.id)}),E.addEventListener("change",()=>{let J=E.checked;m.setSyncViews(J),q.textContent=J?"Synced":"Sync Off"})}if(location.hostname==="localhost"||location.hostname==="127.0.0.1"){let $=new WebSocket(`ws://${location.host}/__hot`);$.onmessage=(F)=>{if(F.data==="reload")location.reload()}}Y0();
