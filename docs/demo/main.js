var O0=Object.create;var{getPrototypeOf:_0,defineProperty:q0,getOwnPropertyNames:H0}=Object;var Z0=Object.prototype.hasOwnProperty;var z0=($,G,q)=>{q=$!=null?O0(_0($)):{};let F=G||!$||!$.__esModule?q0(q,"default",{value:$,enumerable:!0}):q;for(let J of H0($))if(!Z0.call(F,J))q0(F,J,{get:()=>$[J],enumerable:!0});return F};var D0=(($)=>typeof require!=="undefined"?require:typeof Proxy!=="undefined"?new Proxy($,{get:(G,q)=>(typeof require!=="undefined"?require:G)[q]}):$)(function($){if(typeof require!=="undefined")return require.apply(this,arguments);throw Error('Dynamic require of "'+$+'" is not supported')});var s=[];function t($){if(!s.some((G)=>G.name===$.name))s.push($)}class A{static instance=null;static MARGIN={left:55,right:10,top:8,bottom:45};static HOVER_MAX_DISTANCE_PX=50;static MIN_ZOOM=0.1;static MAX_ZOOM=1e7;static DEFAULT_LABEL_SIZE=12;static DEFAULT_FONT='-apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif';static resizeCanvas($,G,q){let F=devicePixelRatio||1;if($.width=Math.round(G*F),$.height=Math.round(q*F),$ instanceof HTMLCanvasElement)$.style.width=`${G}px`,$.style.height=`${q}px`}worker=null;charts=new Map;chartIdCounter=0;_syncViews=!1;_isDark=!1;statsCallbacks=[];currentStats={fps:0,renderMs:0,total:0,active:0};visibilityObserver;resizeObserver;constructor(){this._isDark=document.documentElement.classList.contains("dark"),this.visibilityObserver=new IntersectionObserver(($)=>{for(let G of $){let q=G.target.dataset.chartId;if(q){let F=this.charts.get(q);if(F){if(F.visible=G.isIntersecting,this.worker?.postMessage({type:"set-visibility",id:q,visible:G.isIntersecting}),G.isIntersecting)this.drawChart(F)}}}},{threshold:0.01}),this.resizeObserver=new ResizeObserver(($)=>{for(let G of $){let q=G.target.dataset.chartId;if(!q)continue;let F=this.charts.get(q);if(!F)continue;let{width:J,height:K}=G.contentRect;if(J<=0||K<=0)continue;F.width=J,F.height=K;let Q=devicePixelRatio||1;this.worker?.postMessage({type:"resize",id:q,width:Math.round(J*Q),height:Math.round(K*Q)}),A.resizeCanvas(F.backCanvas,J,K),A.resizeCanvas(F.axisCanvas,J,K),this.drawChart(F)}})}static getInstance(){if(!A.instance)A.instance=new A;return A.instance}get isDark(){return this._isDark}get syncViews(){return this._syncViews}async init(){if(this.worker)return!0;return new Promise(($)=>{import("./worker-inline.js").then(({WORKER_CODE:G})=>{let q=new Blob([G],{type:"application/javascript"}),F=URL.createObjectURL(q);this.worker=new Worker(F,{type:"module"}),this.setupWorkerHandlers($)}).catch(()=>{let G=new URL("./gpu-worker.js",import.meta.url);this.worker=new Worker(G,{type:"module"}),this.setupWorkerHandlers($)})})}setupWorkerHandlers($){if(!this.worker)return;this.worker.onmessage=(G)=>{let{type:q,...F}=G.data;switch(q){case"gpu-ready":$(!0);break;case"error":console.error("ChartManager GPU Error:",F.message),$(!1);break;case"stats":this.currentStats={fps:F.fps,renderMs:F.renderMs,total:F.totalCharts,active:F.activeCharts};for(let J of this.statsCallbacks)J(this.currentStats);break;case"bounds-update":{let J=this.charts.get(F.id);if(J)J.bounds={minX:F.minX,maxX:F.maxX,minY:F.minY,maxY:F.maxY},this.drawChart(J);break}default:break}},this.worker.onerror=(G)=>{console.error("ChartManager Worker Error:",G),$(!1)},this.worker.postMessage({type:"init",isDark:this._isDark})}create($){if(!this.worker)throw new Error("ChartManager not initialized. Call init() first.");let G=`chart-${++this.chartIdCounter}`,q=document.createElement("div");q.dataset.chartId=G,q.style.cssText="width: 100%; height: 100%; position: relative;";let F=document.createElement("div");F.dataset.chartId=G,F.style.cssText="width: 100%; height: 100%; position: relative;";let J=document.createElement("canvas");J.style.cssText="position: absolute; inset: 0; width: 100%; height: 100%; pointer-events: none;";let K=document.createElement("canvas");K.style.cssText="position: absolute; inset: 0; width: 100%; height: 100%; pointer-events: auto; z-index: 1;";let Q=document.createElement("canvas");Q.style.cssText="position: absolute; inset: 0; width: 100%; height: 100%; pointer-events: none; z-index: 2;",F.appendChild(J),F.appendChild(K),F.appendChild(Q),q.appendChild(F),$.container.appendChild(q);let E;try{E=K.transferControlToOffscreen()}catch(U){throw console.error(`ChartManager: Failed to create offscreen canvas for ${G}:`,U),new Error(`Failed to create chart ${G}: ${U}`)}let N=F.getBoundingClientRect(),L=N.width||400,R=N.height||200;if(A.resizeCanvas(E,L,R),A.resizeCanvas(J,L,R),A.resizeCanvas(Q,L,R),$.bgColor){let[U,_,H]=$.bgColor;F.style.background=`rgb(${Math.round(U*255)},${Math.round(_*255)},${Math.round(H*255)})`}let B={id:G,config:$,el:q,backCanvas:J,axisCanvas:Q,width:L,height:R,series:[],bounds:{minX:0,maxX:1,minY:0,maxY:1},view:{panX:0,panY:0,zoomX:1,zoomY:1},zoomMode:$.zoomMode||"both",visible:!0,dragging:!1,bgColor:$.bgColor,textColor:$.textColor,gridColor:$.gridColor,fontFamily:$.fontFamily,momentum:null,findNearestPoint(U,_,H,z){if(this.series.length===0)return null;let Z=U/H,D=_/z,w=this.bounds.maxX-this.bounds.minX,g=this.bounds.maxY-this.bounds.minY,P=w/this.view.zoomX,v=g/this.view.zoomY,p=this.bounds.minX+this.view.panX*w,u=this.bounds.minY+this.view.panY*g,C=p+Z*P,x=u+(1-D)*v,b=-1,O=-1,I=1/0,M=1/0;for(let o=0;o<this.series.length;o++){let V=this.series[o],T=V.rawX.length;if(T===0)continue;let f=0,W=T-1;while(f<W){let m=f+W>>1;if(V.rawX[m]<C)f=m+1;else W=m}let X=f;if(f>0){let m=Math.abs(V.rawX[f]-C);if(Math.abs(V.rawX[f-1]-C)<m)X=f-1}let Y=Math.abs(V.rawX[X]-C),S=Math.abs(V.rawY[X]-x);if(Y<I||Y===I&&S<M)I=Y,M=S,b=o,O=X}if(b===-1)return null;let k=this.series[b],y=(k.rawX[O]-p)/P*H;if(Math.abs(y-U)>A.HOVER_MAX_DISTANCE_PX)return null;return{x:k.rawX[O],y:k.rawY[O],index:O,screenX:U,screenY:_,seriesIndex:b,seriesLabel:k.label}}};this.charts.set(G,B);let j=$.type==="bar"?"box":$.type;this.worker.postMessage({type:"register-chart",id:G,canvas:E,chartType:j,pointSize:$.pointSize??3,maxSamplesPerPixel:$.maxSamplesPerPixel??1e4,bgColor:$.bgColor??null},[E]),this.visibilityObserver.observe(q),this.resizeObserver.observe(F);for(let U of s)U.install?.(B,F);return this.updateSeries(G,$.series),G}destroy($){let G=this.charts.get($);if(!G)return;for(let F of s)F.uninstall?.(G);if(G.momentum)cancelAnimationFrame(G.momentum);this.visibilityObserver.unobserve(G.el);let q=G.el.querySelector(".gpu-chart-canvas-wrap");if(q)this.resizeObserver.unobserve(q);G.el.remove(),this.worker?.postMessage({type:"unregister-chart",id:$}),this.charts.delete($)}updateSeries($,G){let q=this.charts.get($);if(!q||!this.worker)return;if(G.length===0)return;q.series=G.map((B)=>{let j=B.x.length;if(j===0)return{label:B.label,color:B.color,rawX:[],rawY:[]};let U=Array.from({length:j},(_,H)=>H);return U.sort((_,H)=>B.x[_]-B.x[H]),{label:B.label,color:B.color,rawX:U.map((_)=>B.x[_]),rawY:U.map((_)=>B.y[_])}});let F=1/0,J=-1/0,K=1/0,Q=-1/0;for(let B of q.series)for(let j=0;j<B.rawX.length;j++){if(B.rawX[j]<F)F=B.rawX[j];if(B.rawX[j]>J)J=B.rawX[j];if(B.rawY[j]<K)K=B.rawY[j];if(B.rawY[j]>Q)Q=B.rawY[j]}let E=(J-F)*0.05||1,N=(Q-K)*0.1||1;F-=E,J+=E,K-=N,Q+=N;let L=q.config.defaultBounds;if(L){if(L.minX!==void 0)F=L.minX;if(L.maxX!==void 0)J=L.maxX;if(L.minY!==void 0)K=L.minY;if(L.maxY!==void 0)Q=L.maxY}q.bounds={minX:F,maxX:J,minY:K,maxY:Q};let R=q.series.map((B)=>({label:B.label,colorR:B.color.r,colorG:B.color.g,colorB:B.color.b,dataX:new Float32Array(B.rawX),dataY:new Float32Array(B.rawY)}));this.worker.postMessage({type:"update-series",id:$,series:R,bounds:q.bounds},R.flatMap((B)=>[B.dataX.buffer,B.dataY.buffer])),this.sendViewTransform(q),this.drawChart(q)}setPointSize($,G){if(!this.charts.get($))return;this.worker?.postMessage({type:"set-point-size",id:$,pointSize:Math.max(1,Math.min(8,Math.round(G)))})}setMaxSamplesPerPixel($,G){if(!this.charts.get($))return;this.worker?.postMessage({type:"set-max-samples",id:$,maxSamplesPerPixel:Math.max(0,G|0)})}setStyle($,G){let q=this.charts.get($);if(!q)return;if(G.bgColor!==void 0)q.bgColor=G.bgColor;if(G.textColor!==void 0)q.textColor=G.textColor;if(G.gridColor!==void 0)q.gridColor=G.gridColor;if(G.fontFamily!==void 0)q.fontFamily=G.fontFamily;if(G.bgColor!==void 0){let F=q.el.querySelector(".gpu-chart-canvas-wrap");if(F){let[J,K,Q]=G.bgColor;F.style.background=`rgb(${Math.round(J*255)},${Math.round(K*255)},${Math.round(Q*255)})`}this.worker?.postMessage({type:"set-style",id:$,bgColor:G.bgColor})}this.drawChart(q)}setZoomMode($,G){let q=this.charts.get($);if(q)q.zoomMode=G}getChartCount(){return this.charts.size}getZoomMode($){return this.charts.get($)?.zoomMode||"both"}setSyncViews($){this._syncViews=$}setTheme($){this._isDark=$,this.worker?.postMessage({type:"theme",isDark:$});for(let G of this.charts.values())this.drawChart(G)}onStats($){return this.statsCallbacks.push($),()=>{let G=this.statsCallbacks.indexOf($);if(G>=0)this.statsCallbacks.splice(G,1)}}getStats(){return{...this.currentStats}}resetView($){let G=this.charts.get($);if(!G)return;if(G.momentum)cancelAnimationFrame(G.momentum),G.momentum=null;let q=G.view.panX,F=G.view.panY,J=G.view.zoomX,K=G.view.zoomY,Q=performance.now(),E=()=>{let N=Math.min(1,(performance.now()-Q)/300),L=1-Math.pow(1-N,3);if(G.view.panX=q*(1-L),G.view.panY=F*(1-L),G.view.zoomX=J+(1-J)*L,G.view.zoomY=K+(1-K)*L,this.sendViewTransform(G),this.drawChart(G),this._syncViews)this.syncAllViews(G);if(N<1)requestAnimationFrame(E)};requestAnimationFrame(E)}sendViewTransform($){this.worker?.postMessage({type:"view-transform",id:$.id,panX:$.view.panX,panY:$.view.panY,zoomX:$.view.zoomX,zoomY:$.view.zoomY})}syncAllViews($){let G=[];for(let q of this.charts.values())if(q.id!==$.id)q.view={...$.view},G.push({id:q.id}),this.drawChart(q);if(G.length>0)this.worker?.postMessage({type:"batch-view-transform",panX:$.view.panX,panY:$.view.panY,zoomX:$.view.zoomX,zoomY:$.view.zoomY,transforms:G})}drawChart($){if(!$.visible)return;let G=devicePixelRatio||1,q=$.backCanvas.getContext("2d");if(q){q.clearRect(0,0,$.backCanvas.width,$.backCanvas.height),q.save(),q.scale(G,G);for(let J of s)J.beforeDraw?.(q,$);q.restore()}let F=$.axisCanvas.getContext("2d");if(F){F.clearRect(0,0,$.axisCanvas.width,$.axisCanvas.height),F.save(),F.scale(G,G);for(let J of s)J.afterDraw?.(F,$);F.restore()}}}var a=($,G,q)=>{let F=G-$;if(F<=0)return[$];let J=F/q,K=10**Math.floor(Math.log10(J)),Q=J/K,E=K*(Q<=1.5?1:Q<=3?2:Q<=7?5:10),N=[];for(let L=Math.ceil($/E)*E;L<=G;L+=E)N.push(L);return N},J0=($)=>{let G=A.getInstance(),q=$.width,F=$.height,J=A.MARGIN,{bounds:K,view:Q}=$,E=K.maxX-K.minX,N=K.maxY-K.minY,L=E/Q.zoomX,R=N/Q.zoomY,B=K.minX+Q.panX*E,j=K.minY+Q.panY*N,U=$.bgColor??(G.isDark?[0.11,0.11,0.12]:[0.98,0.98,0.98]);return{w:q,h:F,m:J,rx:L,ry:R,mx:B,my:j,bg:`${Math.round(U[0]*255)},${Math.round(U[1]*255)},${Math.round(U[2]*255)}`,font:$.fontFamily??A.DEFAULT_FONT,text:$.textColor??(G.isDark?"#c0c0c0":"#333333"),grid:$.gridColor??(G.isDark?"rgba(255,255,255,0.06)":"rgba(0,0,0,0.06)")}},Q0={name:"labels",beforeDraw($,G){let{w:q,h:F,m:J,rx:K,ry:Q,mx:E,my:N,grid:L}=J0(G);$.strokeStyle=L,$.lineWidth=1,$.beginPath(),a(N,N+Q,7).forEach((R)=>{let B=F*(1-(R-N)/Q);if(B>5&&B<F-J.bottom-5)$.moveTo(J.left,B),$.lineTo(q,B)}),a(E,E+K,8).forEach((R)=>{let B=q*((R-E)/K);if(B>J.left&&B<q)$.moveTo(B,0),$.lineTo(B,F-J.bottom)}),$.stroke()},afterDraw($,G){let{w:q,h:F,m:J,rx:K,ry:Q,mx:E,my:N,bg:L,font:R,text:B}=J0(G),{formatX:j=String,formatY:U=String,labelSize:_=A.DEFAULT_LABEL_SIZE}=G.config,H=(z,Z,D,w,g)=>{let P=z==="left"?$.createLinearGradient(Z,0,Z+w,0):$.createLinearGradient(0,D,0,D+g),v=z==="left"?[1,0.7,0.2,0.05,0]:[0,0.05,0.2,0.7,1];[0,0.35,0.55,0.7,1].forEach((p,u)=>P.addColorStop(p,`rgba(${L},${v[u]})`)),$.fillStyle=P,$.fillRect(Z,D,w,g)};H("left",0,0,J.left+20,F),H("bottom",0,F-J.bottom-20,q,J.bottom+20),$.font=`${_}px ${R}`,$.fillStyle=B,$.textAlign="right",$.textBaseline="middle",a(N,N+Q,7).forEach((z)=>{let Z=F*(1-(z-N)/Q);if(Z>5&&Z<F-J.bottom-5)$.fillText(U(z),J.left-5,Z)}),$.textAlign="right",$.textBaseline="top",a(E,E+K,8).forEach((z)=>{let Z=q*((z-E)/K);if(Z<J.left-10||Z>q+30)return;$.save(),$.translate(Z,F-J.bottom+5),$.rotate(-Math.PI/14),$.fillText(j(z),0,0),$.restore()})}};function B0($={}){let G=$.momentumDecay??0.9,q=new WeakMap;return{name:"zoom",install(F,J){let K=J.style.touchAction,Q=J.style.userSelect,E=J.style.webkitUserSelect;J.style.touchAction="none",J.style.userSelect="none",J.style.webkitUserSelect="none";let N=A.getInstance(),L=new AbortController,R={lastX:0,lastY:0,velX:0,velY:0,abort:L,originalTouchAction:K,originalUserSelect:Q,originalWebkitUserSelect:E,el:J};q.set(F,R);let B=[],j="none",U=0,_=0,H=0,z=0,Z=0,D=10,w=10,g=500,P=null,v=0,p=1,u=1,C=0.5,x=0.5,b=0,O=0,I=0,M=null,k=0,l=1,y=()=>{if(N.sendViewTransform(F),N.drawChart(F),N.syncViews)N.syncAllViews(F)},n=()=>{if(F.momentum)cancelAnimationFrame(F.momentum);let V=()=>{if(b*=G,O*=G,Math.abs(b)>0.00005||Math.abs(O)>0.00005){if(F.zoomMode!=="none"&&(F.zoomMode==="both"||F.zoomMode==="x-only"))F.view.panX-=b/F.view.zoomX;if(F.zoomMode!=="none"&&(F.zoomMode==="both"||F.zoomMode==="y-only"))F.view.panY+=O/F.view.zoomY;y(),F.momentum=requestAnimationFrame(V)}else F.momentum=null};F.momentum=requestAnimationFrame(V)};J.addEventListener("pointerdown",(V)=>{if(F.momentum)cancelAnimationFrame(F.momentum),F.momentum=null;if(B.push(V),J.setPointerCapture(V.pointerId),B.length===1)if(j="detecting",U=V.clientX,_=V.clientY,H=V.clientX,z=V.clientY,b=O=0,Z=performance.now(),M=null,V.pointerType==="touch")P=window.setTimeout(()=>{if(j==="detecting")j="press",F.dragging=!1},g);else{let T=J.getBoundingClientRect(),f=V.clientX-T.left,W=V.clientY-T.top,X=A.MARGIN,Y=f<X.left,S=W>T.height-X.bottom;if(Y&&!S)M="y",k=V.clientY,l=F.view.zoomY,F.dragging=!0;else if(S&&!Y)M="x",k=V.clientX,l=F.view.zoomX,F.dragging=!0;else F.dragging=!0}else if(B.length===2){if(P)clearTimeout(P),P=null;if(j="pinch",F.dragging=!1,V.pointerType==="touch")V.preventDefault();let T=J.getBoundingClientRect(),f=B[1].clientX-B[0].clientX,W=B[1].clientY-B[0].clientY;v=Math.hypot(f,W),p=F.view.zoomX,u=F.view.zoomY,C=((B[0].clientX+B[1].clientX)/2-T.left)/T.width,x=1-((B[0].clientY+B[1].clientY)/2-T.top)/T.height}},{passive:!1,signal:L.signal}),J.addEventListener("pointermove",(V)=>{let T=B.findIndex((f)=>f.pointerId===V.pointerId);if(T>=0)B[T]=V;if(B.length===1){let f=Math.hypot(V.clientX-U,V.clientY-_);if(j==="detecting"&&f>D){if(j="pan",F.dragging=!0,P)clearTimeout(P),P=null}if(j==="press")return;if(M&&V.pointerType!=="touch"){if(M==="x"){let W=V.clientX-k,X=Math.exp(W/200),Y=Math.max(A.MIN_ZOOM,Math.min(A.MAX_ZOOM,l*X)),S=F.view.panX+0.5/l;F.view.zoomX=Y,F.view.panX=S-0.5/Y,y();return}else if(M==="y"){let W=k-V.clientY,X=Math.exp(W/200),Y=Math.max(A.MIN_ZOOM,Math.min(A.MAX_ZOOM,l*X)),S=F.view.panY+0.5/l;F.view.zoomY=Y,F.view.panY=S-0.5/Y,y();return}}if(j==="pan"||F.dragging&&!M){let W=J.getBoundingClientRect(),X=(V.clientX-H)/W.width,Y=(V.clientY-z)/W.height,S=performance.now();if(S-Z<100)b=b*0.3+X*0.7,O=O*0.3+Y*0.7;if(Z=S,F.zoomMode!=="none"&&(F.zoomMode==="both"||F.zoomMode==="x-only"))F.view.panX-=X/F.view.zoomX;if(F.zoomMode!=="none"&&(F.zoomMode==="both"||F.zoomMode==="y-only"))F.view.panY+=Y/F.view.zoomY;H=V.clientX,z=V.clientY,y()}}else if(B.length===2&&j==="pinch"){if(V.pointerType==="touch")V.preventDefault();let f=B[1].clientX-B[0].clientX,W=B[1].clientY-B[0].clientY,Y=Math.hypot(f,W)-v,S=Math.exp(Y/300);if(F.zoomMode!=="none"&&(F.zoomMode==="both"||F.zoomMode==="x-only")){let m=Math.max(A.MIN_ZOOM,Math.min(A.MAX_ZOOM,p*S)),i=F.view.panX+C/p;F.view.zoomX=m,F.view.panX=i-C/m}if(F.zoomMode!=="none"&&(F.zoomMode==="both"||F.zoomMode==="y-only")){let m=Math.max(A.MIN_ZOOM,Math.min(A.MAX_ZOOM,u*S)),i=F.view.panY+x/u;F.view.zoomY=m,F.view.panY=i-x/m}y()}},{passive:!1,signal:L.signal});let o=(V)=>{if(B=B.filter((T)=>T.pointerId!==V.pointerId),J.releasePointerCapture(V.pointerId),P)clearTimeout(P),P=null;if(B.length===0){let f=Math.hypot(V.clientX-U,V.clientY-_)<w&&j!=="pan";if(f&&V.pointerType==="touch"){let W=Date.now();if(W-I<300)N.resetView(F.id),I=0;else I=W}if(f&&V.pointerType!=="touch"){let W=Date.now();if(W-I<300)N.resetView(F.id),I=0;else I=W}if(j==="pan"&&(Math.abs(b)>0.001||Math.abs(O)>0.001))n();j="none",F.dragging=!1,M=null}else if(B.length===1)j="detecting",U=B[0].clientX,_=B[0].clientY,H=B[0].clientX,z=B[0].clientY};J.addEventListener("pointerup",o,{signal:L.signal}),J.addEventListener("pointercancel",o,{signal:L.signal}),J.addEventListener("wheel",(V)=>{if(V.preventDefault(),F.momentum)cancelAnimationFrame(F.momentum),F.momentum=null;let T=J.getBoundingClientRect(),f=V.clientX-T.left,W=V.clientY-T.top,X=f/T.width,Y=1-W/T.height,S=1-V.deltaY*0.002,m=A.MARGIN,i=f<m.left,A0=W>T.height-m.bottom,r,e;if(i)r=!1,e=!0;else if(A0)r=!0,e=!1;else r=F.zoomMode==="both"||F.zoomMode==="x-only",e=F.zoomMode==="both"||F.zoomMode==="y-only";if(r){let G0=F.view.panX+X/F.view.zoomX;F.view.zoomX=Math.max(A.MIN_ZOOM,Math.min(A.MAX_ZOOM,F.view.zoomX*S)),F.view.panX=G0-X/F.view.zoomX}if(e){let G0=F.view.panY+Y/F.view.zoomY;F.view.zoomY=Math.max(A.MIN_ZOOM,Math.min(A.MAX_ZOOM,F.view.zoomY*S)),F.view.panY=G0-Y/F.view.zoomY}if(r||e)y()},{passive:!1,signal:L.signal})},uninstall(F){let J=q.get(F);if(J){if(F.momentum)cancelAnimationFrame(F.momentum),F.momentum=null;J.el.style.touchAction=J.originalTouchAction,J.el.style.userSelect=J.originalUserSelect,J.el.style.webkitUserSelect=J.originalWebkitUserSelect,J.abort.abort(),q.delete(F)}}}}var $0=new WeakMap,W0=($,G,q,F,J,K,Q,E)=>{$.beginPath(),$.roundRect(G,q,F,J,K),$.fillStyle=Q,$.fill(),$.strokeStyle=E,$.lineWidth=1.5,$.stroke()},E0={name:"hover",install($,G){let q=A.getInstance(),F=new AbortController,J={hoverResult:null,pillX:0,pillY:0,pillTargetX:0,pillTargetY:0,pillAnimRef:null,abort:F};$0.set($,J);let K=(E)=>{if($.config.onHover)$.config.onHover(E);if(!($.config.showTooltip??!1))return;if(J.hoverResult=E,q.drawChart($),E&&!J.pillAnimRef){let N=performance.now(),L=(R)=>{if(!J.hoverResult)return J.pillAnimRef=null;let B=1-Math.pow(0.5,(R-N)/($.config.pillDecayMs??60));N=R,J.pillX+=(J.pillTargetX-J.pillX)*B,J.pillY+=(J.pillTargetY-J.pillY)*B,q.drawChart($),J.pillAnimRef=requestAnimationFrame(L)};J.pillAnimRef=requestAnimationFrame(L)}},Q=(E,N)=>{if($.dragging)return;let L=G.getBoundingClientRect();K($.findNearestPoint(E-L.left,N-L.top,L.width,L.height))};G.addEventListener("mousemove",(E)=>Q(E.clientX,E.clientY),{signal:F.signal}),G.addEventListener("touchmove",(E)=>{if(E.touches.length===1)Q(E.touches[0].clientX,E.touches[0].clientY)},{signal:F.signal,passive:!0}),["mouseleave","pointerdown","touchend","touchcancel"].forEach((E)=>G.addEventListener(E,()=>K(null),{signal:F.signal}))},afterDraw($,G){let q=$0.get(G);if(!q?.hoverResult||!G.config.showTooltip)return;let{hoverResult:F}=q,J=G.width,K=G.height,Q=A.MARGIN,E=A.getInstance().isDark,{formatX:N=String,formatY:L=String,fontFamily:R=A.DEFAULT_FONT}=G.config,B=(G.bounds.maxX-G.bounds.minX)/G.view.zoomX,j=(G.bounds.maxY-G.bounds.minY)/G.view.zoomY,U=(F.x-(G.bounds.minX+G.view.panX*(G.bounds.maxX-G.bounds.minX)))/B*J,_=K*(1-(F.y-(G.bounds.minY+G.view.panY*(G.bounds.maxY-G.bounds.minY)))/j),H=G.series[F.seriesIndex]||G.series[0],z=`${Math.round(H.color.r*255)},${Math.round(H.color.g*255)},${Math.round(H.color.b*255)}`,Z=`rgb(${z})`,D=E?`oklch(from ${Z} calc(l + 0.1) c h)`:Z;$.save(),$.setLineDash([4,3]),$.strokeStyle=`rgba(${z},0.4)`,$.stroke(new Path2D(`M${U} 0V${K-Q.bottom}M${Q.left} ${_}H${J}`)),$.restore(),$.beginPath(),$.arc(U,_,4.5,0,Math.PI*2),$.fillStyle=Z,$.fill(),$.strokeStyle=E?"rgba(0,0,0,0.6)":"rgba(255,255,255,0.9)",$.stroke();let w=G.series.map((O)=>{let I=0,M=O.rawX.length-1;while(I<=M){let k=I+M>>1;if(Math.abs(O.rawX[k]-F.x)<0.0001)return{label:O.label,val:L(O.rawY[k]),rawVal:O.rawY[k],col:`rgb(${Math.round(O.color.r*255)},${Math.round(O.color.g*255)},${Math.round(O.color.b*255)})`};O.rawX[k]<F.x?I=k+1:M=k-1}return null}).filter(Boolean);w.sort((O,I)=>Math.abs(I.rawVal)-Math.abs(O.rawVal));let g=w.length,P=w.slice(0,5),v=g-P.length;if(q.pillTargetX=U,q.pillTargetY=_,!q.pillAnimRef)q.pillX=U,q.pillY=_;let p=(O,I,M,k)=>{$.font=`600 10px ${R}`;let l=$.measureText(M).width,y=l+12,n=18,o=k?O-y/2:O-y,V=k?I:I-n/2;$.save();let T=k?Math.atan((q.pillTargetX-q.pillX)/80)*0.2:Math.atan((q.pillTargetY-q.pillY)/80)*0.2;$.translate(O,I),$.rotate(T);let f=k?-y/2:-y,W=k?0:-n/2;$.beginPath(),$.roundRect(f,W,y,n,4),$.fillStyle=E?"rgba(0,0,0,0.75)":"rgba(255,255,255,0.75)",$.fill(),$.fillStyle=`rgba(${z},0.2)`,$.fill(),$.strokeStyle=D,$.lineWidth=1.5,$.stroke(),$.fillStyle=D,$.textAlign="center",$.textBaseline="middle",$.fillText(M,f+y/2,W+n/2),$.restore()};p(Math.max(Q.left,Math.min(J-Q.right,q.pillX)),K-Q.bottom+4,N(F.x),!0),p(Math.max(Q.left,Q.left),Math.max(9,Math.min(K-Q.bottom-9,q.pillY)),L(F.y),!1);let u=Math.max(...P.map((O)=>$.measureText(O.label+O.val).width))+40,C=30+P.length*18+(v>0?18:0),x=F.screenX+14,b=F.screenY-C-6;if(x+u>J)x=F.screenX-u-14;if(b=Math.max(4,Math.min(K-C-4,F.screenY-C-6)),W0($,x,b,u,C,6,E?"rgba(28,28,30,0.95)":"rgba(255,255,255,0.96)","rgba(0,0,0,0.08)"),$.textAlign="left",$.textBaseline="middle",$.fillStyle=E?"#888":"#999",$.fillText(N(F.x),x+10,b+15),P.forEach((O,I)=>{let M=b+35+I*18;$.fillStyle=O.col,$.beginPath(),$.roundRect(x+10,M-4,8,8,2),$.fill(),$.fillStyle=E?"#eee":"#1a1a1a",$.fillText(`${O.label}: ${O.val}`,x+24,M)}),v>0){let O=b+35+P.length*18;$.fillStyle=E?"#666":"#aaa",$.fillText(`+${v} more`,x+10,O)}},uninstall($){let G=$0.get($);if(G?.pillAnimRef)cancelAnimationFrame(G.pillAnimRef);G?.abort.abort(),$0.delete($)}};t(Q0);t(B0());t(E0);var F0=[],d,h=document.documentElement.classList.contains("dark"),K0=0,j0=new MessageChannel,U0=0,L0=0;j0.port1.onmessage=()=>{K0=performance.now()-U0;let $=performance.now();if($-L0>=120){L0=$;let G=(q)=>q<1?q.toFixed(2)+"ms":q.toFixed(1)+"ms";document.getElementById("main-ms").textContent=G(K0)}};function V0(){requestAnimationFrame(()=>{U0=performance.now(),j0.port2.postMessage(null),V0()})}V0();var f0=new Date("2026-02-03");function T0($,G){let q=new Array($),F=new Array($);if(G==="stock")for(let Q=0;Q<$;Q++)q[Q]=$-1-Q;else for(let Q=0;Q<$;Q++)q[Q]=Q;let K=2*Math.PI;switch(G){case"stock":{let E=Math.LN2/5258880,N=-E*3,L=0.0005,R=0.0009000000000000001,B=$/5258880,j=Math.max(1,Math.round(B*(0.8+Math.random()*0.4))),U=[];for(let D=0;D<j;D++){let w=Math.floor(Math.random()*$*0.9),g=Math.floor((180+Math.random()*360)*1440);U.push({s:w,e:w+g})}U.sort((D,w)=>D.s-w.s);let _=Math.log(10+Math.random()*20),H=0,z=0,Z=!1;for(let D=0;D<$;D++){while(H<U.length&&D>=U[H].e)H++;let w=H<U.length&&D>=U[H].s&&D<U[H].e,g=w?N:E,P=w?0.0009000000000000001:0.0005,v;if(Z)v=z,Z=!1;else{let p=Math.random()||0.0000000001,u=Math.sqrt(-2*Math.log(p)),C=K*Math.random();v=u*Math.cos(C),z=u*Math.sin(C),Z=!0}_+=g+P*v,F[D]=Math.exp(_)}break}case"trending":{let Q=Math.log(20+Math.random()*20),E=Math.LN2/$,N=0.015,L=0,R=!1;for(let B=0;B<$;B++){let j;if(R)j=L,R=!1;else{let U=Math.random()||0.0000000001,_=Math.sqrt(-2*Math.log(U)),H=K*Math.random();j=_*Math.cos(H),L=_*Math.sin(H),R=!0}Q+=E+N*j,F[B]=Math.exp(Q)}break}case"declining":{let Q=Math.log(60+Math.random()*40),E=-Math.LN2/$,N=0.015,L=0,R=!1;for(let B=0;B<$;B++){let j;if(R)j=L,R=!1;else{let U=Math.random()||0.0000000001,_=Math.sqrt(-2*Math.log(U)),H=K*Math.random();j=_*Math.cos(H),L=_*Math.sin(H),R=!0}Q+=E+N*j,F[B]=Math.exp(Q)}break}case"spikey":{let Q=20+Math.random()*30,E=3+Math.floor(Math.random()*5),N=new Set;while(N.size<Math.min(E,$))N.add(Math.floor(Math.random()*$));let L=Q*1.2,R=Q*5;for(let B=0;B<$;B++)if(N.has(B))F[B]=Math.random()<0.5?-R:R;else F[B]=(Math.random()-0.5)*L;break}case"cyclic":{let Q=Date.now()%1e5/1e5*K,E=30+Math.random()*20,N=50+Math.random()*20,L=2+Math.random()*4,R=K*L/$,B=E*0.25;for(let j=0;j<$;j++){let U=j*R+Q;F[j]=N+Math.sin(U)*E+Math.sin(U*2.7+1.3)*B+(Math.random()-0.5)*8}break}}return{x:q,y:F}}function P0($){if($>=1000)return"$"+($/1000).toFixed(1)+"k";return"$"+$.toFixed(2)}function I0($){let G=f0.getTime()-Math.round($)*60000,q=new Date(G),J=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][q.getMonth()],K=q.getDate(),Q=q.getFullYear();return`${J} ${K}, ${Q}`}function k0($,G,q){let F=(1-Math.abs(2*q-1))*G,J=F*(1-Math.abs($/60%2-1)),K=q-F/2,Q=0,E=0,N=0;if($<60)Q=F,E=J;else if($<120)Q=J,E=F;else if($<180)E=F,N=J;else if($<240)E=J,N=F;else if($<300)Q=J,N=F;else Q=F,N=J;return{r:Q+K,g:E+K,b:N+K}}function M0(){return k0(Math.random()*360,0.65+Math.random()*0.2,0.5+Math.random()*0.1)}function Y0($){if($>=1e6)return($/1e6).toFixed(1)+"M";if($>=1000)return($/1000).toFixed(0)+"k";return $.toString()}function w0($){if(Math.abs($)>=1000)return($/1000).toFixed(1)+"k";if(Math.abs($)>=100)return $.toFixed(0);if(Math.abs($)>=10)return $.toFixed(1);return $.toFixed(2)}function b0($){return Math.round($).toString()}function c($,G,q,F=1){F=Math.max(1,Math.min(1e4,F));let J=[];for(let z=0;z<F;z++){let Z=T0(G,q);if($==="bar"&&q!=="spikey"&&q!=="cyclic")for(let D=0;D<Z.y.length;D++)Z.y[D]=Math.max(0,Z.y[D]);J.push({label:F>1?`Series ${z+1}`:"",color:M0(),x:Z.x,y:Z.y})}let K=q==="stock",Q={id:"",type:$,pointCount:G,zoomX:!0,zoomY:!0},E=document.createElement("div");E.className="chart-card";let N=$.charAt(0).toUpperCase()+$.slice(1),L=$==="scatter"?`
      <div class="chart-point-size">
        <input type="range" min="1" max="8" value="3" class="point-size-slider" title="Point size">
        <span class="point-size-label">3px</span>
      </div>`:"",R=F>1?`<span class="chart-card-series">×${F}</span>`:"";E.innerHTML=`
    <div class="chart-card-header">
      <span class="chart-card-title">Chart</span>
      <span class="chart-card-type">${N}</span>
      <span class="chart-card-points">${Y0(G)}</span>${R}${L}
      <div class="chart-zoom-split">
        <button class="zoom-axis-btn active" data-action="toggle-x" title="Toggle X zoom">X</button>
        <button class="zoom-axis-btn active" data-action="toggle-y" title="Toggle Y zoom">Y</button>
      </div>
      <div class="chart-card-actions">
        <button class="chart-action-btn" data-action="reset" title="Reset view">⌘</button>
        <button class="chart-action-btn danger" data-action="remove" title="Remove">×</button>
      </div>
    </div>
    <div class="chart-card-body"></div>
  `,document.getElementById("chart-grid").appendChild(E);let B=E.querySelector(".chart-card-body"),j={type:$,container:B,series:J,formatX:K?I0:b0,formatY:K?P0:w0,zoomMode:"both",showTooltip:!0},U;try{U=d.create(j)}catch(z){console.error("Failed to create chart:",z),E.remove();return}Q.id=U,E.dataset.id=U,B.id=`chart-container-${U}`;let _=E.querySelector(".point-size-slider"),H=E.querySelector(".point-size-label");if(_&&H)_.addEventListener("input",()=>{let z=parseInt(_.value);H.textContent=z+"px",d.setPointSize(Q.id,z)});E.addEventListener("click",(z)=>{let Z=z.target.closest("[data-action]");if(!Z)return;switch(Z.dataset.action){case"reset":d.resetView(Q.id);break;case"remove":R0(Q.id);break;case"toggle-x":N0(Q,"x",Z,E);break;case"toggle-y":N0(Q,"y",Z,E);break}}),F0.push(Q)}function R0($){d.destroy($);let G=F0.findIndex((F)=>F.id===$);if(G>=0)F0.splice(G,1);let q=document.querySelector(`.chart-card[data-id="${$}"]`);if(q)q.remove()}function N0($,G,q,F){if(G==="x")$.zoomX=!$.zoomX;else $.zoomY=!$.zoomY;let J=F.querySelector('[data-action="toggle-x"]'),K=F.querySelector('[data-action="toggle-y"]');J.classList.toggle("active",$.zoomX),K.classList.toggle("active",$.zoomY);let Q;if($.zoomX&&$.zoomY)Q="both";else if($.zoomX)Q="x-only";else if($.zoomY)Q="y-only";else Q="none";d.setZoomMode($.id,Q)}function X0(){let $=document.getElementById("theme-btn"),G=document.getElementById("theme-icon-sun"),q=document.getElementById("theme-icon-moon"),F=()=>{G.style.display=h?"none":"block",q.style.display=h?"block":"none"};F(),$.addEventListener("click",()=>{h=!h,document.documentElement.classList.toggle("dark",h),localStorage.setItem("theme",h?"dark":"light"),d.setTheme(h),F()})}async function S0(){if(d=A.getInstance(),!await d.init()){let G=document.getElementById("error-toast");G.textContent="WebGPU not available. Please use a supported browser.",G.classList.remove("hidden");return}d.onStats((G)=>{document.getElementById("active").textContent=G.active.toString(),document.getElementById("total").textContent=G.total.toString()}),X0(),C0(),setTimeout(()=>{c("scatter",500,"stock",1),c("line",300,"trending",3),c("bar",100,"spikey",1),c("line",200,"cyclic",1)},100)}function C0(){let $=document.getElementById("chart-type"),G=document.getElementById("point-count"),q=document.getElementById("pattern"),F=document.getElementById("sync-toggle"),J=document.getElementById("sync-label"),K=document.getElementById("series-count");document.getElementById("add-chart").addEventListener("click",()=>{let Q=$.value,E=parseInt(G.value)||500,N=q.value,L=Math.max(1,Math.min(1e4,parseInt(K.value)||3));c(Q,E,N,L)}),document.getElementById("add-batch").addEventListener("click",()=>{let Q=$.value,E=parseInt(G.value)||500,N=q.value,L=Math.max(1,Math.min(1e4,parseInt(K.value)||3));for(let R=0;R<5;R++)setTimeout(()=>{c(Q,E,N,L)},R*100)}),document.getElementById("clear-all").addEventListener("click",()=>{for(let Q of[...F0])R0(Q.id)}),F.addEventListener("change",()=>{let Q=F.checked;d.setSyncViews(Q),J.textContent=Q?"Synced":"Sync Off"})}if(location.hostname==="localhost"||location.hostname==="127.0.0.1"){let $=new WebSocket(`ws://${location.host}/__hot`);$.onmessage=(G)=>{if(G.data==="reload")location.reload()}}S0();
