var W0=Object.create;var{getPrototypeOf:M0,defineProperty:_0,getOwnPropertyNames:S0}=Object;var k0=Object.prototype.hasOwnProperty;var f0=($,F,q)=>{q=$!=null?W0(M0($)):{};let E=F||!$||!$.__esModule?_0(q,"default",{value:$,enumerable:!0}):q;for(let G of S0($))if(!k0.call(E,G))_0(E,G,{get:()=>$[G],enumerable:!0});return E};var w0=(($)=>typeof require!=="undefined"?require:typeof Proxy!=="undefined"?new Proxy($,{get:(F,q)=>(typeof require!=="undefined"?require:F)[q]}):$)(function($){if(typeof require!=="undefined")return require.apply(this,arguments);throw Error('Dynamic require of "'+$+'" is not supported')});var r=[];function a($){if(!r.some((F)=>F.name===$.name))r.push($)}class U{static instance=null;static MARGIN={left:55,right:10,top:8,bottom:45};static HOVER_MAX_DISTANCE_PX=50;static MIN_ZOOM=0.1;static MAX_ZOOM=1e7;static DEFAULT_LABEL_SIZE=12;static DEFAULT_FONT='-apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif';static resizeCanvas($,F,q){let E=devicePixelRatio||1;if($.width=Math.round(F*E),$.height=Math.round(q*E),$ instanceof HTMLCanvasElement)$.style.width=`${F}px`,$.style.height=`${q}px`}worker=null;charts=new Map;chartIdCounter=0;_syncViews=!1;_isDark=!1;statsCallbacks=[];currentStats={fps:0,renderMs:0,total:0,active:0};visibilityObserver;resizeObserver;constructor(){this._isDark=document.documentElement.classList.contains("dark"),this.visibilityObserver=new IntersectionObserver(($)=>{for(let F of $){let q=F.target.dataset.chartId;if(q){let E=this.charts.get(q);if(E){if(E.visible=F.isIntersecting,this.worker?.postMessage({type:"set-visibility",id:q,visible:F.isIntersecting}),F.isIntersecting)this.drawChart(E)}}}},{threshold:0.01}),this.resizeObserver=new ResizeObserver(($)=>{for(let F of $){let q=F.target.dataset.chartId;if(!q)continue;let E=this.charts.get(q);if(!E)continue;let{width:G,height:j}=F.contentRect;if(G<=0||j<=0)continue;E.width=G,E.height=j;let Q=devicePixelRatio||1;this.worker?.postMessage({type:"resize",id:q,width:Math.round(G*Q),height:Math.round(j*Q)}),U.resizeCanvas(E.backCanvas,G,j),U.resizeCanvas(E.axisCanvas,G,j),this.drawChart(E)}})}static getInstance(){if(!U.instance)U.instance=new U;return U.instance}get isDark(){return this._isDark}get syncViews(){return this._syncViews}async init(){if(this.worker)return!0;return new Promise(($)=>{import("./worker-inline.js").then(({WORKER_CODE:F})=>{let q=new Blob([F],{type:"application/javascript"}),E=URL.createObjectURL(q);this.worker=new Worker(E,{type:"module"}),this.setupWorkerHandlers($)}).catch(()=>{let F=new URL("./gpu-worker.js",import.meta.url);this.worker=new Worker(F,{type:"module"}),this.setupWorkerHandlers($)})})}setupWorkerHandlers($){if(!this.worker)return;this.worker.onmessage=(F)=>{let{type:q,...E}=F.data;switch(q){case"gpu-ready":$(!0);break;case"error":console.error("ChartManager GPU Error:",E.message),$(!1);break;case"stats":this.currentStats={fps:E.fps,renderMs:E.renderMs,total:E.totalCharts,active:E.activeCharts};for(let G of this.statsCallbacks)G(this.currentStats);break;case"bounds-update":{let G=this.charts.get(E.id);if(G)G.bounds={minX:E.minX,maxX:E.maxX,minY:E.minY,maxY:E.maxY},this.drawChart(G);break}default:break}},this.worker.onerror=(F)=>{console.error("ChartManager Worker Error:",F),$(!1)},this.worker.postMessage({type:"init",isDark:this._isDark})}create($){if(!this.worker)throw new Error("ChartManager not initialized. Call init() first.");let F=`chart-${++this.chartIdCounter}`,q=document.createElement("div");q.dataset.chartId=F,q.style.cssText="width: 100%; height: 100%; position: relative;";let E=document.createElement("div");E.dataset.chartId=F,E.style.cssText="width: 100%; height: 100%; position: relative;";let G=document.createElement("canvas");G.style.cssText="position: absolute; inset: 0; width: 100%; height: 100%; pointer-events: none;";let j=document.createElement("canvas");j.style.cssText="position: absolute; inset: 0; width: 100%; height: 100%; pointer-events: auto; z-index: 1;";let Q=document.createElement("canvas");Q.style.cssText="position: absolute; inset: 0; width: 100%; height: 100%; pointer-events: none; z-index: 2;",E.appendChild(G),E.appendChild(j),E.appendChild(Q),q.appendChild(E),$.container.appendChild(q);let K;try{K=j.transferControlToOffscreen()}catch(_){throw console.error(`ChartManager: Failed to create offscreen canvas for ${F}:`,_),new Error(`Failed to create chart ${F}: ${_}`)}let N=E.getBoundingClientRect(),V=N.width||400,A=N.height||200;if(U.resizeCanvas(K,V,A),U.resizeCanvas(G,V,A),U.resizeCanvas(Q,V,A),$.bgColor){let[_,Z,O]=$.bgColor;E.style.background=`rgb(${Math.round(_*255)},${Math.round(Z*255)},${Math.round(O*255)})`}let J={id:F,config:$,el:q,backCanvas:G,axisCanvas:Q,width:V,height:A,series:[],bounds:{minX:0,maxX:1,minY:0,maxY:1},view:{panX:0,panY:0,zoomX:1,zoomY:1},zoomMode:$.zoomMode||"both",visible:!0,dragging:!1,bgColor:$.bgColor,textColor:$.textColor,gridColor:$.gridColor,fontFamily:$.fontFamily,momentum:null,findNearestPoint(_,Z,O,f){if(this.series.length===0)return null;let W=_/O,z=Z/f,M=this.bounds.maxX-this.bounds.minX,D=this.bounds.maxY-this.bounds.minY,P=M/this.view.zoomX,u=D/this.view.zoomY,p=this.bounds.minX+this.view.panX*M,m=this.bounds.minY+this.view.panY*D,I=p+W*P,L=m+(1-z)*u,H=-1,B=-1,T=1/0,w=1/0;for(let i=0;i<this.series.length;i++){let v=this.series[i],g=v.rawX.length;if(g===0)continue;let Y=0,c=g-1;while(Y<c){let e=Y+c>>1;if(v.rawX[e]<I)Y=e+1;else c=e}let t=Y;if(Y>0){let e=Math.abs(v.rawX[Y]-I);if(Math.abs(v.rawX[Y-1]-I)<e)t=Y-1}let J0=Math.abs(v.rawX[t]-I),A0=Math.abs(v.rawY[t]-L);if(J0<T||J0===T&&A0<w)T=J0,w=A0,H=i,B=t}if(H===-1)return null;let S=this.series[H],C=(S.rawX[B]-p)/P*O;if(Math.abs(C-_)>U.HOVER_MAX_DISTANCE_PX)return null;return{x:S.rawX[B],y:S.rawY[B],index:B,screenX:_,screenY:Z,seriesIndex:H,seriesLabel:S.label}}};this.charts.set(F,J);let R=$.type==="bar"?"box":$.type;this.worker.postMessage({type:"register-chart",id:F,canvas:K,chartType:R,pointSize:$.pointSize??3,maxSamplesPerPixel:$.maxSamplesPerPixel??1e4,bgColor:$.bgColor??null},[K]),this.visibilityObserver.observe(q),this.resizeObserver.observe(E);for(let _ of r)_.install?.(J,E);return this.updateSeries(F,$.series),F}destroy($){let F=this.charts.get($);if(!F)return;for(let E of r)E.uninstall?.(F);if(F.momentum)cancelAnimationFrame(F.momentum);this.visibilityObserver.unobserve(F.el);let q=F.el.querySelector(".gpu-chart-canvas-wrap");if(q)this.resizeObserver.unobserve(q);F.el.remove(),this.worker?.postMessage({type:"unregister-chart",id:$}),this.charts.delete($)}updateSeries($,F){let q=this.charts.get($);if(!q||!this.worker)return;if(F.length===0)return;q.series=F.map((J)=>{let R=J.x.length;if(R===0)return{label:J.label,color:J.color,rawX:[],rawY:[]};let _=Array.from({length:R},(Z,O)=>O);return _.sort((Z,O)=>J.x[Z]-J.x[O]),{label:J.label,color:J.color,rawX:_.map((Z)=>J.x[Z]),rawY:_.map((Z)=>J.y[Z])}});let E=1/0,G=-1/0,j=1/0,Q=-1/0;for(let J of q.series)for(let R=0;R<J.rawX.length;R++){if(J.rawX[R]<E)E=J.rawX[R];if(J.rawX[R]>G)G=J.rawX[R];if(J.rawY[R]<j)j=J.rawY[R];if(J.rawY[R]>Q)Q=J.rawY[R]}let K=(G-E)*0.05||1,N=(Q-j)*0.1||1;E-=K,G+=K,j-=N,Q+=N;let V=q.config.defaultBounds;if(V){if(V.minX!==void 0)E=V.minX;if(V.maxX!==void 0)G=V.maxX;if(V.minY!==void 0)j=V.minY;if(V.maxY!==void 0)Q=V.maxY}q.bounds={minX:E,maxX:G,minY:j,maxY:Q};let A=q.series.map((J)=>({label:J.label,colorR:J.color.r,colorG:J.color.g,colorB:J.color.b,dataX:new Float32Array(J.rawX),dataY:new Float32Array(J.rawY)}));this.worker.postMessage({type:"update-series",id:$,series:A,bounds:q.bounds},A.flatMap((J)=>[J.dataX.buffer,J.dataY.buffer])),this.sendViewTransform(q),this.drawChart(q)}setPointSize($,F){if(!this.charts.get($))return;this.worker?.postMessage({type:"set-point-size",id:$,pointSize:Math.max(1,Math.min(8,Math.round(F)))})}setMaxSamplesPerPixel($,F){if(!this.charts.get($))return;this.worker?.postMessage({type:"set-max-samples",id:$,maxSamplesPerPixel:Math.max(0,F|0)})}setStyle($,F){let q=this.charts.get($);if(!q)return;if(F.bgColor!==void 0)q.bgColor=F.bgColor;if(F.textColor!==void 0)q.textColor=F.textColor;if(F.gridColor!==void 0)q.gridColor=F.gridColor;if(F.fontFamily!==void 0)q.fontFamily=F.fontFamily;if(F.bgColor!==void 0){let E=q.el.querySelector(".gpu-chart-canvas-wrap");if(E){let[G,j,Q]=F.bgColor;E.style.background=`rgb(${Math.round(G*255)},${Math.round(j*255)},${Math.round(Q*255)})`}this.worker?.postMessage({type:"set-style",id:$,bgColor:F.bgColor})}this.drawChart(q)}setZoomMode($,F){let q=this.charts.get($);if(q)q.zoomMode=F}getChartCount(){return this.charts.size}getZoomMode($){return this.charts.get($)?.zoomMode||"both"}setSyncViews($){this._syncViews=$}setTheme($){this._isDark=$,this.worker?.postMessage({type:"theme",isDark:$});for(let F of this.charts.values())this.drawChart(F)}onStats($){return this.statsCallbacks.push($),()=>{let F=this.statsCallbacks.indexOf($);if(F>=0)this.statsCallbacks.splice(F,1)}}getStats(){return{...this.currentStats}}resetView($){let F=this.charts.get($);if(!F)return;if(F.momentum)cancelAnimationFrame(F.momentum),F.momentum=null;let q=F.view.panX,E=F.view.panY,G=F.view.zoomX,j=F.view.zoomY,Q=performance.now(),K=()=>{let N=Math.min(1,(performance.now()-Q)/300),V=1-Math.pow(1-N,3);if(F.view.panX=q*(1-V),F.view.panY=E*(1-V),F.view.zoomX=G+(1-G)*V,F.view.zoomY=j+(1-j)*V,this.sendViewTransform(F),this.drawChart(F),this._syncViews)this.syncAllViews(F);if(N<1)requestAnimationFrame(K)};requestAnimationFrame(K)}sendViewTransform($){this.worker?.postMessage({type:"view-transform",id:$.id,panX:$.view.panX,panY:$.view.panY,zoomX:$.view.zoomX,zoomY:$.view.zoomY})}syncAllViews($){let F=[];for(let q of this.charts.values())if(q.id!==$.id)q.view={...$.view},F.push({id:q.id}),this.drawChart(q);if(F.length>0)this.worker?.postMessage({type:"batch-view-transform",panX:$.view.panX,panY:$.view.panY,zoomX:$.view.zoomX,zoomY:$.view.zoomY,transforms:F})}drawChart($){if(!$.visible)return;let F=devicePixelRatio||1,q=$.backCanvas.getContext("2d");if(q){q.clearRect(0,0,$.backCanvas.width,$.backCanvas.height),q.save(),q.scale(F,F);for(let G of r)G.beforeDraw?.(q,$);q.restore()}let E=$.axisCanvas.getContext("2d");if(E){E.clearRect(0,0,$.axisCanvas.width,$.axisCanvas.height),E.save(),E.scale(F,F);for(let G of r)G.afterDraw?.(E,$);E.restore()}}}var $0=($,F,q)=>{let E=F-$;if(E<=0)return[$];let G=E/q,j=10**Math.floor(Math.log10(G)),Q=G/j,K=j*(Q<=1.5?1:Q<=3?2:Q<=7?5:10),N=[];for(let V=Math.ceil($/K)*K;V<=F;V+=K)N.push(V);return N},L0=($)=>{let F=U.getInstance(),q=$.width,E=$.height,G=U.MARGIN,{bounds:j,view:Q}=$,K=j.maxX-j.minX,N=j.maxY-j.minY,V=K/Q.zoomX,A=N/Q.zoomY,J=j.minX+Q.panX*K,R=j.minY+Q.panY*N,_=$.bgColor??(F.isDark?[0.11,0.11,0.12]:[0.98,0.98,0.98]);return{w:q,h:E,m:G,rx:V,ry:A,mx:J,my:R,bg:`${Math.round(_[0]*255)},${Math.round(_[1]*255)},${Math.round(_[2]*255)}`,font:$.fontFamily??U.DEFAULT_FONT,text:$.textColor??(F.isDark?"#c0c0c0":"#333333"),grid:$.gridColor??(F.isDark?"rgba(255,255,255,0.06)":"rgba(0,0,0,0.06)")}},R0={name:"labels",beforeDraw($,F){let{w:q,h:E,m:G,rx:j,ry:Q,mx:K,my:N,grid:V}=L0(F);$.strokeStyle=V,$.lineWidth=1,$.beginPath(),$0(N,N+Q,7).forEach((A)=>{let J=E*(1-(A-N)/Q);if(J>5&&J<E-G.bottom-5)$.moveTo(G.left,J),$.lineTo(q,J)}),$0(K,K+j,8).forEach((A)=>{let J=q*((A-K)/j);if(J>G.left&&J<q)$.moveTo(J,0),$.lineTo(J,E-G.bottom)}),$.stroke()},afterDraw($,F){let{w:q,h:E,m:G,rx:j,ry:Q,mx:K,my:N,bg:V,font:A,text:J}=L0(F),{formatX:R=String,formatY:_=String,labelSize:Z=U.DEFAULT_LABEL_SIZE}=F.config,O=(f,W,z,M,D)=>{let P=f==="left"?$.createLinearGradient(W,0,W+M,0):$.createLinearGradient(0,z,0,z+D),u=f==="left"?[1,0.7,0.2,0.05,0]:[0,0.05,0.2,0.7,1];[0,0.35,0.55,0.7,1].forEach((p,m)=>P.addColorStop(p,`rgba(${V},${u[m]})`)),$.fillStyle=P,$.fillRect(W,z,M,D)};O("left",0,0,G.left+20,E),O("bottom",0,E-G.bottom-20,q,G.bottom+20),$.font=`${Z}px ${A}`,$.fillStyle=J,$.textAlign="right",$.textBaseline="middle",$0(N,N+Q,7).forEach((f)=>{let W=E*(1-(f-N)/Q);if(W>5&&W<E-G.bottom-5)$.fillText(_(f),G.left-5,W)}),$.textAlign="right",$.textBaseline="top",$0(K,K+j,8).forEach((f)=>{let W=q*((f-K)/j);if(W<G.left-10||W>q+30)return;$.save(),$.translate(W,E-G.bottom+5),$.rotate(-Math.PI/14),$.fillText(R(f),0,0),$.restore()})}};function B0($={}){let F=$.momentumDecay??0.91,q=new WeakMap;return{name:"zoom",install(E,G){let j=G.style.touchAction,Q=G.style.userSelect,K=G.style.webkitUserSelect;G.style.touchAction="pan-x pan-y",G.style.userSelect="none",G.style.webkitUserSelect="none";let N=U.getInstance(),V=new AbortController,A={lastX:0,lastY:0,velX:0,velY:0,abort:V,originalTouchAction:j,originalUserSelect:Q,originalWebkitUserSelect:K,el:G};q.set(E,A);let J=[],R=0,_=0,Z=1,O=1,f=0.5,W=0.5,z=null,M=!1,D=500,P=()=>{if(N.sendViewTransform(E),N.drawChart(E),N.syncViews)N.syncAllViews(E)},u=()=>{if(E.momentum)cancelAnimationFrame(E.momentum);let L=()=>{if(A.velX*=F,A.velY*=F,Math.abs(A.velX)>0.00005||Math.abs(A.velY)>0.00005){if(E.zoomMode!=="none"&&(E.zoomMode==="both"||E.zoomMode==="x-only"))E.view.panX-=A.velX/E.view.zoomX;if(E.zoomMode!=="none"&&(E.zoomMode==="both"||E.zoomMode==="y-only"))E.view.panY+=A.velY/E.view.zoomY;P(),E.momentum=requestAnimationFrame(L)}else E.momentum=null};E.momentum=requestAnimationFrame(L)},p=(L)=>{if(E.dragging&&J.length===0)E.dragging=!1};G.addEventListener("pointerdown",(L)=>{if(E.momentum)cancelAnimationFrame(E.momentum),E.momentum=null;if(J.push(L),G.setPointerCapture(L.pointerId),J.length===1){if(E.dragging=!0,A.lastX=L.clientX,A.lastY=L.clientY,A.velX=A.velY=0,R=performance.now(),M=!1,L.pointerType==="touch")z=window.setTimeout(()=>{M=!0,E.dragging=!1},D)}else if(J.length===2){if(z)clearTimeout(z),z=null;if(M=!1,L.pointerType==="touch")L.preventDefault();let H=G.getBoundingClientRect(),B=J[1].clientX-J[0].clientX,T=J[1].clientY-J[0].clientY;_=Math.hypot(B,T),Z=E.view.zoomX,O=E.view.zoomY,f=((J[0].clientX+J[1].clientX)/2-H.left)/H.width,W=1-((J[0].clientY+J[1].clientY)/2-H.top)/H.height}},{passive:!1,signal:V.signal}),G.addEventListener("pointermove",(L)=>{let H=J.findIndex((B)=>B.pointerId===L.pointerId);if(H>=0)J[H]=L;if(J.length===1&&E.dragging){let B=G.getBoundingClientRect(),T=(L.clientX-A.lastX)/B.width,w=(L.clientY-A.lastY)/B.height,S=0.005;if(z&&(Math.abs(T)>0.005||Math.abs(w)>0.005))clearTimeout(z),z=null;if(M){A.lastX=L.clientX,A.lastY=L.clientY;return}if(L.pointerType==="touch")L.preventDefault();let y=performance.now();if(y-R<100)A.velX=A.velX*0.5+T*0.5,A.velY=A.velY*0.5+w*0.5;if(R=y,E.zoomMode!=="none"&&(E.zoomMode==="both"||E.zoomMode==="x-only"))E.view.panX-=T/E.view.zoomX;if(E.zoomMode!=="none"&&(E.zoomMode==="both"||E.zoomMode==="y-only"))E.view.panY+=w/E.view.zoomY;A.lastX=L.clientX,A.lastY=L.clientY,P()}else if(J.length===2){if(L.pointerType==="touch")L.preventDefault();let B=J[1].clientX-J[0].clientX,T=J[1].clientY-J[0].clientY,S=Math.hypot(B,T)/_;if(E.zoomMode!=="none"&&(E.zoomMode==="both"||E.zoomMode==="x-only")){let y=Math.max(U.MIN_ZOOM,Math.min(U.MAX_ZOOM,Z*S)),C=E.view.panX+f/Z;E.view.zoomX=y,E.view.panX=C-f/y}if(E.zoomMode!=="none"&&(E.zoomMode==="both"||E.zoomMode==="y-only")){let y=Math.max(U.MIN_ZOOM,Math.min(U.MAX_ZOOM,O*S)),C=E.view.panY+W/O;E.view.zoomY=y,E.view.panY=C-W/y}P()}},{passive:!1,signal:V.signal});let m=(L)=>{if(J=J.filter((H)=>H.pointerId!==L.pointerId),G.releasePointerCapture(L.pointerId),z)clearTimeout(z),z=null;if(J.length===0){if(M=!1,E.dragging){if(E.dragging=!1,!M&&(Math.abs(A.velX)>0.001||Math.abs(A.velY)>0.001))u()}}};G.addEventListener("pointerup",m,{signal:V.signal}),G.addEventListener("pointercancel",m,{signal:V.signal}),G.addEventListener("pointerleave",p,{signal:V.signal});let I=0;G.addEventListener("pointerup",(L)=>{if(J.length===1&&L.pointerType==="touch"){let H=Date.now();if(H-I<300)N.resetView(E.id),I=0;else I=H}else if(L.pointerType!=="touch"){let H=Date.now();if(H-I<300)N.resetView(E.id),I=0;else I=H}},{signal:V.signal}),G.addEventListener("wheel",(L)=>{if(L.preventDefault(),E.momentum)cancelAnimationFrame(E.momentum),E.momentum=null;let H=G.getBoundingClientRect(),B=L.clientX-H.left,T=L.clientY-H.top,w=B/H.width,S=1-T/H.height,y=1-L.deltaY*0.002,C=U.MARGIN,h=B<C.left,i=T>H.height-C.bottom,v,g;if(h)v=!1,g=!0;else if(i)v=!0,g=!1;else v=E.zoomMode==="both"||E.zoomMode==="x-only",g=E.zoomMode==="both"||E.zoomMode==="y-only";if(v){let Y=E.view.panX+w/E.view.zoomX;E.view.zoomX=Math.max(U.MIN_ZOOM,Math.min(U.MAX_ZOOM,E.view.zoomX*y)),E.view.panX=Y-w/E.view.zoomX}if(g){let Y=E.view.panY+S/E.view.zoomY;E.view.zoomY=Math.max(U.MIN_ZOOM,Math.min(U.MAX_ZOOM,E.view.zoomY*y)),E.view.panY=Y-S/E.view.zoomY}if(v||g)P()},{passive:!1,signal:V.signal})},uninstall(E){let G=q.get(E);if(G){if(E.momentum)cancelAnimationFrame(E.momentum),E.momentum=null;G.el.style.touchAction=G.originalTouchAction,G.el.style.userSelect=G.originalUserSelect,G.el.style.webkitUserSelect=G.originalWebkitUserSelect,G.abort.abort(),q.delete(E)}}}}var E0=new WeakMap,I0=($,F,q,E,G,j,Q,K)=>{$.beginPath(),$.roundRect(F,q,E,G,j),$.fillStyle=Q,$.fill(),$.strokeStyle=K,$.lineWidth=1.5,$.stroke()},O0={name:"hover",install($,F){let q=U.getInstance(),E=new AbortController,G={hoverResult:null,pillX:0,pillY:0,pillTargetX:0,pillTargetY:0,pillAnimRef:null,abort:E};E0.set($,G);let j=(K)=>{if($.config.onHover)$.config.onHover(K);if(!($.config.showTooltip??!1))return;if(G.hoverResult=K,q.drawChart($),K&&!G.pillAnimRef){let N=performance.now(),V=(A)=>{if(!G.hoverResult)return G.pillAnimRef=null;let J=1-Math.pow(0.5,(A-N)/($.config.pillDecayMs??60));N=A,G.pillX+=(G.pillTargetX-G.pillX)*J,G.pillY+=(G.pillTargetY-G.pillY)*J,q.drawChart($),G.pillAnimRef=requestAnimationFrame(V)};G.pillAnimRef=requestAnimationFrame(V)}},Q=(K,N)=>{if($.dragging)return;let V=F.getBoundingClientRect();j($.findNearestPoint(K-V.left,N-V.top,V.width,V.height))};F.addEventListener("mousemove",(K)=>Q(K.clientX,K.clientY),{signal:E.signal}),F.addEventListener("touchmove",(K)=>{if(K.touches.length===1)Q(K.touches[0].clientX,K.touches[0].clientY)},{signal:E.signal,passive:!0}),["mouseleave","pointerdown","touchend","touchcancel"].forEach((K)=>F.addEventListener(K,()=>j(null),{signal:E.signal}))},afterDraw($,F){let q=E0.get(F);if(!q?.hoverResult||!F.config.showTooltip)return;let{hoverResult:E}=q,G=F.width,j=F.height,Q=U.MARGIN,K=U.getInstance().isDark,{formatX:N=String,formatY:V=String,fontFamily:A=U.DEFAULT_FONT}=F.config,J=(F.bounds.maxX-F.bounds.minX)/F.view.zoomX,R=(F.bounds.maxY-F.bounds.minY)/F.view.zoomY,_=(E.x-(F.bounds.minX+F.view.panX*(F.bounds.maxX-F.bounds.minX)))/J*G,Z=j*(1-(E.y-(F.bounds.minY+F.view.panY*(F.bounds.maxY-F.bounds.minY)))/R),O=F.series[E.seriesIndex]||F.series[0],f=`${Math.round(O.color.r*255)},${Math.round(O.color.g*255)},${Math.round(O.color.b*255)}`,W=`rgb(${f})`,z=K?`oklch(from ${W} calc(l + 0.1) c h)`:W;$.save(),$.setLineDash([4,3]),$.strokeStyle=`rgba(${f},0.4)`,$.stroke(new Path2D(`M${_} 0V${j-Q.bottom}M${Q.left} ${Z}H${G}`)),$.restore(),$.beginPath(),$.arc(_,Z,4.5,0,Math.PI*2),$.fillStyle=W,$.fill(),$.strokeStyle=K?"rgba(0,0,0,0.6)":"rgba(255,255,255,0.9)",$.stroke();let M=F.series.map((B)=>{let T=0,w=B.rawX.length-1;while(T<=w){let S=T+w>>1;if(Math.abs(B.rawX[S]-E.x)<0.0001)return{label:B.label,val:V(B.rawY[S]),rawVal:B.rawY[S],col:`rgb(${Math.round(B.color.r*255)},${Math.round(B.color.g*255)},${Math.round(B.color.b*255)})`};B.rawX[S]<E.x?T=S+1:w=S-1}return null}).filter(Boolean);M.sort((B,T)=>Math.abs(T.rawVal)-Math.abs(B.rawVal));let D=M.length,P=M.slice(0,5),u=D-P.length;if(q.pillTargetX=_,q.pillTargetY=Z,!q.pillAnimRef)q.pillX=_,q.pillY=Z;let p=(B,T,w,S)=>{$.font=`600 10px ${A}`;let y=$.measureText(w).width,C=y+12,h=18,i=S?B-C/2:B-C,v=S?T:T-h/2;$.save();let g=S?Math.atan((q.pillTargetX-q.pillX)/80)*0.2:Math.atan((q.pillTargetY-q.pillY)/80)*0.2;$.translate(B,T),$.rotate(g);let Y=S?-C/2:-C,c=S?0:-h/2;$.beginPath(),$.roundRect(Y,c,C,h,4),$.fillStyle=K?"rgba(0,0,0,0.75)":"rgba(255,255,255,0.75)",$.fill(),$.fillStyle=`rgba(${f},0.2)`,$.fill(),$.strokeStyle=z,$.lineWidth=1.5,$.stroke(),$.fillStyle=z,$.textAlign="center",$.textBaseline="middle",$.fillText(w,Y+C/2,c+h/2),$.restore()};p(Math.max(Q.left,Math.min(G-Q.right,q.pillX)),j-Q.bottom+4,N(E.x),!0),p(Math.max(Q.left,Q.left),Math.max(9,Math.min(j-Q.bottom-9,q.pillY)),V(E.y),!1);let m=Math.max(...P.map((B)=>$.measureText(B.label+B.val).width))+40,I=30+P.length*18+(u>0?18:0),L=E.screenX+14,H=E.screenY-I-6;if(L+m>G)L=E.screenX-m-14;if(H=Math.max(4,Math.min(j-I-4,E.screenY-I-6)),I0($,L,H,m,I,6,K?"rgba(28,28,30,0.95)":"rgba(255,255,255,0.96)","rgba(0,0,0,0.08)"),$.textAlign="left",$.textBaseline="middle",$.fillStyle=K?"#888":"#999",$.fillText(N(E.x),L+10,H+15),P.forEach((B,T)=>{let w=H+35+T*18;$.fillStyle=B.col,$.beginPath(),$.roundRect(L+10,w-4,8,8,2),$.fill(),$.fillStyle=K?"#eee":"#1a1a1a",$.fillText(`${B.label}: ${B.val}`,L+24,w)}),u>0){let B=H+35+P.length*18;$.fillStyle=K?"#666":"#aaa",$.fillText(`+${u} more`,L+10,B)}},uninstall($){let F=E0.get($);if(F?.pillAnimRef)cancelAnimationFrame(F.pillAnimRef);F?.abort.abort(),E0.delete($)}};a(R0);a(B0());a(O0);var k,s=document.documentElement.classList.contains("dark"),Z0=1,Q0=null,N0=!1,H0,z0,T0,X=[],o=[],l=[],n=[],j0=null,K0=null,V0=null;function P0($,F,q){let E=(1-Math.abs(2*q-1))*F,G=E*(1-Math.abs($/60%2-1)),j=q-E/2,Q=0,K=0,N=0;if($<60)Q=E,K=G;else if($<120)Q=G,K=E;else if($<180)K=E,N=G;else if($<240)K=G,N=E;else if($<300)Q=G,N=E;else Q=E,N=G;return{r:Q+j,g:K+j,b:N+j}}function F0(){return P0(Math.random()*360,0.65+Math.random()*0.2,0.5+Math.random()*0.1)}var C0=new Date("2026-02-03");function x($){if($>=1000)return"$"+($/1000).toFixed(1)+"k";if($>=100)return"$"+$.toFixed(0);if($>=10)return"$"+$.toFixed(1);return"$"+$.toFixed(2)}function G0($){let F=C0.getTime()-Math.round($)*60000,q=new Date(F),G=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][q.getMonth()],j=q.getDate(),Q=q.getFullYear();return`${G} ${j}, ${Q}`}function q0($){if(Math.abs($)>=1000)return($/1000).toFixed(1)+"k";if(Math.abs($)>=100)return $.toFixed(0);if(Math.abs($)>=10)return $.toFixed(1);return $.toFixed(2)}function d($){return Math.round($).toString()}function b($,F){let q=new Array($),E=new Array($);if(F==="stock")for(let Q=0;Q<$;Q++)q[Q]=$-1-Q;else for(let Q=0;Q<$;Q++)q[Q]=Q;let j=2*Math.PI;switch(F){case"stock":{let K=Math.LN2/5258880,N=-K*3,V=0.0005,A=0.0009000000000000001,J=$/5258880,R=Math.max(1,Math.round(J*(0.8+Math.random()*0.4))),_=[];for(let z=0;z<R;z++){let M=Math.floor(Math.random()*$*0.9),D=Math.floor((180+Math.random()*360)*1440);_.push({s:M,e:M+D})}_.sort((z,M)=>z.s-M.s);let Z=Math.log(10+Math.random()*20),O=0,f=0,W=!1;for(let z=0;z<$;z++){while(O<_.length&&z>=_[O].e)O++;let M=O<_.length&&z>=_[O].s&&z<_[O].e,D=M?N:K,P=M?0.0009000000000000001:0.0005,u;if(W)u=f,W=!1;else{let p=Math.random()||0.0000000001,m=Math.sqrt(-2*Math.log(p)),I=j*Math.random();u=m*Math.cos(I),f=m*Math.sin(I),W=!0}Z+=D+P*u,E[z]=Math.exp(Z)}break}case"trending":{let Q=Math.log(20+Math.random()*20),K=Math.LN2/$,N=0.015,V=0,A=!1;for(let J=0;J<$;J++){let R;if(A)R=V,A=!1;else{let _=Math.random()||0.0000000001,Z=Math.sqrt(-2*Math.log(_)),O=j*Math.random();R=Z*Math.cos(O),V=Z*Math.sin(O),A=!0}Q+=K+N*R,E[J]=Math.exp(Q)}break}case"declining":{let Q=Math.log(60+Math.random()*40),K=-Math.LN2/$,N=0.015,V=0,A=!1;for(let J=0;J<$;J++){let R;if(A)R=V,A=!1;else{let _=Math.random()||0.0000000001,Z=Math.sqrt(-2*Math.log(_)),O=j*Math.random();R=Z*Math.cos(O),V=Z*Math.sin(O),A=!0}Q+=K+N*R,E[J]=Math.exp(Q)}break}case"spikey":{let Q=20+Math.random()*30,K=3+Math.floor(Math.random()*5),N=new Set;while(N.size<Math.min(K,$))N.add(Math.floor(Math.random()*$));let V=Q*1.2,A=Q*5;for(let J=0;J<$;J++)if(N.has(J))E[J]=Math.random()<0.5?-A:A;else E[J]=(Math.random()-0.5)*V;break}case"cyclic":{let Q=Date.now()%1e5/1e5*j,K=30+Math.random()*20,N=50+Math.random()*20,V=2+Math.random()*4,A=j*V/$,J=K*0.25;for(let R=0;R<$;R++){let _=R*A+Q;E[R]=N+Math.sin(_)*K+Math.sin(_*2.7+1.3)*J+(Math.random()-0.5)*8}break}}return{x:q,y:E}}async function Y0(){if(k=U.getInstance(),!await k.init()){alert("WebGPU not available. Please use a supported browser.");return}v0(),y0(),X0(),b0(),D0(),u0(),m0()}function y0(){let $=b(25,"trending");k.create({type:"bar",container:document.getElementById("basic-bar"),series:[{label:"Revenue",color:{r:0.6,g:0.4,b:0.9},x:$.x,y:$.y}],formatX:d,formatY:x,showTooltip:!0});let F=b(1000,"trending"),q=F.x.map((G,j)=>999-j);k.create({type:"line",container:document.getElementById("basic-line"),series:[{label:"Stock Price",color:{r:0.3,g:0.6,b:1},x:q,y:F.y}],formatX:G0,formatY:x,showTooltip:!0});let E=b(5000,"cyclic");k.create({type:"scatter",container:document.getElementById("basic-scatter"),series:[{label:"Cyclic Data",color:{r:1,g:0.4,b:0.4},x:E.x,y:E.y}],formatX:d,formatY:q0,showTooltip:!0})}function X0(){let $=[],F=b(25,"trending"),q=[1,0.7,1.3];for(let j=0;j<3;j++){let Q=b(25,"trending"),K=Q.y.map((N)=>N*q[j]);$.push({label:`Series ${j+1}`,color:F0(),x:Q.x,y:K})}k.create({type:"bar",container:document.getElementById("series-bar"),series:$,formatX:d,formatY:x,showTooltip:!0});let E=[];for(let j=0;j<3;j++){let Q=b(1000,"trending"),K=Q.x.map((N,V)=>999-V);E.push({label:`Series ${j+1}`,color:F0(),x:K,y:Q.y})}k.create({type:"line",container:document.getElementById("series-line"),series:E,formatX:G0,formatY:x,showTooltip:!0});let G=[];for(let j=0;j<3;j++){let Q=b(5000,"cyclic");G.push({label:`Series ${j+1}`,color:F0(),x:Q.x,y:Q.y})}k.create({type:"scatter",container:document.getElementById("series-scatter"),series:G,formatX:d,formatY:q0,showTooltip:!0})}function b0(){let $=b(1e5,"spikey");k.create({type:"line",container:document.getElementById("spikes-line"),series:[{label:"Volatile Data",color:{r:1,g:0.5,b:0.2},x:$.x,y:$.y}],formatX:d,formatY:q0,showTooltip:!0})}function D0(){let $=b(100,"trending"),F=b(100,"trending"),q=b(100,"trending");X=Array.from({length:100},(j,Q)=>Q),o=[...$.y],l=[...F.y],n=[...q.y],H0=k.create({type:"line",container:document.getElementById("live-line"),series:[{label:"Live Data",color:{r:0.2,g:0.8,b:0.4},x:[...X],y:[...o]}],formatX:d,formatY:x,showTooltip:!0}),z0=k.create({type:"scatter",container:document.getElementById("live-scatter"),series:[{label:"Live Data",color:{r:0.9,g:0.3,b:0.7},x:[...X],y:[...l]}],formatX:d,formatY:x,showTooltip:!0}),T0=k.create({type:"line",container:document.getElementById("live-line2"),series:[{label:"Live Data",color:{r:0.4,g:0.5,b:1},x:[...X],y:[...n]}],formatX:d,formatY:x,showTooltip:!0});let E=document.querySelectorAll(".speed-btn");E.forEach((j)=>{j.addEventListener("click",()=>{E.forEach((Q)=>Q.classList.remove("active")),j.classList.add("active"),Z0=parseInt(j.dataset.speed),U0()})});let G=document.getElementById("accumulate-toggle");G.addEventListener("change",()=>{N0=G.checked}),U0()}function U0(){if(Q0!==null)clearInterval(Q0);let $=1000/Z0;Q0=window.setInterval(()=>{let F=X.length>0?X[X.length-1]+1:0,q=o.length>0?o[o.length-1]:50,E=l.length>0?l[l.length-1]:50,G=n.length>0?n[n.length-1]:50;if(X.push(F),o.push(q+(Math.random()-0.5)*5),l.push(E+(Math.random()-0.5)*8),n.push(G+(Math.random()-0.5)*6),!N0&&X.length>500)X.shift(),o.shift(),l.shift(),n.shift();k.updateSeries(H0,[{label:"Live Data",color:{r:0.2,g:0.8,b:0.4},x:[...X],y:[...o]}]),k.updateSeries(z0,[{label:"Live Data",color:{r:0.9,g:0.3,b:0.7},x:[...X],y:[...l]}]),k.updateSeries(T0,[{label:"Live Data",color:{r:0.4,g:0.5,b:1},x:[...X],y:[...n]}]);let j=N0?"Accumulate":"Ring Buffer";document.getElementById("live-stats").textContent=`Points: ${X.length} (${j})`},$)}function u0(){let $=document.getElementById("bigdata-generate"),F=document.getElementById("bigdata-count"),q=document.getElementById("bigdata-stats");$.addEventListener("click",()=>{let E=parseInt(F.value)||1e6;$.setAttribute("disabled","true"),q.textContent="Generating...",setTimeout(()=>{let G=performance.now();if(j0)k.destroy(j0);if(K0)k.destroy(K0);let j=b(E,"stock"),Q=b(E,"cyclic");j0=k.create({type:"line",container:document.getElementById("bigdata-line"),series:[{label:"Big Data",color:{r:0.3,g:0.7,b:0.9},x:j.x,y:j.y}],formatX:G0,formatY:x,showTooltip:!0}),K0=k.create({type:"scatter",container:document.getElementById("bigdata-scatter"),series:[{label:"Big Data",color:{r:0.9,g:0.5,b:0.3},x:Q.x,y:Q.y}],formatX:d,formatY:q0,showTooltip:!0});let K=performance.now()-G,N=(E/1e6).toFixed(1)+"M";document.getElementById("bigdata-line-info").textContent=N,document.getElementById("bigdata-scatter-info").textContent=N,q.textContent=`Generated in ${K.toFixed(0)}ms`,$.removeAttribute("disabled")},50)})}function m0(){let $=document.getElementById("bigseries-generate"),F=document.getElementById("bigseries-series"),q=document.getElementById("bigseries-points"),E=document.getElementById("bigseries-stats");$.addEventListener("click",()=>{let G=parseInt(F.value)||1000,j=parseInt(q.value)||1000;$.setAttribute("disabled","true"),E.textContent="Generating...",setTimeout(()=>{let Q=performance.now();if(V0)k.destroy(V0);let K=[];for(let J=0;J<G;J++){let R=b(j,"trending"),_=R.x.map((Z,O)=>j-1-O);K.push({label:`S${J+1}`,color:F0(),x:_,y:R.y})}V0=k.create({type:"line",container:document.getElementById("bigseries-line"),series:K,formatX:G0,formatY:x,showTooltip:!0});let N=performance.now()-Q,V=G*j,A=V>=1e6?(V/1e6).toFixed(1)+"M":(V/1000).toFixed(0)+"k";document.getElementById("bigseries-info").textContent=`${G} series Ã— ${j} pts = ${A} total`,E.textContent=`Generated in ${N.toFixed(0)}ms`,$.removeAttribute("disabled")},50)})}function v0(){let $=document.getElementById("theme-btn"),F=document.getElementById("theme-icon-sun"),q=document.getElementById("theme-icon-moon"),E=()=>{F.style.display=s?"none":"block",q.style.display=s?"block":"none"};E(),$.addEventListener("click",()=>{s=!s,document.documentElement.classList.toggle("dark",s),localStorage.setItem("theme",s?"dark":"light"),k.setTheme(s),E()})}Y0();
