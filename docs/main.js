var u=[];function i(o){if(!u.some((M)=>M.name===o.name))u.push(o)}class R{static instance=null;static MARGIN={left:55,right:10,top:8,bottom:45};static HOVER_MAX_DISTANCE_PX=50;static MIN_ZOOM=0.1;static MAX_ZOOM=1e7;static DEFAULT_LABEL_SIZE=12;static DEFAULT_FONT='-apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif';static resizeCanvas(o,M,z){let m=devicePixelRatio||1;if(o.width=Math.round(M*m),o.height=Math.round(z*m),o instanceof HTMLCanvasElement)o.style.width=`${M}px`,o.style.height=`${z}px`}worker=null;charts=new Map;chartIdCounter=0;_syncViews=!1;_isDark=!1;statsCallbacks=[];currentStats={fps:0,renderMs:0,total:0,active:0};visibilityObserver;resizeObserver;constructor(){this._isDark=document.documentElement.classList.contains("dark"),this.visibilityObserver=new IntersectionObserver((o)=>{for(let M of o){let z=M.target.dataset.chartId;if(z){let m=this.charts.get(z);if(m)m.visible=M.isIntersecting,this.worker?.postMessage({type:"set-visibility",id:z,visible:M.isIntersecting})}}},{threshold:0.01}),this.resizeObserver=new ResizeObserver((o)=>{for(let M of o){let z=M.target.dataset.chartId;if(!z)continue;let m=this.charts.get(z);if(!m)continue;let{width:f,height:A}=M.contentRect;if(f<=0||A<=0)continue;m.width=f,m.height=A;let Y=devicePixelRatio||1;this.worker?.postMessage({type:"resize",id:z,width:Math.round(f*Y),height:Math.round(A*Y)}),R.resizeCanvas(m.backCanvas,f,A),R.resizeCanvas(m.axisCanvas,f,A),this.drawChart(m)}})}static getInstance(){if(!R.instance)R.instance=new R;return R.instance}get isDark(){return this._isDark}get syncViews(){return this._syncViews}async init(){if(this.worker)return!0;return new Promise((o)=>{let M=new URL("./gpu-worker.js",import.meta.url);this.worker=new Worker(M,{type:"module"}),this.worker.onmessage=(z)=>{let{type:m,...f}=z.data;switch(m){case"gpu-ready":o(!0);break;case"error":console.error("ChartManager GPU Error:",f.message),o(!1);break;case"stats":this.currentStats={fps:f.fps,renderMs:f.renderMs,total:f.totalCharts,active:f.activeCharts};for(let A of this.statsCallbacks)A(this.currentStats);break;case"bounds-update":{let A=this.charts.get(f.id);if(A)A.bounds={minX:f.minX,maxX:f.maxX,minY:f.minY,maxY:f.maxY},this.drawChart(A);break}}},this.worker.postMessage({type:"init",isDark:this._isDark})})}create(o){if(!this.worker)throw new Error("ChartManager not initialized. Call init() first.");let M=`chart-${++this.chartIdCounter}`,z=document.createElement("div");z.className="gpu-chart",z.dataset.chartId=M;let m=document.createElement("div");m.className="gpu-chart-canvas-wrap",m.dataset.chartId=M;let f=document.createElement("canvas");f.className="gpu-chart-back-canvas";let A=document.createElement("canvas");A.className="gpu-chart-canvas";let Y=document.createElement("canvas");Y.className="gpu-chart-axis-canvas",m.appendChild(f),m.appendChild(A),m.appendChild(Y),z.appendChild(m),o.container.appendChild(z);let E;try{E=A.transferControlToOffscreen()}catch(F){throw console.error(`ChartManager: Failed to create offscreen canvas for ${M}:`,F),new Error(`Failed to create chart ${M}: ${F}`)}let O=m.getBoundingClientRect(),w=O.width||400,L=O.height||200;if(R.resizeCanvas(E,w,L),R.resizeCanvas(f,w,L),R.resizeCanvas(Y,w,L),o.bgColor){let[F,N,X]=o.bgColor;m.style.background=`rgb(${Math.round(F*255)},${Math.round(N*255)},${Math.round(X*255)})`}let Z={id:M,config:o,el:z,backCanvas:f,axisCanvas:Y,width:w,height:L,series:[],bounds:{minX:0,maxX:1,minY:0,maxY:1},view:{panX:0,panY:0,zoomX:1,zoomY:1},zoomMode:o.zoomMode||"both",visible:!0,dragging:!1,bgColor:o.bgColor,textColor:o.textColor,gridColor:o.gridColor,fontFamily:o.fontFamily,momentum:null,findNearestPoint(F,N,X,B){if(this.series.length===0)return null;let G=F/X,J=N/B,j=this.bounds.maxX-this.bounds.minX,V=this.bounds.maxY-this.bounds.minY,K=j/this.view.zoomX,Q=V/this.view.zoomY,_=this.bounds.minX+this.view.panX*j,H=this.bounds.minY+this.view.panY*V,T=_+G*K,l=H+(1-J)*Q,I=-1,q=-1,v=1/0,D=1/0;for(let n=0;n<this.series.length;n++){let k=this.series[n],x=k.rawX.length;if(x===0)continue;let P=0,C=x-1;while(P<C){let d=P+C>>1;if(k.rawX[d]<T)P=d+1;else C=d}let e=P;if(P>0){let d=Math.abs(k.rawX[P]-T);if(Math.abs(k.rawX[P-1]-T)<d)e=P-1}let c=Math.abs(k.rawX[e]-T),r=Math.abs(k.rawY[e]-l);if(c<v||c===v&&r<D)v=c,D=r,I=n,q=e}if(I===-1)return null;let U=this.series[I],S=(U.rawX[q]-_)/K*X;if(Math.abs(S-F)>R.HOVER_MAX_DISTANCE_PX)return null;return{x:U.rawX[q],y:U.rawY[q],index:q,screenX:F,screenY:N,seriesIndex:I,seriesLabel:U.label}}};this.charts.set(M,Z);let $=o.type==="bar"?"box":o.type;this.worker.postMessage({type:"register-chart",id:M,canvas:E,chartType:$,pointSize:o.pointSize??3,maxSamplesPerPixel:o.maxSamplesPerPixel??1e4,bgColor:o.bgColor??null},[E]),this.visibilityObserver.observe(z),this.resizeObserver.observe(m);for(let F of u)F.install?.(Z,m);return this.updateSeries(M,o.series),M}destroy(o){let M=this.charts.get(o);if(!M)return;for(let m of u)m.uninstall?.(M);if(M.momentum)cancelAnimationFrame(M.momentum);this.visibilityObserver.unobserve(M.el);let z=M.el.querySelector(".gpu-chart-canvas-wrap");if(z)this.resizeObserver.unobserve(z);M.el.remove(),this.worker?.postMessage({type:"unregister-chart",id:o}),this.charts.delete(o)}updateSeries(o,M){let z=this.charts.get(o);if(!z||!this.worker)return;if(M.length===0)return;z.series=M.map((Z)=>{let $=Z.x.length;if($===0)return{label:Z.label,color:Z.color,rawX:[],rawY:[]};let F=Array.from({length:$},(N,X)=>X);return F.sort((N,X)=>Z.x[N]-Z.x[X]),{label:Z.label,color:Z.color,rawX:F.map((N)=>Z.x[N]),rawY:F.map((N)=>Z.y[N])}});let m=1/0,f=-1/0,A=1/0,Y=-1/0;for(let Z of z.series)for(let $=0;$<Z.rawX.length;$++){if(Z.rawX[$]<m)m=Z.rawX[$];if(Z.rawX[$]>f)f=Z.rawX[$];if(Z.rawY[$]<A)A=Z.rawY[$];if(Z.rawY[$]>Y)Y=Z.rawY[$]}let E=(f-m)*0.05||1,O=(Y-A)*0.1||1;m-=E,f+=E,A-=O,Y+=O;let w=z.config.defaultBounds;if(w){if(w.minX!==void 0)m=w.minX;if(w.maxX!==void 0)f=w.maxX;if(w.minY!==void 0)A=w.minY;if(w.maxY!==void 0)Y=w.maxY}z.bounds={minX:m,maxX:f,minY:A,maxY:Y};let L=z.series.map((Z)=>({label:Z.label,colorR:Z.color.r,colorG:Z.color.g,colorB:Z.color.b,dataX:new Float32Array(Z.rawX),dataY:new Float32Array(Z.rawY)}));this.worker.postMessage({type:"update-series",id:o,series:L,bounds:z.bounds},L.flatMap((Z)=>[Z.dataX.buffer,Z.dataY.buffer])),this.sendViewTransform(z),this.drawChart(z)}setPointSize(o,M){if(!this.charts.get(o))return;this.worker?.postMessage({type:"set-point-size",id:o,pointSize:Math.max(1,Math.min(8,Math.round(M)))})}setMaxSamplesPerPixel(o,M){if(!this.charts.get(o))return;this.worker?.postMessage({type:"set-max-samples",id:o,maxSamplesPerPixel:Math.max(0,M|0)})}setStyle(o,M){let z=this.charts.get(o);if(!z)return;if(M.bgColor!==void 0)z.bgColor=M.bgColor;if(M.textColor!==void 0)z.textColor=M.textColor;if(M.gridColor!==void 0)z.gridColor=M.gridColor;if(M.fontFamily!==void 0)z.fontFamily=M.fontFamily;if(M.bgColor!==void 0){let m=z.el.querySelector(".gpu-chart-canvas-wrap");if(m){let[f,A,Y]=M.bgColor;m.style.background=`rgb(${Math.round(f*255)},${Math.round(A*255)},${Math.round(Y*255)})`}this.worker?.postMessage({type:"set-style",id:o,bgColor:M.bgColor})}this.drawChart(z)}setZoomMode(o,M){let z=this.charts.get(o);if(z)z.zoomMode=M}getChartCount(){return this.charts.size}getZoomMode(o){return this.charts.get(o)?.zoomMode||"both"}setSyncViews(o){this._syncViews=o}setTheme(o){this._isDark=o,this.worker?.postMessage({type:"theme",isDark:o});for(let M of this.charts.values())this.drawChart(M)}onStats(o){return this.statsCallbacks.push(o),()=>{let M=this.statsCallbacks.indexOf(o);if(M>=0)this.statsCallbacks.splice(M,1)}}getStats(){return{...this.currentStats}}resetView(o){let M=this.charts.get(o);if(!M)return;if(M.momentum)cancelAnimationFrame(M.momentum),M.momentum=null;let z=M.view.panX,m=M.view.panY,f=M.view.zoomX,A=M.view.zoomY,Y=performance.now(),E=()=>{let O=Math.min(1,(performance.now()-Y)/300),w=1-Math.pow(1-O,3);if(M.view.panX=z*(1-w),M.view.panY=m*(1-w),M.view.zoomX=f+(1-f)*w,M.view.zoomY=A+(1-A)*w,this.sendViewTransform(M),this.drawChart(M),this._syncViews)this.syncAllViews(M);if(O<1)requestAnimationFrame(E)};requestAnimationFrame(E)}sendViewTransform(o){this.worker?.postMessage({type:"view-transform",id:o.id,panX:o.view.panX,panY:o.view.panY,zoomX:o.view.zoomX,zoomY:o.view.zoomY})}syncAllViews(o){let M=[];for(let z of this.charts.values())if(z.id!==o.id)z.view={...o.view},M.push({id:z.id}),this.drawChart(z);if(M.length>0)this.worker?.postMessage({type:"batch-view-transform",panX:o.view.panX,panY:o.view.panY,zoomX:o.view.zoomX,zoomY:o.view.zoomY,transforms:M})}drawChart(o){if(!o.visible)return;let M=devicePixelRatio||1,z=o.backCanvas.getContext("2d");if(z){z.clearRect(0,0,o.backCanvas.width,o.backCanvas.height),z.save(),z.scale(M,M);for(let f of u)f.beforeDraw?.(z,o);z.restore()}let m=o.axisCanvas.getContext("2d");if(m){m.clearRect(0,0,o.axisCanvas.width,o.axisCanvas.height),m.save(),m.scale(M,M);for(let f of u)f.afterDraw?.(m,o);m.restore()}}}var h=(o,M,z)=>{let m=M-o;if(m<=0)return[o];let f=m/z,A=10**Math.floor(Math.log10(f)),Y=f/A,E=A*(Y<=1.5?1:Y<=3?2:Y<=7?5:10),O=[];for(let w=Math.ceil(o/E)*E;w<=M;w+=E)O.push(w);return O},a=(o)=>{let M=R.getInstance(),z=o.width,m=o.height,f=R.MARGIN,{bounds:A,view:Y}=o,E=A.maxX-A.minX,O=A.maxY-A.minY,w=E/Y.zoomX,L=O/Y.zoomY,Z=A.minX+Y.panX*E,$=A.minY+Y.panY*O,F=o.bgColor??(M.isDark?[0.11,0.11,0.12]:[0.98,0.98,0.98]);return{w:z,h:m,m:f,rx:w,ry:L,mx:Z,my:$,bg:`${Math.round(F[0]*255)},${Math.round(F[1]*255)},${Math.round(F[2]*255)}`,font:o.fontFamily??R.DEFAULT_FONT,text:o.textColor??(M.isDark?"#c0c0c0":"#333333"),grid:o.gridColor??(M.isDark?"rgba(255,255,255,0.06)":"rgba(0,0,0,0.06)")}},oo={name:"labels",beforeDraw(o,M){let{w:z,h:m,m:f,rx:A,ry:Y,mx:E,my:O,grid:w}=a(M);o.strokeStyle=w,o.lineWidth=1,o.beginPath(),h(O,O+Y,7).forEach((L)=>{let Z=m*(1-(L-O)/Y);if(Z>5&&Z<m-f.bottom-5)o.moveTo(f.left,Z),o.lineTo(z,Z)}),h(E,E+A,8).forEach((L)=>{let Z=z*((L-E)/A);if(Z>f.left&&Z<z)o.moveTo(Z,0),o.lineTo(Z,m-f.bottom)}),o.stroke()},afterDraw(o,M){let{w:z,h:m,m:f,rx:A,ry:Y,mx:E,my:O,bg:w,font:L,text:Z}=a(M),{formatX:$=String,formatY:F=String,labelSize:N=R.DEFAULT_LABEL_SIZE}=M.config,X=(B,G,J,j,V)=>{let K=B==="left"?o.createLinearGradient(G,0,G+j,0):o.createLinearGradient(0,J,0,J+V),Q=B==="left"?[1,0.7,0.2,0.05,0]:[0,0.05,0.2,0.7,1];[0,0.35,0.55,0.7,1].forEach((_,H)=>K.addColorStop(_,`rgba(${w},${Q[H]})`)),o.fillStyle=K,o.fillRect(G,J,j,V)};X("left",0,0,f.left+20,m),X("bottom",0,m-f.bottom-20,z,f.bottom+20),o.font=`${N}px ${L}`,o.fillStyle=Z,o.textAlign="right",o.textBaseline="middle",h(O,O+Y,7).forEach((B)=>{let G=m*(1-(B-O)/Y);if(G>5&&G<m-f.bottom-5)o.fillText(F(B),f.left-5,G)}),o.textAlign="right",o.textBaseline="top",h(E,E+A,8).forEach((B)=>{let G=z*((B-E)/A);if(G<f.left-10||G>z+30)return;o.save(),o.translate(G,m-f.bottom+5),o.rotate(-Math.PI/14),o.fillText($(B),0,0),o.restore()})}};function mo(o={}){let M=o.momentumDecay??0.91,z=new WeakMap;return{name:"zoom",install(m,f){let A=R.getInstance(),Y=new AbortController,E={lastX:0,lastY:0,velX:0,velY:0,abort:Y};z.set(m,E);let O=[],w=0,L=0,Z=1,$=1,F=0.5,N=0.5,X=()=>{if(A.sendViewTransform(m),A.drawChart(m),A.syncViews)A.syncAllViews(m)},B=()=>{if(m.momentum)cancelAnimationFrame(m.momentum);let V=()=>{if(E.velX*=M,E.velY*=M,Math.abs(E.velX)>0.00005||Math.abs(E.velY)>0.00005){if(m.zoomMode!=="none"&&(m.zoomMode==="both"||m.zoomMode==="x-only"))m.view.panX-=E.velX/m.view.zoomX;if(m.zoomMode!=="none"&&(m.zoomMode==="both"||m.zoomMode==="y-only"))m.view.panY+=E.velY/m.view.zoomY;X(),m.momentum=requestAnimationFrame(V)}else m.momentum=null};m.momentum=requestAnimationFrame(V)},G=()=>{if(m.dragging)m.dragging=!1,O=[]};f.addEventListener("pointerdown",(V)=>{if(m.momentum)cancelAnimationFrame(m.momentum),m.momentum=null;if(O.push(V),f.setPointerCapture(V.pointerId),O.length===1)m.dragging=!0,E.lastX=V.clientX,E.lastY=V.clientY,E.velX=E.velY=0,w=performance.now();else if(O.length===2){let K=f.getBoundingClientRect(),Q=O[1].clientX-O[0].clientX,_=O[1].clientY-O[0].clientY;L=Math.hypot(Q,_),Z=m.view.zoomX,$=m.view.zoomY,F=((O[0].clientX+O[1].clientX)/2-K.left)/K.width,N=1-((O[0].clientY+O[1].clientY)/2-K.top)/K.height}},{signal:Y.signal}),f.addEventListener("pointermove",(V)=>{let K=O.findIndex((Q)=>Q.pointerId===V.pointerId);if(K>=0)O[K]=V;if(O.length===1&&m.dragging){let Q=f.getBoundingClientRect(),_=(V.clientX-E.lastX)/Q.width,H=(V.clientY-E.lastY)/Q.height,T=performance.now();if(T-w<100)E.velX=E.velX*0.5+_*0.5,E.velY=E.velY*0.5+H*0.5;if(w=T,m.zoomMode!=="none"&&(m.zoomMode==="both"||m.zoomMode==="x-only"))m.view.panX-=_/m.view.zoomX;if(m.zoomMode!=="none"&&(m.zoomMode==="both"||m.zoomMode==="y-only"))m.view.panY+=H/m.view.zoomY;E.lastX=V.clientX,E.lastY=V.clientY,X()}else if(O.length===2){let Q=O[1].clientX-O[0].clientX,_=O[1].clientY-O[0].clientY,T=Math.hypot(Q,_)/L;if(m.zoomMode!=="none"&&(m.zoomMode==="both"||m.zoomMode==="x-only")){let l=Math.max(R.MIN_ZOOM,Math.min(R.MAX_ZOOM,Z*T)),I=m.view.panX+F/Z;m.view.zoomX=l,m.view.panX=I-F/l}if(m.zoomMode!=="none"&&(m.zoomMode==="both"||m.zoomMode==="y-only")){let l=Math.max(R.MIN_ZOOM,Math.min(R.MAX_ZOOM,$*T)),I=m.view.panY+N/$;m.view.zoomY=l,m.view.panY=I-N/l}X()}},{signal:Y.signal});let J=(V)=>{if(O=O.filter((K)=>K.pointerId!==V.pointerId),f.releasePointerCapture(V.pointerId),O.length===0&&m.dragging){if(m.dragging=!1,Math.abs(E.velX)>0.001||Math.abs(E.velY)>0.001)B()}};f.addEventListener("pointerup",J,{signal:Y.signal}),f.addEventListener("pointercancel",J,{signal:Y.signal}),f.addEventListener("pointerleave",G,{signal:Y.signal});let j=0;f.addEventListener("pointerup",()=>{let V=Date.now();if(V-j<300)A.resetView(m.id);j=V},{signal:Y.signal}),f.addEventListener("wheel",(V)=>{if(V.preventDefault(),m.momentum)cancelAnimationFrame(m.momentum),m.momentum=null;let K=f.getBoundingClientRect(),Q=V.clientX-K.left,_=V.clientY-K.top,H=Q/K.width,T=1-_/K.height,l=1-V.deltaY*0.002,I=R.MARGIN,q=Q<I.left,v=_>K.height-I.bottom,D,U;if(q)D=!1,U=!0;else if(v)D=!0,U=!1;else D=m.zoomMode==="both"||m.zoomMode==="x-only",U=m.zoomMode==="both"||m.zoomMode==="y-only";if(D){let y=m.view.panX+H/m.view.zoomX;m.view.zoomX=Math.max(R.MIN_ZOOM,Math.min(R.MAX_ZOOM,m.view.zoomX*l)),m.view.panX=y-H/m.view.zoomX}if(U){let y=m.view.panY+T/m.view.zoomY;m.view.zoomY=Math.max(R.MIN_ZOOM,Math.min(R.MAX_ZOOM,m.view.zoomY*l)),m.view.panY=y-T/m.view.zoomY}if(D||U)X()},{passive:!1,signal:Y.signal})},uninstall(m){let f=z.get(m);if(f){if(m.momentum)cancelAnimationFrame(m.momentum),m.momentum=null;f.abort.abort(),z.delete(m)}}}}var s=new WeakMap,wo=(o,M,z,m,f,A,Y,E)=>{o.beginPath(),o.roundRect(M,z,m,f,A),o.fillStyle=Y,o.fill(),o.strokeStyle=E,o.lineWidth=1.5,o.stroke()},Mo={name:"hover",install(o,M){let z=R.getInstance(),m=new AbortController,f={hoverResult:null,pillX:0,pillY:0,pillTargetX:0,pillTargetY:0,pillAnimRef:null,abort:m};s.set(o,f);let A=(Y)=>{if(o.config.onHover)o.config.onHover(Y);if(!(o.config.showTooltip??!1))return;if(f.hoverResult=Y,z.drawChart(o),Y&&!f.pillAnimRef){let E=performance.now(),O=(w)=>{if(!f.hoverResult)return f.pillAnimRef=null;let L=1-Math.pow(0.5,(w-E)/(o.config.pillDecayMs??60));E=w,f.pillX+=(f.pillTargetX-f.pillX)*L,f.pillY+=(f.pillTargetY-f.pillY)*L,z.drawChart(o),f.pillAnimRef=requestAnimationFrame(O)};f.pillAnimRef=requestAnimationFrame(O)}};M.addEventListener("mousemove",(Y)=>{if(o.dragging)return;let E=M.getBoundingClientRect();A(o.findNearestPoint(Y.clientX-E.left,Y.clientY-E.top,E.width,E.height))},{signal:m.signal}),["mouseleave","pointerdown"].forEach((Y)=>M.addEventListener(Y,()=>A(null),{signal:m.signal}))},afterDraw(o,M){let z=s.get(M);if(!z?.hoverResult||!M.config.showTooltip)return;let{hoverResult:m}=z,f=M.width,A=M.height,Y=R.MARGIN,E=R.getInstance().isDark,{formatX:O=String,formatY:w=String,fontFamily:L=R.DEFAULT_FONT}=M.config,Z=(M.bounds.maxX-M.bounds.minX)/M.view.zoomX,$=(M.bounds.maxY-M.bounds.minY)/M.view.zoomY,F=(m.x-(M.bounds.minX+M.view.panX*(M.bounds.maxX-M.bounds.minX)))/Z*f,N=A*(1-(m.y-(M.bounds.minY+M.view.panY*(M.bounds.maxY-M.bounds.minY)))/$),X=M.series[m.seriesIndex]||M.series[0],B=`${Math.round(X.color.r*255)},${Math.round(X.color.g*255)},${Math.round(X.color.b*255)}`,G=`rgb(${B})`,J=E?`oklch(from ${G} calc(l + 0.1) c h)`:G;o.save(),o.setLineDash([4,3]),o.strokeStyle=`rgba(${B},0.4)`,o.stroke(new Path2D(`M${F} 0V${A-Y.bottom}M${Y.left} ${N}H${f}`)),o.restore(),o.beginPath(),o.arc(F,N,4.5,0,Math.PI*2),o.fillStyle=G,o.fill(),o.strokeStyle=E?"rgba(0,0,0,0.6)":"rgba(255,255,255,0.9)",o.stroke();let j=M.series.map((q)=>{let v=0,D=q.rawX.length-1;while(v<=D){let U=v+D>>1;if(Math.abs(q.rawX[U]-m.x)<0.0001)return{label:q.label,val:w(q.rawY[U]),rawVal:q.rawY[U],col:`rgb(${Math.round(q.color.r*255)},${Math.round(q.color.g*255)},${Math.round(q.color.b*255)})`};q.rawX[U]<m.x?v=U+1:D=U-1}return null}).filter(Boolean);j.sort((q,v)=>Math.abs(v.rawVal)-Math.abs(q.rawVal));let V=j.length,K=j.slice(0,5),Q=V-K.length;if(z.pillTargetX=F,z.pillTargetY=N,!z.pillAnimRef)z.pillX=F,z.pillY=N;let _=(q,v,D,U)=>{o.font=`600 10px ${L}`;let y=o.measureText(D).width,S=y+12,p=18,n=U?q-S/2:q-S,k=U?v:v-p/2;o.save();let x=U?Math.atan((z.pillTargetX-z.pillX)/80)*0.2:Math.atan((z.pillTargetY-z.pillY)/80)*0.2;o.translate(q,v),o.rotate(x);let P=U?-S/2:-S,C=U?0:-p/2;o.beginPath(),o.roundRect(P,C,S,p,4),o.fillStyle=E?"rgba(0,0,0,0.75)":"rgba(255,255,255,0.75)",o.fill(),o.fillStyle=`rgba(${B},0.2)`,o.fill(),o.strokeStyle=J,o.lineWidth=1.5,o.stroke(),o.fillStyle=J,o.textAlign="center",o.textBaseline="middle",o.fillText(D,P+S/2,C+p/2),o.restore()};_(Math.max(Y.left,Math.min(f-Y.right,z.pillX)),A-Y.bottom+4,O(m.x),!0),_(Math.max(Y.left,Y.left),Math.max(9,Math.min(A-Y.bottom-9,z.pillY)),w(m.y),!1);let H=Math.max(...K.map((q)=>o.measureText(q.label+q.val).width))+40,T=30+K.length*18+(Q>0?18:0),l=m.screenX+14,I=m.screenY-T-6;if(l+H>f)l=m.screenX-H-14;if(I=Math.max(4,Math.min(A-T-4,m.screenY-T-6)),wo(o,l,I,H,T,6,E?"rgba(28,28,30,0.95)":"rgba(255,255,255,0.96)","rgba(0,0,0,0.08)"),o.textAlign="left",o.textBaseline="middle",o.fillStyle=E?"#888":"#999",o.fillText(O(m.x),l+10,I+15),K.forEach((q,v)=>{let D=I+35+v*18;o.fillStyle=q.col,o.beginPath(),o.roundRect(l+10,D-4,8,8,2),o.fill(),o.fillStyle=E?"#eee":"#1a1a1a",o.fillText(`${q.label}: ${q.val}`,l+24,D)}),Q>0){let q=I+35+K.length*18;o.fillStyle=E?"#666":"#aaa",o.fillText(`+${Q} more`,l+10,q)}},uninstall(o){let M=s.get(o);if(M?.pillAnimRef)cancelAnimationFrame(M.pillAnimRef);M?.abort.abort(),s.delete(o)}};i(oo);i(mo());i(Mo);var t=[],W,b=document.documentElement.classList.contains("dark"),zo=0,Eo=new MessageChannel,Ao=0,Yo=0;Eo.port1.onmessage=()=>{zo=performance.now()-Ao;let o=performance.now();if(o-Yo>=120){Yo=o;let M=(z)=>z<1?z.toFixed(2)+"ms":z.toFixed(1)+"ms";document.getElementById("main-ms").textContent=M(zo)}};function Oo(){requestAnimationFrame(()=>{Ao=performance.now(),Eo.port2.postMessage(null),Oo()})}Oo();var Fo=new Date("2026-02-03");function Lo(o,M){let z=new Array(o),m=new Array(o);if(M==="stock")for(let Y=0;Y<o;Y++)z[Y]=o-1-Y;else for(let Y=0;Y<o;Y++)z[Y]=Y;let A=2*Math.PI;switch(M){case"stock":{let E=Math.LN2/5258880,O=-E*3,w=0.0005,L=0.0009000000000000001,Z=o/5258880,$=Math.max(1,Math.round(Z*(0.8+Math.random()*0.4))),F=[];for(let J=0;J<$;J++){let j=Math.floor(Math.random()*o*0.9),V=Math.floor((180+Math.random()*360)*1440);F.push({s:j,e:j+V})}F.sort((J,j)=>J.s-j.s);let N=Math.log(10+Math.random()*20),X=0,B=0,G=!1;for(let J=0;J<o;J++){while(X<F.length&&J>=F[X].e)X++;let j=X<F.length&&J>=F[X].s&&J<F[X].e,V=j?O:E,K=j?0.0009000000000000001:0.0005,Q;if(G)Q=B,G=!1;else{let _=Math.random()||0.0000000001,H=Math.sqrt(-2*Math.log(_)),T=A*Math.random();Q=H*Math.cos(T),B=H*Math.sin(T),G=!0}N+=V+K*Q,m[J]=Math.exp(N)}break}case"trending":{let Y=Math.log(20+Math.random()*20),E=Math.LN2/o,O=0.015,w=0,L=!1;for(let Z=0;Z<o;Z++){let $;if(L)$=w,L=!1;else{let F=Math.random()||0.0000000001,N=Math.sqrt(-2*Math.log(F)),X=A*Math.random();$=N*Math.cos(X),w=N*Math.sin(X),L=!0}Y+=E+O*$,m[Z]=Math.exp(Y)}break}case"declining":{let Y=Math.log(60+Math.random()*40),E=-Math.LN2/o,O=0.015,w=0,L=!1;for(let Z=0;Z<o;Z++){let $;if(L)$=w,L=!1;else{let F=Math.random()||0.0000000001,N=Math.sqrt(-2*Math.log(F)),X=A*Math.random();$=N*Math.cos(X),w=N*Math.sin(X),L=!0}Y+=E+O*$,m[Z]=Math.exp(Y)}break}case"spikey":{let Y=20+Math.random()*30,E=3+Math.floor(Math.random()*5),O=new Set;while(O.size<Math.min(E,o))O.add(Math.floor(Math.random()*o));let w=Y*1.2,L=Y*5;for(let Z=0;Z<o;Z++)if(O.has(Z))m[Z]=Math.random()<0.5?-L:L;else m[Z]=(Math.random()-0.5)*w;break}case"cyclic":{let Y=Date.now()%1e5/1e5*A,E=30+Math.random()*20,O=50+Math.random()*20,w=2+Math.random()*4,L=A*w/o,Z=E*0.25;for(let $=0;$<o;$++){let F=$*L+Y;m[$]=O+Math.sin(F)*E+Math.sin(F*2.7+1.3)*Z+(Math.random()-0.5)*8}break}}return{x:z,y:m}}function $o(o){if(o>=1000)return"$"+(o/1000).toFixed(1)+"k";return"$"+o.toFixed(2)}function Vo(o){let M=Fo.getTime()-Math.round(o)*60000,z=new Date(M),f=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][z.getMonth()],A=z.getDate(),Y=z.getFullYear();return`${f} ${A}, ${Y}`}function Xo(o,M,z){let m=(1-Math.abs(2*z-1))*M,f=m*(1-Math.abs(o/60%2-1)),A=z-m/2,Y=0,E=0,O=0;if(o<60)Y=m,E=f;else if(o<120)Y=f,E=m;else if(o<180)E=m,O=f;else if(o<240)E=f,O=m;else if(o<300)Y=f,O=m;else Y=m,O=f;return{r:Y+A,g:E+A,b:O+A}}function No(){return Xo(Math.random()*360,0.65+Math.random()*0.2,0.5+Math.random()*0.1)}function Go(o){if(o>=1e6)return(o/1e6).toFixed(1)+"M";if(o>=1000)return(o/1000).toFixed(0)+"k";return o.toString()}function Ro(o){if(Math.abs(o)>=1000)return(o/1000).toFixed(1)+"k";if(Math.abs(o)>=100)return o.toFixed(0);if(Math.abs(o)>=10)return o.toFixed(1);return o.toFixed(2)}function qo(o){return Math.round(o).toString()}function g(o,M,z,m=1){m=Math.max(1,Math.min(1e4,m));let f=[];for(let B=0;B<m;B++){let G=Lo(M,z);if(o==="bar"&&z!=="spikey"&&z!=="cyclic")for(let J=0;J<G.y.length;J++)G.y[J]=Math.max(0,G.y[J]);f.push({label:m>1?`Series ${B+1}`:"",color:No(),x:G.x,y:G.y})}let A=z==="stock",Y={id:"",type:o,pointCount:M,zoomX:!0,zoomY:!0},E=document.createElement("div");E.className="chart-card";let O=o.charAt(0).toUpperCase()+o.slice(1),w=o==="scatter"?`
      <div class="chart-point-size">
        <input type="range" min="1" max="8" value="3" class="point-size-slider" title="Point size">
        <span class="point-size-label">3px</span>
      </div>`:"",L=m>1?`<span class="chart-card-series">×${m}</span>`:"";E.innerHTML=`
    <div class="chart-card-header">
      <span class="chart-card-title">Chart</span>
      <span class="chart-card-type">${O}</span>
      <span class="chart-card-points">${Go(M)}</span>${L}${w}
      <div class="chart-zoom-split">
        <button class="zoom-axis-btn active" data-action="toggle-x" title="Toggle X zoom">X</button>
        <button class="zoom-axis-btn active" data-action="toggle-y" title="Toggle Y zoom">Y</button>
      </div>
      <div class="chart-card-actions">
        <button class="chart-action-btn" data-action="reset" title="Reset view">⌘</button>
        <button class="chart-action-btn danger" data-action="remove" title="Remove">×</button>
      </div>
    </div>
    <div class="chart-card-body"></div>
  `,document.getElementById("chart-grid").appendChild(E);let Z=E.querySelector(".chart-card-body"),$={type:o,container:Z,series:f,formatX:A?Vo:qo,formatY:A?$o:Ro,zoomMode:"both",showTooltip:!0},F;try{F=W.create($)}catch(B){console.error("Failed to create chart:",B),E.remove();return}Y.id=F,E.dataset.id=F,Z.id=`chart-container-${F}`;let N=E.querySelector(".point-size-slider"),X=E.querySelector(".point-size-label");if(N&&X)N.addEventListener("input",()=>{let B=parseInt(N.value);X.textContent=B+"px",W.setPointSize(Y.id,B)});E.addEventListener("click",(B)=>{let G=B.target.closest("[data-action]");if(!G)return;switch(G.dataset.action){case"reset":W.resetView(Y.id);break;case"remove":Zo(Y.id);break;case"toggle-x":fo(Y,"x",G,E);break;case"toggle-y":fo(Y,"y",G,E);break}}),t.push(Y)}function Zo(o){W.destroy(o);let M=t.findIndex((m)=>m.id===o);if(M>=0)t.splice(M,1);let z=document.querySelector(`.chart-card[data-id="${o}"]`);if(z)z.remove()}function fo(o,M,z,m){if(M==="x")o.zoomX=!o.zoomX;else o.zoomY=!o.zoomY;let f=m.querySelector('[data-action="toggle-x"]'),A=m.querySelector('[data-action="toggle-y"]');f.classList.toggle("active",o.zoomX),A.classList.toggle("active",o.zoomY);let Y;if(o.zoomX&&o.zoomY)Y="both";else if(o.zoomX)Y="x-only";else if(o.zoomY)Y="y-only";else Y="none";W.setZoomMode(o.id,Y)}function Bo(){let o=document.getElementById("theme-btn"),M=document.getElementById("theme-icon-sun"),z=document.getElementById("theme-icon-moon"),m=()=>{M.style.display=b?"none":"block",z.style.display=b?"block":"none"};m(),o.addEventListener("click",()=>{b=!b,document.documentElement.classList.toggle("dark",b),localStorage.setItem("theme",b?"dark":"light"),W.setTheme(b),m()})}async function Jo(){if(W=R.getInstance(),!await W.init()){let M=document.getElementById("error-toast");M.textContent="WebGPU not available. Please use a supported browser.",M.classList.remove("hidden");return}W.onStats((M)=>{document.getElementById("active").textContent=M.active.toString(),document.getElementById("total").textContent=M.total.toString()}),Bo(),Ko(),setTimeout(()=>{g("scatter",500,"stock",1),g("line",300,"trending",3),g("bar",100,"spikey",1),g("line",200,"cyclic",1)},100)}function Ko(){let o=document.getElementById("chart-type"),M=document.getElementById("point-count"),z=document.getElementById("pattern"),m=document.getElementById("sync-toggle"),f=document.getElementById("sync-label"),A=document.getElementById("series-count");document.getElementById("add-chart").addEventListener("click",()=>{let Y=o.value,E=parseInt(M.value)||500,O=z.value,w=Math.max(1,Math.min(1e4,parseInt(A.value)||3));g(Y,E,O,w)}),document.getElementById("add-batch").addEventListener("click",()=>{let Y=o.value,E=parseInt(M.value)||500,O=z.value,w=Math.max(1,Math.min(1e4,parseInt(A.value)||3));for(let L=0;L<5;L++)setTimeout(()=>{g(Y,E,O,w)},L*100)}),document.getElementById("clear-all").addEventListener("click",()=>{for(let Y of[...t])Zo(Y.id)}),m.addEventListener("change",()=>{let Y=m.checked;W.setSyncViews(Y),f.textContent=Y?"Synced":"Sync Off"})}var Qo=new WebSocket(`ws://${location.host}/__hot`);Qo.onmessage=(o)=>{if(o.data==="reload")location.reload()};Jo();
