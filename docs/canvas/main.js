var s=[];function $0(o){if(!s.some((A)=>A.name===o.name))s.push(o)}class F{static instance=null;static MARGIN={left:55,right:10,top:8,bottom:45};static HOVER_MAX_DISTANCE_PX=50;static MIN_ZOOM=0.1;static MAX_ZOOM=1e7;static DEFAULT_LABEL_SIZE=12;static DEFAULT_FONT='-apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif';static resizeCanvas(o,A,$){let z=devicePixelRatio||1;if(o.width=Math.round(A*z),o.height=Math.round($*z),o instanceof HTMLCanvasElement)o.style.width=`${A}px`,o.style.height=`${$}px`}worker=null;charts=new Map;chartIdCounter=0;_syncViews=!1;_isDark=!1;statsCallbacks=[];currentStats={fps:0,renderMs:0,total:0,active:0};visibilityObserver;resizeObserver;constructor(){this._isDark=document.documentElement.classList.contains("dark"),this.visibilityObserver=new IntersectionObserver((o)=>{for(let A of o){let $=A.target.dataset.chartId;if($){let z=this.charts.get($);if(z)z.visible=A.isIntersecting,this.worker?.postMessage({type:"set-visibility",id:$,visible:A.isIntersecting})}}},{threshold:0.01}),this.resizeObserver=new ResizeObserver((o)=>{for(let A of o){let $=A.target.dataset.chartId;if(!$)continue;let z=this.charts.get($);if(!z)continue;let{width:Z,height:B}=A.contentRect;if(Z<=0||B<=0)continue;z.width=Z,z.height=B;let V=devicePixelRatio||1;this.worker?.postMessage({type:"resize",id:$,width:Math.round(Z*V),height:Math.round(B*V)}),F.resizeCanvas(z.backCanvas,Z,B),F.resizeCanvas(z.axisCanvas,Z,B),this.drawChart(z)}})}static getInstance(){if(!F.instance)F.instance=new F;return F.instance}get isDark(){return this._isDark}get syncViews(){return this._syncViews}async init(){if(this.worker)return!0;return new Promise((o)=>{let A=new URL("./gpu-worker.js",import.meta.url);this.worker=new Worker(A,{type:"module"}),this.worker.onmessage=($)=>{let{type:z,...Z}=$.data;switch(z){case"gpu-ready":o(!0);break;case"error":console.error("ChartManager GPU Error:",Z.message),o(!1);break;case"stats":this.currentStats={fps:Z.fps,renderMs:Z.renderMs,total:Z.totalCharts,active:Z.activeCharts};for(let B of this.statsCallbacks)B(this.currentStats);break;case"bounds-update":{let B=this.charts.get(Z.id);if(B)B.bounds={minX:Z.minX,maxX:Z.maxX,minY:Z.minY,maxY:Z.maxY},this.drawChart(B);break}}},this.worker.postMessage({type:"init",isDark:this._isDark})})}create(o){if(!this.worker)throw new Error("ChartManager not initialized. Call init() first.");let A=`chart-${++this.chartIdCounter}`,$=document.createElement("div");$.className="gpu-chart",$.dataset.chartId=A;let z=document.createElement("div");z.className="gpu-chart-canvas-wrap",z.dataset.chartId=A;let Z=document.createElement("canvas");Z.className="gpu-chart-back-canvas";let B=document.createElement("canvas");B.className="gpu-chart-canvas";let V=document.createElement("canvas");V.className="gpu-chart-axis-canvas",z.appendChild(Z),z.appendChild(B),z.appendChild(V),$.appendChild(z),o.container.appendChild($);let q;try{q=B.transferControlToOffscreen()}catch(K){throw console.error(`ChartManager: Failed to create offscreen canvas for ${A}:`,K),new Error(`Failed to create chart ${A}: ${K}`)}let L=z.getBoundingClientRect(),Y=L.width||400,m=L.height||200;if(F.resizeCanvas(q,Y,m),F.resizeCanvas(Z,Y,m),F.resizeCanvas(V,Y,m),o.bgColor){let[K,G,R]=o.bgColor;z.style.background=`rgb(${Math.round(K*255)},${Math.round(G*255)},${Math.round(R*255)})`}let j={id:A,config:o,el:$,backCanvas:Z,axisCanvas:V,width:Y,height:m,series:[],bounds:{minX:0,maxX:1,minY:0,maxY:1},view:{panX:0,panY:0,zoomX:1,zoomY:1},zoomMode:o.zoomMode||"both",visible:!0,dragging:!1,bgColor:o.bgColor,textColor:o.textColor,gridColor:o.gridColor,fontFamily:o.fontFamily,momentum:null,findNearestPoint(K,G,R,X){if(this.series.length===0)return null;let E=K/R,u=G/X,b=this.bounds.maxX-this.bounds.minX,f=this.bounds.maxY-this.bounds.minY,_=b/this.view.zoomX,S=f/this.view.zoomY,H=this.bounds.minX+this.view.panX*b,O=this.bounds.minY+this.view.panY*f,I=H+E*_,P=O+(1-u)*S,T=-1,M=-1,D=1/0,k=1/0;for(let c=0;c<this.series.length;c++){let i=this.series[c],A0=i.rawX.length;if(A0===0)continue;let v=0,x=A0-1;while(v<x){let t=v+x>>1;if(i.rawX[t]<I)v=t+1;else x=t}let Z0=v;if(v>0){let t=Math.abs(i.rawX[v]-I);if(Math.abs(i.rawX[v-1]-I)<t)Z0=v-1}let Y0=Math.abs(i.rawX[Z0]-I),M0=Math.abs(i.rawY[Z0]-P);if(Y0<D||Y0===D&&M0<k)D=Y0,k=M0,T=c,M=Z0}if(T===-1)return null;let N=this.series[T],d=(N.rawX[M]-H)/_*R;if(Math.abs(d-K)>F.HOVER_MAX_DISTANCE_PX)return null;return{x:N.rawX[M],y:N.rawY[M],index:M,screenX:K,screenY:G,seriesIndex:T,seriesLabel:N.label}}};this.charts.set(A,j);let J=o.type==="bar"?"box":o.type;this.worker.postMessage({type:"register-chart",id:A,canvas:q,chartType:J,pointSize:o.pointSize??3,maxSamplesPerPixel:o.maxSamplesPerPixel??1e4,bgColor:o.bgColor??null},[q]),this.visibilityObserver.observe($),this.resizeObserver.observe(z);for(let K of s)K.install?.(j,z);return this.updateSeries(A,o.series),A}destroy(o){let A=this.charts.get(o);if(!A)return;for(let z of s)z.uninstall?.(A);if(A.momentum)cancelAnimationFrame(A.momentum);this.visibilityObserver.unobserve(A.el);let $=A.el.querySelector(".gpu-chart-canvas-wrap");if($)this.resizeObserver.unobserve($);A.el.remove(),this.worker?.postMessage({type:"unregister-chart",id:o}),this.charts.delete(o)}updateSeries(o,A){let $=this.charts.get(o);if(!$||!this.worker)return;if(A.length===0)return;$.series=A.map((j)=>{let J=j.x.length;if(J===0)return{label:j.label,color:j.color,rawX:[],rawY:[]};let K=Array.from({length:J},(G,R)=>R);return K.sort((G,R)=>j.x[G]-j.x[R]),{label:j.label,color:j.color,rawX:K.map((G)=>j.x[G]),rawY:K.map((G)=>j.y[G])}});let z=1/0,Z=-1/0,B=1/0,V=-1/0;for(let j of $.series)for(let J=0;J<j.rawX.length;J++){if(j.rawX[J]<z)z=j.rawX[J];if(j.rawX[J]>Z)Z=j.rawX[J];if(j.rawY[J]<B)B=j.rawY[J];if(j.rawY[J]>V)V=j.rawY[J]}let q=(Z-z)*0.05||1,L=(V-B)*0.1||1;z-=q,Z+=q,B-=L,V+=L;let Y=$.config.defaultBounds;if(Y){if(Y.minX!==void 0)z=Y.minX;if(Y.maxX!==void 0)Z=Y.maxX;if(Y.minY!==void 0)B=Y.minY;if(Y.maxY!==void 0)V=Y.maxY}$.bounds={minX:z,maxX:Z,minY:B,maxY:V};let m=$.series.map((j)=>({label:j.label,colorR:j.color.r,colorG:j.color.g,colorB:j.color.b,dataX:new Float32Array(j.rawX),dataY:new Float32Array(j.rawY)}));this.worker.postMessage({type:"update-series",id:o,series:m,bounds:$.bounds},m.flatMap((j)=>[j.dataX.buffer,j.dataY.buffer])),this.sendViewTransform($),this.drawChart($)}setPointSize(o,A){if(!this.charts.get(o))return;this.worker?.postMessage({type:"set-point-size",id:o,pointSize:Math.max(1,Math.min(8,Math.round(A)))})}setMaxSamplesPerPixel(o,A){if(!this.charts.get(o))return;this.worker?.postMessage({type:"set-max-samples",id:o,maxSamplesPerPixel:Math.max(0,A|0)})}setStyle(o,A){let $=this.charts.get(o);if(!$)return;if(A.bgColor!==void 0)$.bgColor=A.bgColor;if(A.textColor!==void 0)$.textColor=A.textColor;if(A.gridColor!==void 0)$.gridColor=A.gridColor;if(A.fontFamily!==void 0)$.fontFamily=A.fontFamily;if(A.bgColor!==void 0){let z=$.el.querySelector(".gpu-chart-canvas-wrap");if(z){let[Z,B,V]=A.bgColor;z.style.background=`rgb(${Math.round(Z*255)},${Math.round(B*255)},${Math.round(V*255)})`}this.worker?.postMessage({type:"set-style",id:o,bgColor:A.bgColor})}this.drawChart($)}setZoomMode(o,A){let $=this.charts.get(o);if($)$.zoomMode=A}getChartCount(){return this.charts.size}getZoomMode(o){return this.charts.get(o)?.zoomMode||"both"}setSyncViews(o){this._syncViews=o}setTheme(o){this._isDark=o,this.worker?.postMessage({type:"theme",isDark:o});for(let A of this.charts.values())this.drawChart(A)}onStats(o){return this.statsCallbacks.push(o),()=>{let A=this.statsCallbacks.indexOf(o);if(A>=0)this.statsCallbacks.splice(A,1)}}getStats(){return{...this.currentStats}}resetView(o){let A=this.charts.get(o);if(!A)return;if(A.momentum)cancelAnimationFrame(A.momentum),A.momentum=null;let $=A.view.panX,z=A.view.panY,Z=A.view.zoomX,B=A.view.zoomY,V=performance.now(),q=()=>{let L=Math.min(1,(performance.now()-V)/300),Y=1-Math.pow(1-L,3);if(A.view.panX=$*(1-Y),A.view.panY=z*(1-Y),A.view.zoomX=Z+(1-Z)*Y,A.view.zoomY=B+(1-B)*Y,this.sendViewTransform(A),this.drawChart(A),this._syncViews)this.syncAllViews(A);if(L<1)requestAnimationFrame(q)};requestAnimationFrame(q)}sendViewTransform(o){this.worker?.postMessage({type:"view-transform",id:o.id,panX:o.view.panX,panY:o.view.panY,zoomX:o.view.zoomX,zoomY:o.view.zoomY})}syncAllViews(o){let A=[];for(let $ of this.charts.values())if($.id!==o.id)$.view={...o.view},A.push({id:$.id}),this.drawChart($);if(A.length>0)this.worker?.postMessage({type:"batch-view-transform",panX:o.view.panX,panY:o.view.panY,zoomX:o.view.zoomX,zoomY:o.view.zoomY,transforms:A})}drawChart(o){if(!o.visible)return;let A=devicePixelRatio||1,$=o.backCanvas.getContext("2d");if($){$.clearRect(0,0,o.backCanvas.width,o.backCanvas.height),$.save(),$.scale(A,A);for(let Z of s)Z.beforeDraw?.($,o);$.restore()}let z=o.axisCanvas.getContext("2d");if(z){z.clearRect(0,0,o.axisCanvas.width,o.axisCanvas.height),z.save(),z.scale(A,A);for(let Z of s)Z.afterDraw?.(z,o);z.restore()}}}var V0=(o,A,$)=>{let z=A-o;if(z<=0)return[o];let Z=z/$,B=10**Math.floor(Math.log10(Z)),V=Z/B,q=B*(V<=1.5?1:V<=3?2:V<=7?5:10),L=[];for(let Y=Math.ceil(o/q)*q;Y<=A;Y+=q)L.push(Y);return L},R0=(o)=>{let A=F.getInstance(),$=o.width,z=o.height,Z=F.MARGIN,{bounds:B,view:V}=o,q=B.maxX-B.minX,L=B.maxY-B.minY,Y=q/V.zoomX,m=L/V.zoomY,j=B.minX+V.panX*q,J=B.minY+V.panY*L,K=o.bgColor??(A.isDark?[0.11,0.11,0.12]:[0.98,0.98,0.98]);return{w:$,h:z,m:Z,rx:Y,ry:m,mx:j,my:J,bg:`${Math.round(K[0]*255)},${Math.round(K[1]*255)},${Math.round(K[2]*255)}`,font:o.fontFamily??F.DEFAULT_FONT,text:o.textColor??(A.isDark?"#c0c0c0":"#333333"),grid:o.gridColor??(A.isDark?"rgba(255,255,255,0.06)":"rgba(0,0,0,0.06)")}},_0={name:"labels",beforeDraw(o,A){let{w:$,h:z,m:Z,rx:B,ry:V,mx:q,my:L,grid:Y}=R0(A);o.strokeStyle=Y,o.lineWidth=1,o.beginPath(),V0(L,L+V,7).forEach((m)=>{let j=z*(1-(m-L)/V);if(j>5&&j<z-Z.bottom-5)o.moveTo(Z.left,j),o.lineTo($,j)}),V0(q,q+B,8).forEach((m)=>{let j=$*((m-q)/B);if(j>Z.left&&j<$)o.moveTo(j,0),o.lineTo(j,z-Z.bottom)}),o.stroke()},afterDraw(o,A){let{w:$,h:z,m:Z,rx:B,ry:V,mx:q,my:L,bg:Y,font:m,text:j}=R0(A),{formatX:J=String,formatY:K=String,labelSize:G=F.DEFAULT_LABEL_SIZE}=A.config,R=(X,E,u,b,f)=>{let _=X==="left"?o.createLinearGradient(E,0,E+b,0):o.createLinearGradient(0,u,0,u+f),S=X==="left"?[1,0.7,0.2,0.05,0]:[0,0.05,0.2,0.7,1];[0,0.35,0.55,0.7,1].forEach((H,O)=>_.addColorStop(H,`rgba(${Y},${S[O]})`)),o.fillStyle=_,o.fillRect(E,u,b,f)};R("left",0,0,Z.left+20,z),R("bottom",0,z-Z.bottom-20,$,Z.bottom+20),o.font=`${G}px ${m}`,o.fillStyle=j,o.textAlign="right",o.textBaseline="middle",V0(L,L+V,7).forEach((X)=>{let E=z*(1-(X-L)/V);if(E>5&&E<z-Z.bottom-5)o.fillText(K(X),Z.left-5,E)}),o.textAlign="right",o.textBaseline="top",V0(q,q+B,8).forEach((X)=>{let E=$*((X-q)/B);if(E<Z.left-10||E>$+30)return;o.save(),o.translate(E,z-Z.bottom+5),o.rotate(-Math.PI/14),o.fillText(J(X),0,0),o.restore()})}};function G0(o={}){let A=o.momentumDecay??0.91,$=new WeakMap;return{name:"zoom",install(z,Z){let B=F.getInstance(),V=new AbortController,q={lastX:0,lastY:0,velX:0,velY:0,abort:V};$.set(z,q);let L=[],Y=0,m=0,j=1,J=1,K=0.5,G=0.5,R=()=>{if(B.sendViewTransform(z),B.drawChart(z),B.syncViews)B.syncAllViews(z)},X=()=>{if(z.momentum)cancelAnimationFrame(z.momentum);let f=()=>{if(q.velX*=A,q.velY*=A,Math.abs(q.velX)>0.00005||Math.abs(q.velY)>0.00005){if(z.zoomMode!=="none"&&(z.zoomMode==="both"||z.zoomMode==="x-only"))z.view.panX-=q.velX/z.view.zoomX;if(z.zoomMode!=="none"&&(z.zoomMode==="both"||z.zoomMode==="y-only"))z.view.panY+=q.velY/z.view.zoomY;R(),z.momentum=requestAnimationFrame(f)}else z.momentum=null};z.momentum=requestAnimationFrame(f)},E=()=>{if(z.dragging)z.dragging=!1,L=[]};Z.addEventListener("pointerdown",(f)=>{if(z.momentum)cancelAnimationFrame(z.momentum),z.momentum=null;if(L.push(f),Z.setPointerCapture(f.pointerId),L.length===1)z.dragging=!0,q.lastX=f.clientX,q.lastY=f.clientY,q.velX=q.velY=0,Y=performance.now();else if(L.length===2){let _=Z.getBoundingClientRect(),S=L[1].clientX-L[0].clientX,H=L[1].clientY-L[0].clientY;m=Math.hypot(S,H),j=z.view.zoomX,J=z.view.zoomY,K=((L[0].clientX+L[1].clientX)/2-_.left)/_.width,G=1-((L[0].clientY+L[1].clientY)/2-_.top)/_.height}},{signal:V.signal}),Z.addEventListener("pointermove",(f)=>{let _=L.findIndex((S)=>S.pointerId===f.pointerId);if(_>=0)L[_]=f;if(L.length===1&&z.dragging){let S=Z.getBoundingClientRect(),H=(f.clientX-q.lastX)/S.width,O=(f.clientY-q.lastY)/S.height,I=performance.now();if(I-Y<100)q.velX=q.velX*0.5+H*0.5,q.velY=q.velY*0.5+O*0.5;if(Y=I,z.zoomMode!=="none"&&(z.zoomMode==="both"||z.zoomMode==="x-only"))z.view.panX-=H/z.view.zoomX;if(z.zoomMode!=="none"&&(z.zoomMode==="both"||z.zoomMode==="y-only"))z.view.panY+=O/z.view.zoomY;q.lastX=f.clientX,q.lastY=f.clientY,R()}else if(L.length===2){let S=L[1].clientX-L[0].clientX,H=L[1].clientY-L[0].clientY,I=Math.hypot(S,H)/m;if(z.zoomMode!=="none"&&(z.zoomMode==="both"||z.zoomMode==="x-only")){let P=Math.max(F.MIN_ZOOM,Math.min(F.MAX_ZOOM,j*I)),T=z.view.panX+K/j;z.view.zoomX=P,z.view.panX=T-K/P}if(z.zoomMode!=="none"&&(z.zoomMode==="both"||z.zoomMode==="y-only")){let P=Math.max(F.MIN_ZOOM,Math.min(F.MAX_ZOOM,J*I)),T=z.view.panY+G/J;z.view.zoomY=P,z.view.panY=T-G/P}R()}},{signal:V.signal});let u=(f)=>{if(L=L.filter((_)=>_.pointerId!==f.pointerId),Z.releasePointerCapture(f.pointerId),L.length===0&&z.dragging){if(z.dragging=!1,Math.abs(q.velX)>0.001||Math.abs(q.velY)>0.001)X()}};Z.addEventListener("pointerup",u,{signal:V.signal}),Z.addEventListener("pointercancel",u,{signal:V.signal}),Z.addEventListener("pointerleave",E,{signal:V.signal});let b=0;Z.addEventListener("pointerup",()=>{let f=Date.now();if(f-b<300)B.resetView(z.id);b=f},{signal:V.signal}),Z.addEventListener("wheel",(f)=>{if(f.preventDefault(),z.momentum)cancelAnimationFrame(z.momentum),z.momentum=null;let _=Z.getBoundingClientRect(),S=f.clientX-_.left,H=f.clientY-_.top,O=S/_.width,I=1-H/_.height,P=1-f.deltaY*0.002,T=F.MARGIN,M=S<T.left,D=H>_.height-T.bottom,k,N;if(M)k=!1,N=!0;else if(D)k=!0,N=!1;else k=z.zoomMode==="both"||z.zoomMode==="x-only",N=z.zoomMode==="both"||z.zoomMode==="y-only";if(k){let p=z.view.panX+O/z.view.zoomX;z.view.zoomX=Math.max(F.MIN_ZOOM,Math.min(F.MAX_ZOOM,z.view.zoomX*P)),z.view.panX=p-O/z.view.zoomX}if(N){let p=z.view.panY+I/z.view.zoomY;z.view.zoomY=Math.max(F.MIN_ZOOM,Math.min(F.MAX_ZOOM,z.view.zoomY*P)),z.view.panY=p-I/z.view.zoomY}if(k||N)R()},{passive:!1,signal:V.signal})},uninstall(z){let Z=$.get(z);if(Z){if(z.momentum)cancelAnimationFrame(z.momentum),z.momentum=null;Z.abort.abort(),$.delete(z)}}}}var B0=new WeakMap,O0=(o,A,$,z,Z,B,V,q)=>{o.beginPath(),o.roundRect(A,$,z,Z,B),o.fillStyle=V,o.fill(),o.strokeStyle=q,o.lineWidth=1.5,o.stroke()},N0={name:"hover",install(o,A){let $=F.getInstance(),z=new AbortController,Z={hoverResult:null,pillX:0,pillY:0,pillTargetX:0,pillTargetY:0,pillAnimRef:null,abort:z};B0.set(o,Z);let B=(V)=>{if(o.config.onHover)o.config.onHover(V);if(!(o.config.showTooltip??!1))return;if(Z.hoverResult=V,$.drawChart(o),V&&!Z.pillAnimRef){let q=performance.now(),L=(Y)=>{if(!Z.hoverResult)return Z.pillAnimRef=null;let m=1-Math.pow(0.5,(Y-q)/(o.config.pillDecayMs??60));q=Y,Z.pillX+=(Z.pillTargetX-Z.pillX)*m,Z.pillY+=(Z.pillTargetY-Z.pillY)*m,$.drawChart(o),Z.pillAnimRef=requestAnimationFrame(L)};Z.pillAnimRef=requestAnimationFrame(L)}};A.addEventListener("mousemove",(V)=>{if(o.dragging)return;let q=A.getBoundingClientRect();B(o.findNearestPoint(V.clientX-q.left,V.clientY-q.top,q.width,q.height))},{signal:z.signal}),["mouseleave","pointerdown"].forEach((V)=>A.addEventListener(V,()=>B(null),{signal:z.signal}))},afterDraw(o,A){let $=B0.get(A);if(!$?.hoverResult||!A.config.showTooltip)return;let{hoverResult:z}=$,Z=A.width,B=A.height,V=F.MARGIN,q=F.getInstance().isDark,{formatX:L=String,formatY:Y=String,fontFamily:m=F.DEFAULT_FONT}=A.config,j=(A.bounds.maxX-A.bounds.minX)/A.view.zoomX,J=(A.bounds.maxY-A.bounds.minY)/A.view.zoomY,K=(z.x-(A.bounds.minX+A.view.panX*(A.bounds.maxX-A.bounds.minX)))/j*Z,G=B*(1-(z.y-(A.bounds.minY+A.view.panY*(A.bounds.maxY-A.bounds.minY)))/J),R=A.series[z.seriesIndex]||A.series[0],X=`${Math.round(R.color.r*255)},${Math.round(R.color.g*255)},${Math.round(R.color.b*255)}`,E=`rgb(${X})`,u=q?`oklch(from ${E} calc(l + 0.1) c h)`:E;o.save(),o.setLineDash([4,3]),o.strokeStyle=`rgba(${X},0.4)`,o.stroke(new Path2D(`M${K} 0V${B-V.bottom}M${V.left} ${G}H${Z}`)),o.restore(),o.beginPath(),o.arc(K,G,4.5,0,Math.PI*2),o.fillStyle=E,o.fill(),o.strokeStyle=q?"rgba(0,0,0,0.6)":"rgba(255,255,255,0.9)",o.stroke();let b=A.series.map((M)=>{let D=0,k=M.rawX.length-1;while(D<=k){let N=D+k>>1;if(Math.abs(M.rawX[N]-z.x)<0.0001)return{label:M.label,val:Y(M.rawY[N]),rawVal:M.rawY[N],col:`rgb(${Math.round(M.color.r*255)},${Math.round(M.color.g*255)},${Math.round(M.color.b*255)})`};M.rawX[N]<z.x?D=N+1:k=N-1}return null}).filter(Boolean);b.sort((M,D)=>Math.abs(D.rawVal)-Math.abs(M.rawVal));let f=b.length,_=b.slice(0,5),S=f-_.length;if($.pillTargetX=K,$.pillTargetY=G,!$.pillAnimRef)$.pillX=K,$.pillY=G;let H=(M,D,k,N)=>{o.font=`600 10px ${m}`;let p=o.measureText(k).width,d=p+12,e=18,c=N?M-d/2:M-d,i=N?D:D-e/2;o.save();let A0=N?Math.atan(($.pillTargetX-$.pillX)/80)*0.2:Math.atan(($.pillTargetY-$.pillY)/80)*0.2;o.translate(M,D),o.rotate(A0);let v=N?-d/2:-d,x=N?0:-e/2;o.beginPath(),o.roundRect(v,x,d,e,4),o.fillStyle=q?"rgba(0,0,0,0.75)":"rgba(255,255,255,0.75)",o.fill(),o.fillStyle=`rgba(${X},0.2)`,o.fill(),o.strokeStyle=u,o.lineWidth=1.5,o.stroke(),o.fillStyle=u,o.textAlign="center",o.textBaseline="middle",o.fillText(k,v+d/2,x+e/2),o.restore()};H(Math.max(V.left,Math.min(Z-V.right,$.pillX)),B-V.bottom+4,L(z.x),!0),H(Math.max(V.left,V.left),Math.max(9,Math.min(B-V.bottom-9,$.pillY)),Y(z.y),!1);let O=Math.max(..._.map((M)=>o.measureText(M.label+M.val).width))+40,I=30+_.length*18+(S>0?18:0),P=z.screenX+14,T=z.screenY-I-6;if(P+O>Z)P=z.screenX-O-14;if(T=Math.max(4,Math.min(B-I-4,z.screenY-I-6)),O0(o,P,T,O,I,6,q?"rgba(28,28,30,0.95)":"rgba(255,255,255,0.96)","rgba(0,0,0,0.08)"),o.textAlign="left",o.textBaseline="middle",o.fillStyle=q?"#888":"#999",o.fillText(L(z.x),P+10,T+15),_.forEach((M,D)=>{let k=T+35+D*18;o.fillStyle=M.col,o.beginPath(),o.roundRect(P+10,k-4,8,8,2),o.fill(),o.fillStyle=q?"#eee":"#1a1a1a",o.fillText(`${M.label}: ${M.val}`,P+24,k)}),S>0){let M=T+35+_.length*18;o.fillStyle=q?"#666":"#aaa",o.fillText(`+${S} more`,P+10,M)}},uninstall(o){let A=B0.get(o);if(A?.pillAnimRef)cancelAnimationFrame(A.pillAnimRef);A?.abort.abort(),B0.delete(o)}};$0(_0);$0(G0());$0(N0);var a=16,E0=320,U0=240,K0=480,Q0=320,C0=0.1,w0=4,b0=0.0015,m0=[{name:"US GDP (1960–2024)",category:"GDP & Growth",url:"https://api.worldbank.org/v2/country/us/indicator/NY.GDP.MKTP.CD?date=1960:2024&format=json&per_page=100",transform:`const items = data[1].filter(d => d.value != null).reverse();
return { x: items.map(d => parseInt(d.date)), y: items.map(d => d.value) };`,type:"line"},{name:"China GDP (1960–2024)",category:"GDP & Growth",url:"https://api.worldbank.org/v2/country/cn/indicator/NY.GDP.MKTP.CD?date=1960:2024&format=json&per_page=100",transform:`const items = data[1].filter(d => d.value != null).reverse();
return { x: items.map(d => parseInt(d.date)), y: items.map(d => d.value) };`,type:"line"},{name:"India GDP (1960–2024)",category:"GDP & Growth",url:"https://api.worldbank.org/v2/country/in/indicator/NY.GDP.MKTP.CD?date=1960:2024&format=json&per_page=100",transform:`const items = data[1].filter(d => d.value != null).reverse();
return { x: items.map(d => parseInt(d.date)), y: items.map(d => d.value) };`,type:"line"},{name:"Japan GDP (1960–2024)",category:"GDP & Growth",url:"https://api.worldbank.org/v2/country/jp/indicator/NY.GDP.MKTP.CD?date=1960:2024&format=json&per_page=100",transform:`const items = data[1].filter(d => d.value != null).reverse();
return { x: items.map(d => parseInt(d.date)), y: items.map(d => d.value) };`,type:"line"},{name:"Germany GDP (1960–2024)",category:"GDP & Growth",url:"https://api.worldbank.org/v2/country/de/indicator/NY.GDP.MKTP.CD?date=1960:2024&format=json&per_page=100",transform:`const items = data[1].filter(d => d.value != null).reverse();
return { x: items.map(d => parseInt(d.date)), y: items.map(d => d.value) };`,type:"line"},{name:"Brazil GDP (1960–2024)",category:"GDP & Growth",url:"https://api.worldbank.org/v2/country/br/indicator/NY.GDP.MKTP.CD?date=1960:2024&format=json&per_page=100",transform:`const items = data[1].filter(d => d.value != null).reverse();
return { x: items.map(d => parseInt(d.date)), y: items.map(d => d.value) };`,type:"line"},{name:"Nigeria GDP (1960–2024)",category:"GDP & Growth",url:"https://api.worldbank.org/v2/country/ng/indicator/NY.GDP.MKTP.CD?date=1960:2024&format=json&per_page=100",transform:`const items = data[1].filter(d => d.value != null).reverse();
return { x: items.map(d => parseInt(d.date)), y: items.map(d => d.value) };`,type:"line"},{name:"US GDP per Capita",category:"GDP & Growth",url:"https://api.worldbank.org/v2/country/us/indicator/NY.GDP.PCAP.CD?date=1960:2024&format=json&per_page=100",transform:`const items = data[1].filter(d => d.value != null).reverse();
return { x: items.map(d => parseInt(d.date)), y: items.map(d => d.value) };`,type:"line"},{name:"China GDP Growth % (annual)",category:"GDP & Growth",url:"https://api.worldbank.org/v2/country/cn/indicator/NY.GDP.MKTP.KD.ZG?date=1960:2024&format=json&per_page=100",transform:`const items = data[1].filter(d => d.value != null).reverse();
return { x: items.map(d => parseInt(d.date)), y: items.map(d => d.value) };`,type:"bar"},{name:"India GDP Growth % (annual)",category:"GDP & Growth",url:"https://api.worldbank.org/v2/country/in/indicator/NY.GDP.MKTP.KD.ZG?date=1960:2024&format=json&per_page=100",transform:`const items = data[1].filter(d => d.value != null).reverse();
return { x: items.map(d => parseInt(d.date)), y: items.map(d => d.value) };`,type:"bar"},{name:"Bitcoin 1yr",category:"Crypto",url:"https://api.coingecko.com/api/v3/coins/bitcoin/market_chart?vs_currency=usd&days=365",transform:`const p = data.prices;
return { x: p.map((_, i) => i), y: p.map(d => d[1]) };`,type:"line"},{name:"Ethereum 1yr",category:"Crypto",url:"https://api.coingecko.com/api/v3/coins/ethereum/market_chart?vs_currency=usd&days=365",transform:`const p = data.prices;
return { x: p.map((_, i) => i), y: p.map(d => d[1]) };`,type:"line"},{name:"Solana 90d",category:"Crypto",url:"https://api.coingecko.com/api/v3/coins/solana/market_chart?vs_currency=usd&days=90",transform:`const p = data.prices;
return { x: p.map((_, i) => i), y: p.map(d => d[1]) };`,type:"line"},{name:"Dogecoin 90d",category:"Crypto",url:"https://api.coingecko.com/api/v3/coins/dogecoin/market_chart?vs_currency=usd&days=90",transform:`const p = data.prices;
return { x: p.map((_, i) => i), y: p.map(d => d[1]) };`,type:"line"},{name:"Cardano 90d",category:"Crypto",url:"https://api.coingecko.com/api/v3/coins/cardano/market_chart?vs_currency=usd&days=90",transform:`const p = data.prices;
return { x: p.map((_, i) => i), y: p.map(d => d[1]) };`,type:"line"},{name:"XRP 90d",category:"Crypto",url:"https://api.coingecko.com/api/v3/coins/ripple/market_chart?vs_currency=usd&days=90",transform:`const p = data.prices;
return { x: p.map((_, i) => i), y: p.map(d => d[1]) };`,type:"line"},{name:"Polkadot 90d",category:"Crypto",url:"https://api.coingecko.com/api/v3/coins/polkadot/market_chart?vs_currency=usd&days=90",transform:`const p = data.prices;
return { x: p.map((_, i) => i), y: p.map(d => d[1]) };`,type:"line"},{name:"Chainlink 90d",category:"Crypto",url:"https://api.coingecko.com/api/v3/coins/chainlink/market_chart?vs_currency=usd&days=90",transform:`const p = data.prices;
return { x: p.map((_, i) => i), y: p.map(d => d[1]) };`,type:"line"},{name:"BTC Volume 30d",category:"Crypto",url:"https://api.coingecko.com/api/v3/coins/bitcoin/market_chart?vs_currency=usd&days=30",transform:`const v = data.total_volumes;
return { x: v.map((_, i) => i), y: v.map(d => d[1]) };`,type:"bar"},{name:"ETH Volume 30d",category:"Crypto",url:"https://api.coingecko.com/api/v3/coins/ethereum/market_chart?vs_currency=usd&days=30",transform:`const v = data.total_volumes;
return { x: v.map((_, i) => i), y: v.map(d => d[1]) };`,type:"bar"},{name:"BTC Market Cap 1yr",category:"Crypto",url:"https://api.coingecko.com/api/v3/coins/bitcoin/market_chart?vs_currency=usd&days=365",transform:`const m = data.market_caps;
return { x: m.map((_, i) => i), y: m.map(d => d[1]) };`,type:"line"},{name:"World Population",category:"Population & Society",url:"https://api.worldbank.org/v2/country/wld/indicator/SP.POP.TOTL?date=1960:2024&format=json&per_page=100",transform:`const items = data[1].filter(d => d.value != null).reverse();
return { x: items.map(d => parseInt(d.date)), y: items.map(d => d.value) };`,type:"line"},{name:"India Population",category:"Population & Society",url:"https://api.worldbank.org/v2/country/in/indicator/SP.POP.TOTL?date=1960:2024&format=json&per_page=100",transform:`const items = data[1].filter(d => d.value != null).reverse();
return { x: items.map(d => parseInt(d.date)), y: items.map(d => d.value) };`,type:"line"},{name:"Japan Population (decline)",category:"Population & Society",url:"https://api.worldbank.org/v2/country/jp/indicator/SP.POP.TOTL?date=1960:2024&format=json&per_page=100",transform:`const items = data[1].filter(d => d.value != null).reverse();
return { x: items.map(d => parseInt(d.date)), y: items.map(d => d.value) };`,type:"line"},{name:"Nigeria Population (boom)",category:"Population & Society",url:"https://api.worldbank.org/v2/country/ng/indicator/SP.POP.TOTL?date=1960:2024&format=json&per_page=100",transform:`const items = data[1].filter(d => d.value != null).reverse();
return { x: items.map(d => parseInt(d.date)), y: items.map(d => d.value) };`,type:"line"},{name:"US Life Expectancy",category:"Population & Society",url:"https://api.worldbank.org/v2/country/us/indicator/SP.DYN.LE00.IN?date=1960:2024&format=json&per_page=100",transform:`const items = data[1].filter(d => d.value != null).reverse();
return { x: items.map(d => parseInt(d.date)), y: items.map(d => d.value) };`,type:"line"},{name:"Japan Life Expectancy",category:"Population & Society",url:"https://api.worldbank.org/v2/country/jp/indicator/SP.DYN.LE00.IN?date=1960:2024&format=json&per_page=100",transform:`const items = data[1].filter(d => d.value != null).reverse();
return { x: items.map(d => parseInt(d.date)), y: items.map(d => d.value) };`,type:"line"},{name:"Global Fertility Rate",category:"Population & Society",url:"https://api.worldbank.org/v2/country/wld/indicator/SP.DYN.TFRT.IN?date=1960:2024&format=json&per_page=100",transform:`const items = data[1].filter(d => d.value != null).reverse();
return { x: items.map(d => parseInt(d.date)), y: items.map(d => d.value) };`,type:"line"},{name:"Global Infant Mortality",category:"Population & Society",url:"https://api.worldbank.org/v2/country/wld/indicator/SP.DYN.IMRT.IN?date=1960:2024&format=json&per_page=100",transform:`const items = data[1].filter(d => d.value != null).reverse();
return { x: items.map(d => parseInt(d.date)), y: items.map(d => d.value) };`,type:"line"},{name:"US Unemployment %",category:"Population & Society",url:"https://api.worldbank.org/v2/country/us/indicator/SL.UEM.TOTL.NE.ZS?date=1991:2024&format=json&per_page=100",transform:`const items = data[1].filter(d => d.value != null).reverse();
return { x: items.map(d => parseInt(d.date)), y: items.map(d => d.value) };`,type:"line"},{name:"South Africa Unemployment %",category:"Population & Society",url:"https://api.worldbank.org/v2/country/za/indicator/SL.UEM.TOTL.NE.ZS?date=1991:2024&format=json&per_page=100",transform:`const items = data[1].filter(d => d.value != null).reverse();
return { x: items.map(d => parseInt(d.date)), y: items.map(d => d.value) };`,type:"line"},{name:"Global CO2 (kt)",category:"Energy & Emissions",url:"https://api.worldbank.org/v2/country/wld/indicator/EN.ATM.CO2E.KT?date=1960:2022&format=json&per_page=100",transform:`const items = data[1].filter(d => d.value != null).reverse();
return { x: items.map(d => parseInt(d.date)), y: items.map(d => d.value) };`,type:"line"},{name:"US CO2 per Capita",category:"Energy & Emissions",url:"https://api.worldbank.org/v2/country/us/indicator/EN.ATM.CO2E.PC?date=1960:2022&format=json&per_page=100",transform:`const items = data[1].filter(d => d.value != null).reverse();
return { x: items.map(d => parseInt(d.date)), y: items.map(d => d.value) };`,type:"line"},{name:"China CO2 per Capita",category:"Energy & Emissions",url:"https://api.worldbank.org/v2/country/cn/indicator/EN.ATM.CO2E.PC?date=1960:2022&format=json&per_page=100",transform:`const items = data[1].filter(d => d.value != null).reverse();
return { x: items.map(d => parseInt(d.date)), y: items.map(d => d.value) };`,type:"line"},{name:"Global Renewable Energy %",category:"Energy & Emissions",url:"https://api.worldbank.org/v2/country/wld/indicator/EG.FEC.RNEW.ZS?date=1990:2022&format=json&per_page=100",transform:`const items = data[1].filter(d => d.value != null).reverse();
return { x: items.map(d => parseInt(d.date)), y: items.map(d => d.value) };`,type:"line"},{name:"Global Electricity Access %",category:"Energy & Emissions",url:"https://api.worldbank.org/v2/country/wld/indicator/EG.ELC.ACCS.ZS?date=1990:2024&format=json&per_page=100",transform:`const items = data[1].filter(d => d.value != null).reverse();
return { x: items.map(d => parseInt(d.date)), y: items.map(d => d.value) };`,type:"line"},{name:"India Electricity Access %",category:"Energy & Emissions",url:"https://api.worldbank.org/v2/country/in/indicator/EG.ELC.ACCS.ZS?date=1990:2024&format=json&per_page=100",transform:`const items = data[1].filter(d => d.value != null).reverse();
return { x: items.map(d => parseInt(d.date)), y: items.map(d => d.value) };`,type:"line"},{name:"Brazil Forest Area %",category:"Energy & Emissions",url:"https://api.worldbank.org/v2/country/br/indicator/AG.LND.FRST.ZS?date=1990:2022&format=json&per_page=100",transform:`const items = data[1].filter(d => d.value != null).reverse();
return { x: items.map(d => parseInt(d.date)), y: items.map(d => d.value) };`,type:"line"},{name:"Global Internet Users %",category:"Technology & Trade",url:"https://api.worldbank.org/v2/country/wld/indicator/IT.NET.USER.ZS?date=1990:2024&format=json&per_page=100",transform:`const items = data[1].filter(d => d.value != null).reverse();
return { x: items.map(d => parseInt(d.date)), y: items.map(d => d.value) };`,type:"line"},{name:"China Mobile Subscriptions / 100",category:"Technology & Trade",url:"https://api.worldbank.org/v2/country/cn/indicator/IT.CEL.SETS.P2?date=1960:2024&format=json&per_page=100",transform:`const items = data[1].filter(d => d.value != null).reverse();
return { x: items.map(d => parseInt(d.date)), y: items.map(d => d.value) };`,type:"line"},{name:"India Internet Users %",category:"Technology & Trade",url:"https://api.worldbank.org/v2/country/in/indicator/IT.NET.USER.ZS?date=1990:2024&format=json&per_page=100",transform:`const items = data[1].filter(d => d.value != null).reverse();
return { x: items.map(d => parseInt(d.date)), y: items.map(d => d.value) };`,type:"line"},{name:"US R&D Spending % GDP",category:"Technology & Trade",url:"https://api.worldbank.org/v2/country/us/indicator/GB.XPD.RSDV.GD.ZS?date=1996:2024&format=json&per_page=100",transform:`const items = data[1].filter(d => d.value != null).reverse();
return { x: items.map(d => parseInt(d.date)), y: items.map(d => d.value) };`,type:"line"},{name:"South Korea R&D % GDP",category:"Technology & Trade",url:"https://api.worldbank.org/v2/country/kr/indicator/GB.XPD.RSDV.GD.ZS?date=1996:2024&format=json&per_page=100",transform:`const items = data[1].filter(d => d.value != null).reverse();
return { x: items.map(d => parseInt(d.date)), y: items.map(d => d.value) };`,type:"line"},{name:"US Military Spending % GDP",category:"Technology & Trade",url:"https://api.worldbank.org/v2/country/us/indicator/MS.MIL.XPND.GD.ZS?date=1960:2024&format=json&per_page=100",transform:`const items = data[1].filter(d => d.value != null).reverse();
return { x: items.map(d => parseInt(d.date)), y: items.map(d => d.value) };`,type:"line"},{name:"Global Trade % of GDP",category:"Technology & Trade",url:"https://api.worldbank.org/v2/country/wld/indicator/NE.TRD.GNFS.ZS?date=1960:2024&format=json&per_page=100",transform:`const items = data[1].filter(d => d.value != null).reverse();
return { x: items.map(d => parseInt(d.date)), y: items.map(d => d.value) };`,type:"line"},{name:"US Inflation (CPI %)",category:"Technology & Trade",url:"https://api.worldbank.org/v2/country/us/indicator/FP.CPI.TOTL.ZG?date=1960:2024&format=json&per_page=100",transform:`const items = data[1].filter(d => d.value != null).reverse();
return { x: items.map(d => parseInt(d.date)), y: items.map(d => d.value) };`,type:"line"},{name:"Argentina Inflation (CPI %)",category:"Technology & Trade",url:"https://api.worldbank.org/v2/country/ar/indicator/FP.CPI.TOTL.ZG?date=1960:2024&format=json&per_page=100",transform:`const items = data[1].filter(d => d.value != null).reverse();
return { x: items.map(d => parseInt(d.date)), y: items.map(d => d.value) };`,type:"bar"},{name:"SF Bay Temp (10yr daily)",category:"Climate & Weather",url:"https://power.larc.nasa.gov/api/temporal/daily/point?parameters=T2M&community=SB&longitude=-122.4&latitude=37.8&start=20150101&end=20241231&format=JSON",transform:`const temps = data.properties.parameter.T2M;
const entries = Object.entries(temps).filter(([k, v]) => v !== -999);
return { x: entries.map((_, i) => i), y: entries.map(([k, v]) => v) };`,type:"line"},{name:"Tokyo Temp (10yr daily)",category:"Climate & Weather",url:"https://power.larc.nasa.gov/api/temporal/daily/point?parameters=T2M&community=SB&longitude=139.7&latitude=35.7&start=20150101&end=20241231&format=JSON",transform:`const temps = data.properties.parameter.T2M;
const entries = Object.entries(temps).filter(([k, v]) => v !== -999);
return { x: entries.map((_, i) => i), y: entries.map(([k, v]) => v) };`,type:"line"},{name:"Death Valley Temp (10yr)",category:"Climate & Weather",url:"https://power.larc.nasa.gov/api/temporal/daily/point?parameters=T2M&community=SB&longitude=-116.8&latitude=36.5&start=20150101&end=20241231&format=JSON",transform:`const temps = data.properties.parameter.T2M;
const entries = Object.entries(temps).filter(([k, v]) => v !== -999);
return { x: entries.map((_, i) => i), y: entries.map(([k, v]) => v) };`,type:"line"},{name:"Antarctica Temp (10yr)",category:"Climate & Weather",url:"https://power.larc.nasa.gov/api/temporal/daily/point?parameters=T2M&community=SB&longitude=0&latitude=-85&start=20150101&end=20241231&format=JSON",transform:`const temps = data.properties.parameter.T2M;
const entries = Object.entries(temps).filter(([k, v]) => v !== -999);
return { x: entries.map((_, i) => i), y: entries.map(([k, v]) => v) };`,type:"line"},{name:"Sahara Solar Radiation (10yr)",category:"Climate & Weather",url:"https://power.larc.nasa.gov/api/temporal/daily/point?parameters=ALLSKY_SFC_SW_DWN&community=SB&longitude=3&latitude=23.5&start=20150101&end=20241231&format=JSON",transform:`const param = data.properties.parameter.ALLSKY_SFC_SW_DWN;
const entries = Object.entries(param).filter(([k, v]) => v !== -999);
return { x: entries.map((_, i) => i), y: entries.map(([k, v]) => v) };`,type:"line"},{name:"London Solar Radiation (10yr)",category:"Climate & Weather",url:"https://power.larc.nasa.gov/api/temporal/daily/point?parameters=ALLSKY_SFC_SW_DWN&community=SB&longitude=-0.12&latitude=51.5&start=20150101&end=20241231&format=JSON",transform:`const param = data.properties.parameter.ALLSKY_SFC_SW_DWN;
const entries = Object.entries(param).filter(([k, v]) => v !== -999);
return { x: entries.map((_, i) => i), y: entries.map(([k, v]) => v) };`,type:"line"},{name:"Reykjavik Wind Speed (10yr)",category:"Climate & Weather",url:"https://power.larc.nasa.gov/api/temporal/daily/point?parameters=WS10M&community=SB&longitude=-21.9&latitude=64.1&start=20150101&end=20241231&format=JSON",transform:`const param = data.properties.parameter.WS10M;
const entries = Object.entries(param).filter(([k, v]) => v !== -999);
return { x: entries.map((_, i) => i), y: entries.map(([k, v]) => v) };`,type:"line"},{name:"Mumbai Humidity (10yr)",category:"Climate & Weather",url:"https://power.larc.nasa.gov/api/temporal/daily/point?parameters=RH2M&community=SB&longitude=72.9&latitude=19.1&start=20150101&end=20241231&format=JSON",transform:`const param = data.properties.parameter.RH2M;
const entries = Object.entries(param).filter(([k, v]) => v !== -999);
return { x: entries.map((_, i) => i), y: entries.map(([k, v]) => v) };`,type:"line"},{name:"Denver Precipitation (10yr)",category:"Climate & Weather",url:"https://power.larc.nasa.gov/api/temporal/daily/point?parameters=PRECTOTCORR&community=SB&longitude=-104.9&latitude=39.7&start=20150101&end=20241231&format=JSON",transform:`const param = data.properties.parameter.PRECTOTCORR;
const entries = Object.entries(param).filter(([k, v]) => v !== -999);
return { x: entries.map((_, i) => i), y: entries.map(([k, v]) => v) };`,type:"bar"},{name:"Earthquakes (30d scatter)",category:"Seismology",url:"https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_month.geojson",transform:`const f = data.features.filter(f => f.properties.mag != null);
f.sort((a, b) => a.properties.time - b.properties.time);
const t0 = f[0]?.properties.time || 0;
return {
  x: f.map(f => (f.properties.time - t0) / 3600000),
  y: f.map(f => f.properties.mag)
};`,type:"scatter"},{name:"Earthquake Depth vs Mag",category:"Seismology",url:"https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_month.geojson",transform:`const f = data.features.filter(f => f.properties.mag != null && f.geometry.coordinates[2] > 0);
return {
  x: f.map(f => f.geometry.coordinates[2]),
  y: f.map(f => f.properties.mag)
};`,type:"scatter"},{name:"Quake Lat vs Lng (plate map)",category:"Seismology",url:"https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_month.geojson",transform:`const f = data.features.filter(f => f.properties.mag != null);
return {
  x: f.map(f => f.geometry.coordinates[0]),
  y: f.map(f => f.geometry.coordinates[1])
};`,type:"scatter"},{name:"Significant Quakes (30d)",category:"Seismology",url:"https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/significant_month.geojson",transform:`const f = data.features.filter(f => f.properties.mag != null);
f.sort((a, b) => a.properties.time - b.properties.time);
return {
  x: f.map((_, i) => i),
  y: f.map(f => f.properties.mag)
};`,type:"bar"},{name:"M4.5+ Quakes (30d)",category:"Seismology",url:"https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/4.5_month.geojson",transform:`const f = data.features.filter(f => f.properties.mag != null);
f.sort((a, b) => a.properties.time - b.properties.time);
const t0 = f[0]?.properties.time || 0;
return {
  x: f.map(f => (f.properties.time - t0) / 3600000),
  y: f.map(f => f.properties.mag)
};`,type:"scatter"},{name:"Random Walk (100k)",category:"Synthetic",url:"",transform:`const n = 100000;
const x = new Array(n), y = new Array(n);
let v = 0;
for (let i = 0; i < n; i++) { x[i] = i; v += (Math.random() - 0.498) * 2; y[i] = v; }
return { x, y };`,type:"line"},{name:"Random Walk (1M)",category:"Synthetic",url:"",transform:`const n = 1000000;
const x = new Array(n), y = new Array(n);
let v = 0;
for (let i = 0; i < n; i++) { x[i] = i; v += (Math.random() - 0.498) * 2; y[i] = v; }
return { x, y };`,type:"line"},{name:"Sine Waves (10k)",category:"Synthetic",url:"",transform:`const n = 10000;
const x = new Array(n), y = new Array(n);
for (let i = 0; i < n; i++) { x[i] = i; y[i] = Math.sin(i * 0.01) + Math.sin(i * 0.03) * 0.5; }
return { x, y };`,type:"line"},{name:"Noise Cloud (50k)",category:"Synthetic",url:"",transform:`const n = 50000;
const x = new Array(n), y = new Array(n);
for (let i = 0; i < n; i++) {
  const a = Math.random() * Math.PI * 2;
  const r = Math.sqrt(-2 * Math.log(Math.random()));
  x[i] = Math.cos(a) * r; y[i] = Math.sin(a) * r;
}
return { x, y };`,type:"scatter"},{name:"Deadmau5 (10M)",category:"Synthetic",url:"",transform:`const N = 10000000, x = new Array(N), y = new Array(N);
const rp = (cx, cy, r) => {
  const a = Math.random() * 6.2832, d = Math.sqrt(Math.random()) * r;
  return [cx + Math.cos(a) * d, cy + Math.sin(a) * d];
};
let i = 0;
while (i < N) {
  let p, s = Math.random();
  if (s < 0.5) {
    p = rp(0, 0, 5);
    const lx = p[0] + 1.7, ly = p[1] - 0.8, rx = p[0] - 1.7, ry = p[1] - 0.8;
    if (lx * lx + ly * ly < 1.44 || rx * rx + ry * ry < 1.44) continue;
    const sd = p[0] * p[0] + (p[1] + 1) * (p[1] + 1);
    if (p[1] < -1 && sd > 5.76 && sd < 9 && Math.abs(p[0]) < 2.8) continue;
  } else if (s < 0.75) { p = rp(-3.8, 5.8, 3); }
  else { p = rp(3.8, 5.8, 3); }
  x[i] = p[0]; y[i] = p[1]; i++;
}
return { x, y };`,type:"scatter"},{name:"Spiral Galaxy (5M)",category:"Synthetic",url:"",transform:`const N = 5000000, x = new Array(N), y = new Array(N);
for (let i = 0; i < N; i++) {
  const arm = (Math.random() * 4) | 0;
  const d = Math.sqrt(Math.random()) * 12;
  const a = d * 0.7 + arm * 1.5708 + (Math.random() - 0.5) * (0.4 + d * 0.04);
  x[i] = Math.cos(a) * d;
  y[i] = Math.sin(a) * d;
}
return { x, y };`,type:"scatter"},{name:"Heart (2M)",category:"Synthetic",url:"",transform:`const N = 2000000, x = new Array(N), y = new Array(N);
let i = 0;
while (i < N) {
  const px = (Math.random() - 0.5) * 36, py = (Math.random() - 0.5) * 34;
  const nx = px / 16, ny = (py - 3) / 16;
  const v = nx * nx + ny * ny - 1;
  if (v * v * v - nx * nx * ny * ny * ny <= 0) { x[i] = px; y[i] = py; i++; }
}
return { x, y };`,type:"scatter"},{name:"Lissajous (500k)",category:"Synthetic",url:"",transform:`const N = 500000, x = new Array(N), y = new Array(N);
for (let i = 0; i < N; i++) {
  const t = i * 0.0001 + Math.random() * 0.02;
  x[i] = Math.sin(3 * t + 0.5) + (Math.random() - 0.5) * 0.05;
  y[i] = Math.sin(5 * t) + (Math.random() - 0.5) * 0.05;
}
return { x, y };`,type:"scatter"}],w,g=[],X0=1,l=0,n=0,W=1,C,o0,h,Q=null,L0=null,z0=null,S0=0,I0=0;function U(o){return Math.round(o/a)*a}function y0(o,A){return o.x<A.x+A.w&&o.x+o.w>A.x&&o.y<A.y+A.h&&o.y+o.h>A.y}function y(o,A){for(let $ of g){if($.id===A)continue;if(y0(o,$))return!0}return!1}function u0(o,A){let $=C.getBoundingClientRect();return{x:(o-$.left-l)/W,y:(A-$.top-n)/W}}function v0(o,A,$){let z=(1-Math.abs(2*$-1))*A,Z=z*(1-Math.abs(o/60%2-1)),B=$-z/2,V=0,q=0,L=0;if(o<60)V=z,q=Z;else if(o<120)V=Z,q=z;else if(o<180)q=z,L=Z;else if(o<240)q=Z,L=z;else if(o<300)V=Z,L=z;else V=z,L=Z;return{r:V+B,g:q+B,b:L+B}}function g0(){return v0(Math.random()*360,0.6+Math.random()*0.2,0.5+Math.random()*0.15)}function l0(){let A=new Array(1000),$=new Array(1000),z=50;for(let Z=0;Z<1000;Z++)A[Z]=Z,z+=(Math.random()-0.498)*3,$[Z]=z;return{x:A,y:$}}function n0(o){if(Math.abs(o)>=1e6)return(o/1e6).toFixed(1)+"M";if(Math.abs(o)>=1000)return(o/1000).toFixed(1)+"k";if(Math.abs(o)>=100)return o.toFixed(0);if(Math.abs(o)>=10)return o.toFixed(1);return o.toFixed(2)}function d0(o){return Math.round(o).toString()}function i0(o){if(o>=1e6)return(o/1e6).toFixed(1)+"M";if(o>=1000)return(o/1000).toFixed(0)+"k";return o.toString()}var P0=document.createElement("canvas").getContext("2d");function p0(o,A){return P0.font=A,P0.measureText(o||" ").width}function J0(){o0.style.transform=`translate(${l}px, ${n}px) scale(${W})`;let o=24*W;C.style.backgroundSize=`${o}px ${o}px`,C.style.backgroundPosition=`${l%o}px ${n%o}px`}var k0=0;function x0(){let o=document.getElementById("zoom-indicator");o.textContent=Math.round(W*100)+"%",o.classList.add("visible"),clearTimeout(k0),k0=window.setTimeout(()=>o.classList.remove("visible"),800)}function s0(){C=document.getElementById("viewport"),o0=document.getElementById("canvas"),h=document.getElementById("context-menu"),C.addEventListener("wheel",(o)=>{o.preventDefault();let A=-o.deltaY*b0,$=Math.min(w0,Math.max(C0,W*(1+A))),z=C.getBoundingClientRect(),Z=o.clientX-z.left,B=o.clientY-z.top;l=Z-(Z-l)/W*$,n=B-(B-n)/W*$,W=$,J0(),x0()},{passive:!1}),C.addEventListener("mousedown",(o)=>{if(j0(),h0(),o.button!==0)return;let A=o.target;if(A!==C&&A!==o0&&!A.classList.contains("vignette"))return;o.preventDefault(),Q={type:"pan",startMX:o.clientX,startMY:o.clientY,startX:0,startY:0,startW:0,startH:0,startPanX:l,startPanY:n},C.classList.add("grabbing")}),window.addEventListener("mousemove",e0),window.addEventListener("mouseup",c0),C.addEventListener("contextmenu",(o)=>{o.preventDefault();let A=o.target;if(A!==C&&A!==o0&&!A.classList.contains("vignette"))return;let $=u0(o.clientX,o.clientY);S0=U($.x),I0=U($.y),h.style.left=o.clientX+"px",h.style.top=o.clientY+"px",h.classList.add("open")}),h.querySelectorAll("button[data-type]").forEach((o)=>{o.addEventListener("click",()=>{let A=o.dataset.type;f0(A,S0,I0),j0()})}),document.addEventListener("mousedown",(o)=>{if(!o.target.closest(".context-menu"))j0()}),J0()}function j0(){h.classList.remove("open")}function h0(){document.getElementById("add-menu").classList.remove("open")}function e0(o){if(!Q)return;o.preventDefault();let A=o.clientX-Q.startMX,$=o.clientY-Q.startMY;if(Q.type==="pan"){l=Q.startPanX+A,n=Q.startPanY+$,J0();return}if(Q.type==="drag"&&Q.chart){let z=Q.chart,Z=U(Q.startX+A/W),B=U(Q.startY+$/W),V={x:Z,y:B,w:z.w,h:z.h};if(!y(V,z.id))z.x=Z,z.y=B;else{let q=!y({x:Z,y:z.y,w:z.w,h:z.h},z.id),L=!y({x:z.x,y:B,w:z.w,h:z.h},z.id);if(q)z.x=Z;if(L)z.y=B}H0(z);return}if(Q.type==="resize"&&Q.chart){let{chart:z,handle:Z}=Q,B=z.x,V=z.y,q=z.w,L=z.h,Y=A/W,m=$/W;if(Z.includes("e"))q=U(Math.max(E0,Q.startW+Y));if(Z.includes("w")){let J=U(Math.max(E0,Q.startW-Y));B=U(Q.startX+(Q.startW-J)),q=J}if(Z.includes("s"))L=U(Math.max(U0,Q.startH+m));if(Z.includes("n")){let J=U(Math.max(U0,Q.startH-m));V=U(Q.startY+(Q.startH-J)),L=J}if(!y({x:B,y:V,w:q,h:L},z.id))z.x=B,z.y=V,z.w=q,z.h=L;else{let J={x:B,y:z.y,w:q,h:z.h},K={x:z.x,y:V,w:z.w,h:L};if(!y(J,z.id))z.x=B,z.w=q;if(!y(K,z.id))z.y=V,z.h=L}H0(z),o5(z);return}}function c0(o){if(!Q)return;if(Q.type==="pan")C.classList.remove("grabbing");if(Q.type==="drag"&&Q.chart)Q.chart.el.classList.remove("dragging");if(Q.type==="resize"&&Q.chart)Q.chart.el.classList.remove("resizing");Q=null}function F0(o,A){let $=C.getBoundingClientRect(),z=U((-l+$.width/2)/W-o/2),Z=U((-n+$.height/2)/W-A/2);if(!y({x:z,y:Z,w:o,h:A}))return{x:z,y:Z};for(let B=a;B<4000;B+=a)for(let V=-B;V<=B;V+=a){if(!y({x:z+V,y:Z-B,w:o,h:A}))return{x:z+V,y:Z-B};if(!y({x:z+V,y:Z+B,w:o,h:A}))return{x:z+V,y:Z+B};if(!y({x:z-B,y:Z+V,w:o,h:A}))return{x:z-B,y:Z+V};if(!y({x:z+B,y:Z+V,w:o,h:A}))return{x:z+B,y:Z+V}}return{x:z,y:Z}}function f0(o,A,$){let z="tile-"+X0++,Z=U(K0),B=U(Q0),V=U(A-Z/2),q=U($-B/2);if(y({x:V,y:q,w:Z,h:B})){let R=F0(Z,B);V=R.x,q=R.y}let L={id:z,chartId:"",name:"Chart "+(X0-1),x:V,y:q,w:Z,h:B,type:o,el:null},Y=a0(L);L.el=Y,o0.appendChild(Y),g.push(L);let m=Y.querySelector(".tile-body"),j=document.getElementById("series-count"),J=Math.max(1,Math.min(100,parseInt(j?.value||"3"))),K=[];for(let R=0;R<J;R++){let X=l0(),E=g0();K.push({label:`Series ${String.fromCharCode(65+R)}`,color:E,x:X.x,y:X.y})}let G={type:o,container:m,series:K,formatX:d0,formatY:n0,zoomMode:"both",showTooltip:!0,bgColor:[0.055,0.055,0.086],textColor:"#8888a0",gridColor:"#262638"};try{L.chartId=w.create(G)}catch(R){console.error("Failed to create chart:",R),Y.remove(),g.splice(g.indexOf(L),1);return}}function q0(o){let A=U(K0),$=U(Q0),z=F0(A,$);f0(o,z.x+A/2,z.y+$/2)}function D0(o){let A=g.findIndex((z)=>z.id===o);if(A<0)return;let $=g[A];if($.chartId)w.destroy($.chartId);$.el.remove(),g.splice(A,1)}function t0(){for(let o of[...g])D0(o.id)}function r0(o){let $=()=>{let z=p0(o.value,"600 13px -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif");o.style.width=Math.max(20,Math.ceil(z)+14)+"px"};return o.addEventListener("input",$),o.addEventListener("blur",$),$(),$}function a0(o){let A=document.createElement("div");A.className="chart-tile",A.dataset.tileId=o.id,A.style.left=o.x+"px",A.style.top=o.y+"px",A.style.width=o.w+"px",A.style.height=o.h+"px";let $=o.type.charAt(0).toUpperCase()+o.type.slice(1),z=o.type==="scatter"?`<div class="tile-point-size">
        <input type="range" min="1" max="12" value="3" class="point-size-slider" title="Point size">
        <span class="point-size-label">3px</span>
      </div>`:"";A.innerHTML=`
    <div class="tile-header">
      <input class="tile-name" value="${o.name}" spellcheck="false" />
      <div class="tile-tools">
        <span class="tile-type">${$}</span>
        <span class="tile-points">1k</span>
        ${z}
        <button class="tile-btn" data-action="reset" title="Reset view">&#x2318;</button>
        <button class="tile-btn" data-action="data" title="Load data source">
          <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <path d="M8 3v8M5 8l3 3 3-3"/>
            <path d="M3 12h10"/>
          </svg>
        </button>
        <button class="tile-btn danger" data-action="close" title="Remove chart">&times;</button>
      </div>
    </div>
    <div class="tile-body"></div>
    <div class="resize-handle resize-n" data-handle="n"></div>
    <div class="resize-handle resize-s" data-handle="s"></div>
    <div class="resize-handle resize-e" data-handle="e"></div>
    <div class="resize-handle resize-w" data-handle="w"></div>
    <div class="resize-handle resize-ne" data-handle="ne"></div>
    <div class="resize-handle resize-nw" data-handle="nw"></div>
    <div class="resize-handle resize-se" data-handle="se"></div>
    <div class="resize-handle resize-sw" data-handle="sw"></div>
  `,A.addEventListener("wheel",(Y)=>Y.stopPropagation());let Z=A.querySelector(".tile-name"),B=r0(Z);Z.addEventListener("input",()=>{o.name=Z.value}),Z.addEventListener("mousedown",(Y)=>Y.stopPropagation()),A._resizeName=B;let V=A.querySelector(".point-size-slider"),q=A.querySelector(".point-size-label");if(V&&q)V.addEventListener("input",()=>{let Y=parseInt(V.value);if(q.textContent=Y+"px",o.chartId)w.setPointSize(o.chartId,Y)}),V.addEventListener("mousedown",(Y)=>Y.stopPropagation());return A.querySelector(".tile-header").addEventListener("mousedown",(Y)=>{let m=Y.target;if(m.tagName==="INPUT"||m.tagName==="BUTTON"||m.closest("button"))return;if(Y.button!==0)return;Y.preventDefault(),Y.stopPropagation(),A.classList.add("dragging"),Q={type:"drag",chart:o,startMX:Y.clientX,startMY:Y.clientY,startX:o.x,startY:o.y,startW:o.w,startH:o.h,startPanX:l,startPanY:n}}),A.querySelectorAll(".resize-handle").forEach((Y)=>{Y.addEventListener("mousedown",(m)=>{m.preventDefault(),m.stopPropagation();let j=Y.dataset.handle;A.classList.add("resizing"),Q={type:"resize",chart:o,handle:j,startMX:m.clientX,startMY:m.clientY,startX:o.x,startY:o.y,startW:o.w,startH:o.h,startPanX:l,startPanY:n}})}),A.addEventListener("click",(Y)=>{let m=Y.target.closest("[data-action]");if(!m)return;let j=m.dataset.action;if(j==="close")D0(o.id);if(j==="data")z5(o);if(j==="reset"&&o.chartId)w.resetView(o.chartId)}),A}function W0(o,A){let $=o.el.querySelector(".tile-points");if($)$.textContent=i0(A)}function H0(o){o.el.style.left=o.x+"px",o.el.style.top=o.y+"px"}function o5(o){o.el.style.width=o.w+"px",o.el.style.height=o.h+"px"}function z5(o){L0=o,z0=null;let A=document.getElementById("data-modal"),$=document.getElementById("data-url"),z=document.getElementById("data-transform"),Z=document.getElementById("data-error");$.value="",z.value="",Z.classList.add("hidden"),Z.textContent="";let B=document.getElementById("presets");B.innerHTML="";let V=[],q=new Map;for(let L of m0){if(!q.has(L.category))V.push(L.category),q.set(L.category,[]);q.get(L.category).push(L)}for(let L of V){let Y=document.createElement("div");Y.className="preset-category";let m=document.createElement("div");m.className="preset-category-header",m.textContent=L,Y.appendChild(m);let j=document.createElement("div");j.className="preset-category-items";for(let J of q.get(L)){let K=document.createElement("button");K.className="preset-btn",K.textContent=J.name,K.addEventListener("click",()=>{$.value=J.url,z.value=J.transform,z0=J.name,Z.classList.add("hidden"),B.querySelectorAll(".preset-btn").forEach((G)=>G.classList.remove("active")),K.classList.add("active")}),j.appendChild(K)}Y.appendChild(j),B.appendChild(Y)}A.classList.add("open")}async function A5(o,A){try{let $=null;if(A.url){let V=await fetch(A.url);if(!V.ok)throw new Error(`Fetch failed: HTTP ${V.status}`);$=await V.json()}let Z=new Function("data","url",A.transform)($,A.url);if(!Z||!Array.isArray(Z.x)||!Array.isArray(Z.y))return;if(Z.x.length===0)return;w.updateData(o.chartId,{x:Z.x,y:Z.y}),w.resetView(o.chartId),W0(o,Z.x.length),o.name=A.name;let B=o.el.querySelector(".tile-name");if(B){B.value=o.name;let V=o.el._resizeName;if(V)V()}}catch($){console.warn(`Failed to load preset "${A.name}":`,$)}}function r(){document.getElementById("data-modal").classList.remove("open"),L0=null,z0=null}async function Z5(){if(!L0)return;let o=L0,A=document.getElementById("data-url").value.trim(),$=document.getElementById("data-transform").value.trim(),z=document.getElementById("data-error");if(z.classList.add("hidden"),!$){z.textContent="Please provide a transform function.",z.classList.remove("hidden");return}try{let Z=null;if(A){let L=await fetch(A);if(!L.ok)throw new Error(`Fetch failed: HTTP ${L.status} ${L.statusText}`);Z=await L.json()}let V=new Function("data","url",$)(Z,A);if(!V||!Array.isArray(V.x)||!Array.isArray(V.y))throw new Error("Transform must return { x: number[], y: number[] }");if(V.x.length!==V.y.length)throw new Error(`x and y arrays must be same length (got ${V.x.length} and ${V.y.length})`);if(V.x.length===0)throw new Error("Returned data is empty");if(w.updateData(o.chartId,{x:V.x,y:V.y}),w.resetView(o.chartId),W0(o,V.x.length),/^Chart \d+$/.test(o.name)&&z0){o.name=z0;let L=o.el.querySelector(".tile-name");if(L){L.value=o.name;let Y=o.el._resizeName;if(Y)Y()}}r()}catch(Z){z.textContent=Z.message||String(Z),z.classList.remove("hidden")}}function $5(){document.getElementById("modal-close").addEventListener("click",r),document.getElementById("data-cancel").addEventListener("click",r),document.getElementById("data-load").addEventListener("click",Z5),document.getElementById("data-modal").addEventListener("mousedown",(o)=>{if(o.target.classList.contains("modal-overlay"))r()}),document.addEventListener("keydown",(o)=>{if(o.key==="Escape"){if(document.getElementById("data-modal").classList.contains("open"))r()}})}var T0=0;function V5(o,A="error"){let $=document.getElementById("toast");$.textContent=o,$.style.background=A==="success"?"var(--success)":"var(--danger)",$.classList.remove("hidden"),clearTimeout(T0),T0=window.setTimeout(()=>$.classList.add("hidden"),3000)}function B5(){let o=document.getElementById("add-btn"),A=document.getElementById("add-menu");o.addEventListener("click",(Z)=>{Z.stopPropagation(),A.classList.toggle("open")}),A.querySelectorAll("button[data-type]").forEach((Z)=>{Z.addEventListener("click",()=>{let B=Z.dataset.type;q0(B),A.classList.remove("open")})}),document.addEventListener("mousedown",(Z)=>{if(!Z.target.closest("#add-dropdown"))A.classList.remove("open")});let $=document.getElementById("sync-toggle"),z=document.getElementById("sync-label");$.addEventListener("change",()=>{let Z=$.checked;w.setSyncViews(Z),z.textContent=Z?"Synced":"Sync Off"}),document.getElementById("add-random-5").addEventListener("click",()=>{let Z=["line","scatter","bar"];for(let B=0;B<5;B++){let V=m0[Math.floor(Math.random()*m0.length)],q=V.type||Z[Math.floor(Math.random()*Z.length)],L=U(K0),Y=U(Q0),m=F0(L,Y);f0(q,m.x+L/2,m.y+Y/2);let j=g[g.length-1];if(j)A5(j,V)}}),document.getElementById("clear-all").addEventListener("click",t0)}function q5(){let o=0,A=new MessageChannel,$=0,z=0;A.port1.onmessage=()=>{o=performance.now()-$;let B=performance.now();if(B-z>=120){z=B;let V=(q)=>q<1?q.toFixed(2)+"ms":q.toFixed(1)+"ms";document.getElementById("main-ms").textContent=V(o)}};function Z(){requestAnimationFrame(()=>{$=performance.now(),A.port2.postMessage(null),Z()})}Z()}function L5(){w.onStats((o)=>{document.getElementById("active").textContent=o.active.toString(),document.getElementById("total").textContent=o.total.toString()})}async function Y5(){if(w=F.getInstance(),!await w.init()){V5("WebGPU not available. Please use a supported browser.","error");return}w.setTheme(!0),s0(),B5(),$5(),q5(),L5(),setTimeout(()=>{q0("line"),q0("scatter"),q0("bar")},100)}var j5=new WebSocket(`ws://${location.host}/__hot`);j5.onmessage=(o)=>{if(o.data==="reload")location.reload()};Y5();
